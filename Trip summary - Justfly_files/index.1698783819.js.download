document.addEventListener('DOMContentLoaded',function(event){var el;var windowWidthHeaderActions=767;el={menuToggle:document.getElementById('jfly-mobile-menu-toggle'),menuContainer:document.getElementById('jfly-mobile-menu-container'),menuOverlay:document.getElementById('jfly-mobile-menu-overlay'),submenuToggles:document.getElementsByClassName('jfly-submenu-toggle'),submenuElements:document.getElementsByClassName('jfly-submenu-element'),submenuWrappers:document.getElementsByClassName('jfly-submenu-wrapper'),myBookingsLink:document.getElementById("my-bookings-link"),travelCreditsLink:document.getElementById("travel-credits-link")};if(!el.menuContainer){return;}
$(document).on("modal-user-logged-in",function(e){el.menuContainer.className+=" user-logged";});function hasClass(elem,presentClass,cb){var classes;cb=cb||function(){};classes=elem.className.split(' ');for(var i=0;i<classes.length;i++){if(classes[i]===presentClass){cb(elem,classes,i);return true;}}
return false;}
function addClass(elem,newClass){if(!hasClass(elem,newClass)){elem.className+=' '+newClass;}}
function removeClass(elem,removedClass){hasClass(elem,removedClass,function(elem,classes,i){classes.splice(i,1);elem.className=classes.join(' ');});}
function show(elem){if(elem){elem.style['display']='block';}}
function hide(elem){if(elem){elem.style['display']='none';}}
function isDescendant(elem,parent){while(elem=elem.parentElement){if(elem===parent)return true;}
return false;}
function closeHeaderMenu(){removeClass(el.menuToggle,'active');hide(el.menuOverlay);removeClass(el.menuContainer,'open');removeClass(document.body,'fixed');}
function bindEvents(){if(el.menuToggle){el.menuToggle.addEventListener('click',function(e){if(!hasClass(el.menuToggle,'active')){addClass(el.menuToggle,'active');show(el.menuOverlay);addClass(el.menuContainer,'open');addClass(document.body,'fixed');return;}
closeHeaderMenu();});}
for(var i=0;i<el.submenuToggles.length;i++){if(el.submenuToggles[i]){el.submenuToggles[i].addEventListener('click',handleSubMenuToggleClick);}}
function handleSubMenuToggleClick(e){e.preventDefault();var button;var buttonParent;var childElem;button=this;buttonParent=button.parentNode;childElem=buttonParent.querySelector('.jfly-submenu-element');if(button.classList.contains('jfly-submenu-toggle-login')&&!Mv.env.user.isLoggedIn){$(document).trigger("trigger-login-modal");return;}
if(document.body.clientWidth>windowWidthHeaderActions){for(var i=0;i<el.submenuToggles.length;i++){removeClass(el.submenuToggles[i],'active');}
for(i=0;i<el.submenuElements.length;i++){hide(el.submenuElements[i]);}}
if(!hasClass(buttonParent,'active')){addClass(buttonParent,'active');show(childElem);return;}
removeClass(buttonParent,'active');hide(childElem);}
function handleBodyMouseup(e){var container;if(document.body.clientWidth>windowWidthHeaderActions){container=document.querySelector('.jfly-submenu-wrapper.active');if(container!==e.target&&!isDescendant(e.target,container)){closeMenu();}}}
document.body.addEventListener('mouseup',handleBodyMouseup);document.body.addEventListener('touchstart',handleBodyMouseup);el.menuOverlay&&el.menuOverlay.addEventListener('click',closeHeaderMenu);el.myBookingsLink.addEventListener('click',triggerLoginModalWithRedirect);if(el.travelCreditsLink){el.travelCreditsLink.addEventListener('click',triggerLoginModalWithRedirect);}
function triggerLoginModalWithRedirect(e){if(!Mv.env.user.isLoggedIn){e.preventDefault();$(document).trigger('trigger-login-modal',{postLoginRedirectUrl:this.getAttribute('href')});}}}
function closeMenu(){for(var i=0;i<el.submenuWrappers.length;i++){removeClass(el.submenuWrappers[i],'active');}
for(i=0;i<el.submenuElements.length;i++){hide(el.submenuElements[i]);}}
function init(){var bodyClass;bodyClass=navigator.userAgent.indexOf('Android')!==-1?'is-android':'is-not-android';addClass(document.body,bodyClass);bindEvents();}
init();});;if(typeof console==="undefined"){console={log:function(){}};}
$(document).ready(function(){prepareStyledSelect();$(document).ajaxComplete(function(event,XMLHttpRequest,ajaxOptions){if(ajaxOptions.dataType=='html'){response=XMLHttpRequest.responseText;if(typeof response=='string'&&response.match('styled-select')){prepareStyledSelect();}}
else if(ajaxOptions.dataType=='json'){try{response=jQuery.parseJSON(XMLHttpRequest.responseText);}
catch(e){return;}
if(typeof response.html=='string'&&response.html.match('styled-select')){prepareStyledSelect();}
else if(typeof response.html=='object'){for(field_name in response.html){if(typeof response.html[field_name]!='string'||!response.html[field_name].match('styled-select')){continue;}
prepareStyledSelect();}}}});$('#select-country-dropdown-button').click(function(){if($('.select-country-dropdown').css('display')=='none')
$('.select-country-dropdown').show();else
$('.select-country-dropdown').hide();});var tc;$('.select-country-dropdown, #select-country-dropdown-button').mouseout(function(){tc=setTimeout("$('.select-country-dropdown').hide()",50);});$('.select-country-dropdown, #select-country-dropdown-button').mouseover(function(){clearTimeout(tc);});$('#select-currency-dropdown-button').click(function(){var currencyDropdown=$('.select-currency-dropdown');if(currencyDropdown.css('display')=='none'){currencyDropdown.show();}else{currencyDropdown.hide();}});var selectCurrencyMouseOutTimeOut;var selectCurrencyDropdown=$('.select-currency-dropdown, #select-currency-dropdown-button');selectCurrencyDropdown.mouseout(function(){selectCurrencyMouseOutTimeOut=setTimeout("$('.select-currency-dropdown').hide()",50);});selectCurrencyDropdown.mouseover(function(){clearTimeout(selectCurrencyMouseOutTimeOut);});});function toggleInfo(elem,target,arrows,showTxt,hideTxt,force_action){if(!hideTxt){hideTxt=showTxt;}
else if(hideTxt===true){hideTxt=showTxt.replace('Show','Hide');}
var showTxtFull=showTxt+((arrows)?' <span class="icon dark-grey '+arrows+'">&#x25BE;</span>':'');var hideTxtFull=hideTxt+((arrows)?' <span class="icon dark-grey '+arrows+'">&#x25B4;</span>':'');if($(target).css('display')=='none'&&(!force_action||force_action!='close')){$(elem).html(hideTxtFull);$(target).css('display','block');}
else if(!force_action||force_action!='open'){$(elem).html(showTxtFull);$(target).css('display','none');}}
function winPop(dir,w,h){var cal=window.open(dir,"winPop","width="+w+",height="+h+",location=no,scrollbars=yes,top=30,left=30,screenx=30,screeny=30");}
function initializeTipsy(selector,position){switch(position){case 'north':grav='n';break;case 'south':grav='s';break;case 'east':grav='e';break;case 'west':grav='w';break;case 'north-west':grav='nw';break;case 'north-east':grav='ne';break;case 'south-west':grav='sw';break;case 'south-east':grav='se';break;}
$(selector+' .'+position).tipsy({gravity:grav,opacity:1,html:true});}
function padNumber(number,length){var str=''+number;while(str.length<length)
str='0'+str;return str;}
function prepareStyledSelect(){$('.styled-select').on('change',function(event){var name=$(this).attr('name');$(this).parent('a').find("span[rel='"+name+"']").html($(this).find("option:selected").text());});$('.select-wrapper').on('click',function(event){var name=$(this).attr('name');$('#'+name).focus();});$('.styled-select').each(function(){var name=$(this).attr('name');$(this).parent('a').find("span[rel='"+name+"']").html($(this).find("option:selected").text());});}
function printPop(url){var print_pop=window.open(url,'print_pop');}
function sharePop(package_id,search_id){Modal.open({html:$('#share_pop').html(),width:400,height:400});$('#modal_box input[name=search_id]').val(search_id);$('#modal_box input[name=package_id]').val(package_id);}
var bodyTag;function documentReady(readyFunction){try{document.addEventListener('DOMContentLoaded',function(){document.removeEventListener('DOMContentLoaded',arguments.callee,false);readyFunction();},false);}
catch(err){}}
function changeLanguageWarning(redirect_url){var params={url:'https://www.justfly.com/site/warning-language-change-modal',method:'POST',data:{'redirect_url':redirect_url},width:450,height:360}
Modal.openAjax(params);};var Modal={modal_selector:'#modal_box',overlay_selector:'#modal_overlay',modal_content_template:"<div class=\"container-modal\">\n<div class=\"modal-close-btn\"><a class=\"pointer\" onclick=\"Modal.close()\"><img src=\"https:\/\/www.justfly.com\/images\/icon-modal-close.png\" class=\"mobile-hide\" \/><\/a><\/div>\n<div class=\"container-modal-content\">[%content%]<\/div>\n<\/div>\n",unclosable:false,setContent:function(content)
{if(!$(this.modal_selector).length)
{$('body').append('<div id="'+this.modal_selector.replace('#','')+'">'+this.modal_content_template+'</div>');}
$(this.modal_selector+' div.container-modal-content').html(content);},open:function(params)
{if(typeof params!=='object')
{params={};}
this.unclosable=params.unclosable?true:false;this.load_content=typeof params.load_content==='undefined'?true:params.load_content;var parent=this;this.fullscreen=params.fullscreen===true;this.height=null;if(!this.fullscreen){this.width=params.width?params.width:300;this.height=params.height?params.height:'auto';this.top=params.top?params.top:null;}
this.additionalClasses=params.additionalClasses?params.additionalClasses:'';if(this.load_content)
{this.setContent(params.html);}
$(this.modal_selector+' .modal-close-btn').toggle(true);if(this.unclosable)
{if(!params.close_button)
{$(this.modal_selector+' .modal-close-btn').toggle(false);}
else
{$(this.modal_selector+' .modal-close-btn a').attr('onclick','');}}
var css={'display':'block','height':this.height};if(!this.fullscreen){css.position=params.position?params.position:'absolute';}
$(this.modal_selector).removeAttr('style').css(css);$(this.modal_selector).toggleClass("fullscreen",this.fullscreen);$(this.modal_selector).addClass(this.additionalClasses);if(!this.fullscreen&&$('body').innerWidth()>720)
{$(this.modal_selector).css({'width':this.width+'px'});}
if(!this.fullscreen){parent.reposition();}
if(!$(this.overlay_selector).length)
{$('body').append('<div id="'+this.overlay_selector.replace('#','')+'"></div>');}
$(this.overlay_selector).click(function(){if(!parent.unclosable)
{parent.close();}}).css({'display':'block'});if(!parent.unclosable)
{$(document).keyup(this._closeShortcut);}},reposition:function()
{var top=($(window).height()-$(this.modal_selector).height())/2;if(top<50)
{top=50;}
$(this.modal_selector).css({'z-index':25,'top':(this.top?this.top:$(window).scrollTop()+top)+'px','height':(this.height=='auto'?this.height:this.height+'px')});if($('body').innerWidth()>720)
{$(this.modal_selector).css({'left':'50%','margin-left':(this.width/2*-1)+'px'});}},openAjax:function(params)
{if(!params.url)
{return;}
var method='get';if(params.method)
{method=params.method;}
var data={};if(params.data)
{data=params.data;}
var parent=this;$.ajax({url:params.url,type:method,dataType:'json',data:data,success:function(data){delete params.url;params.html=data.html;parent.open(params);}});},close:function(type)
{$(this.modal_selector).attr('style','').hide();$(this.overlay_selector).hide();$(this.modal_selector).removeClass(this.additionalClasses);$(document).unbind('keyup',this._closeShortcut);},_closeShortcut:function(e)
{if(e.keyCode==27)
{Modal.close();}}};var SeatMapModal=$.extend({},Modal);SeatMapModal.modal_selector='#seatmaps_modal_box';SeatMapModal.modal_content_template=SeatMapModal.modal_content_template.replace('Modal.close','SeatMapModal.close');var airfare_modal_opener='standard';;function Calendar(params)
{this.searchMinDate={today:new Date()};this.searchMaxDate={today:new Date()};this.calendar_class='.search-calendar';this.format='yy-mm-dd';this.input_count='yy-mm-dd';this.min_days_diff=0;this.max_days_diff=0;this.start_day_limit=0;this.language='en';this._setDefaultValues=function()
{this.searchMinDate={today:new Date()};this.searchMaxDate={today:new Date()};this.format='yy-mm-dd';this.input_count='yy-mm-dd';this.min_days_diff=0;this.max_days_diff=0;this.start_day_limit=0;};this.resetMinDate=function()
{if(!this.searchMinDate[this.calendar_class])
this.searchMinDate[this.calendar_class]={};var parent=this;var date_patt=/^([\d]{4})-([\d]{2})-([\d]{2})$/;$(this.calendar_class).each(function(i){if(i>0)
{previousSegmentCurrentDate=$($(parent.calendar_class+':eq('+(i-1)+')')).val();if(previousSegmentCurrentDate)
{matches=date_patt.exec(previousSegmentCurrentDate);if(matches!=null)
{parent.searchMinDate[parent.calendar_class][i]=new Date(matches[1],(parseInt(matches[2],10)-1),matches[3]);parent.searchMinDate[parent.calendar_class][i].setDate(parent.searchMinDate[parent.calendar_class][i].getDate()+parent.min_days_diff);}
else
{parent.searchMinDate[parent.calendar_class][i]=parent.searchMinDate.today;}}}
else
{parent.searchMinDate[parent.calendar_class][i]=parent.searchMinDate.today;}
var next_selector=parent.calendar_class+':eq('+(i+1)+')';if(false&&$(next_selector).length&&$(next_selector).datepicker('getDate'))
{if($(this).datepicker('getDate')>$(next_selector).datepicker('getDate'))
{var new_date=$(next_selector).datepicker('getDate');new_date.setDate(new_date.getDate()+7);if(!$(parent.calendar_class+':eq('+(i+2)+')').val()||($(parent.calendar_class+':eq('+(i+2)+')').val()&&new_date<$(parent.calendar_class+':eq('+(i+2)+')').datepicker('getDate')))
{$(next_selector).datepicker('setDate',new_date);}}}
$(this).datepicker('option','minDate',parent.searchMinDate[parent.calendar_class][i]);});};this.resetMaxDate=function()
{if(!this.max_days_diff)
{return;}
if(!this.searchMaxDate[this.calendar_class])
this.searchMaxDate[this.calendar_class]={};var parent=this;var date_patt=/^([\d]{4})-([\d]{2})-([\d]{2})$/;$(this.calendar_class).each(function(i){if(i>0)
{previousSegmentCurrentDate=$($(parent.calendar_class+':eq('+(i-1)+')')).val();if(previousSegmentCurrentDate)
{matches=date_patt.exec(previousSegmentCurrentDate);if(matches!=null)
{parent.searchMaxDate[parent.calendar_class][i]=new Date(matches[1],(parseInt(matches[2],10)-1),matches[3]);if(parent.max_days_diff!==null)
{parent.searchMaxDate[parent.calendar_class][i].setDate(parent.searchMaxDate[parent.calendar_class][i].getDate()+parent.max_days_diff);}
else
{parent.searchMaxDate[parent.calendar_class][i]=parent.searchMaxDate.today;}}
else
{parent.searchMaxDate[parent.calendar_class][i]=parent.searchMaxDate.today;}}}
else
{parent.searchMaxDate[parent.calendar_class][i]=parent.searchMaxDate.today;}
$(this).datepicker('option','maxDate',parent.searchMaxDate[parent.calendar_class][i]);});};this._setDefaultValues();today=new Date();for(param_name in params)
{if(typeof this[param_name]!=='undefined')
{this[param_name]=params[param_name];}}
this.input_count=$(this.calendar_class).length;this.searchMinDate.today=new Date(today.getFullYear(),today.getMonth(),today.getDate()+this.start_day_limit);this.searchMaxDate.today=new Date(today.getFullYear()+1,today.getMonth(),today.getDate()+this.start_day_limit);this.resetMinDate();this.resetMaxDate();$(this.calendar_class).datepicker('destroy');var parent=this;var options={showAnim:'fadeIn',dateFormat:parent.format,minDate:parent.searchMinDate.today,showCurrentAtPos:0,numberOfMonths:2,beforeShow:function(){setTimeout(function(){$('#ui-datepicker-div').css({'z-index':30,'width':'auto'});},100);},onSelect:function(a,b){if(!parent.searchMinDate[parent.calendar_class])
{parent.searchMinDate[parent.calendar_class]={};}
parent.resetMinDate();parent.resetMaxDate();}}
if($(window).width()<=480)
{options.numberOfMonths=1;}
if(parent.max_days_diff)
{parent.searchMaxDate.today=new Date((today.getFullYear()+1),today.getMonth(),today.getDate());options.maxDate=parent.searchMaxDate.today;}
$.datepicker.setDefaults($.datepicker.regional[parent.language]);$(this.calendar_class).each(function(cal_pos,e)
{$(this).datepicker(options);if(parent.max_days_diff)
{$(this).datepicker('option','maxDate',parent.searchMaxDate[parent.calendar_class][cal_pos]);}});this.resetMinDate();this.resetMaxDate();};;var HotelFilter={amenities:[],min_price:0,max_price:0,search_id:'',_mergeParams:function(params)
{for(param_name in params)
{if(typeof this[param_name]=='object')
{if(typeof params[param_name]!='object')
{continue;}
for(sub_param_name in params[param_name])
{this[param_name][sub_param_name]=params[param_name][sub_param_name];}}
else if(typeof this[param_name]!=='undefined')
{this[param_name]=params[param_name];}}},init:function(params)
{var parent=this;$('input[name=amenities]').change(function(){parent.amenitiesFilter();});$('input[name=neighborhoods]').change(function(){var search_filters={selected_area_id:$(this).attr('value')}
$('#destination').attr('value',$(this).attr('destination'));$('#region_id').attr('value',$(this).attr('value'));hotel_search.submit();});$(function(){var star_ratings=params.star_ratings;star_ratings.sort(function(a,b){return a-b});if(star_ratings.length!=6)
{var min_checkbox_value=Number(star_ratings[0]);var max_checkbox_value=Number(star_ratings[star_ratings.length-1]);$('.star-ratings[value='+min_checkbox_value+']').attr('checked','checked');$('.star-ratings[value='+max_checkbox_value+']').attr('checked','checked');for(var i=min_checkbox_value+1;i<=max_checkbox_value-1;i++)
{$('input[name=star-ratings]').each(function(){$('.star-ratings[value='+i+']').attr({'checked':'checked','disabled':'disabled'});});}}
var price_checkboxes=params.price_checkboxes;if(price_checkboxes.length!=0)
{var min_checkbox_value=Number(price_checkboxes[0]);var max_checkbox_value=Number(price_checkboxes[price_checkboxes.length-1]);$('.price-filter[value='+min_checkbox_value+']').attr('checked','checked');$('.price-filter[value='+max_checkbox_value+']').attr('checked','checked');for(var i=min_checkbox_value+1;i<=max_checkbox_value-1;i++)
{$('input[name=price-filter]').each(function(){$('.price-filter[value='+i+']').attr({'checked':'checked','disabled':'disabled'});});}}});$('input[name=star-ratings]').change(function(){var ratings=new Array();var min_rating;var max_rating;$('input[name=star-ratings]').each(function(){$(this).removeAttr('disabled');});$('input[name=star-ratings]:checked').each(function(){ratings.push($(this).val());});if(ratings.length==0)
{min_rating=0;max_rating=5;}
else if(ratings.length==1)
{min_rating=ratings[0];max_rating=min_rating;}
else
{ratings.sort(function(a,b){return a-b});min_rating=Number(ratings[0]);max_rating=Number(ratings[ratings.length-1]);var disabled_ratings=new Array();for(var i=min_rating+1;i<=max_rating-1;i++)
{disabled_ratings.push(i);}
if(disabled_ratings.length>0)
{for(var i=0;i<disabled_ratings.length;i++)
{$('.star-ratings[value='+disabled_ratings[i]+']').attr({'checked':'checked','disabled':'disabled'});}}}
parent.ratingFilter(min_rating,max_rating);});$('input[name=price-filter]').change(function(){var min_price;var max_price;var prices=new Array();var nums=new Array();var disabled_prices=new Array();$('input[name=price-filter]').each(function(){$(this).removeAttr('disabled');});$('input[name=price-filter]:checked').each(function(){prices.push($(this).attr('min'));prices.push($(this).attr('max'));nums.push($(this).val());});if(prices.length==0)
{min_price=0;max_price=999999;}
else
{prices.sort((function(a,b){return a-b}));min_price=Number(prices[0]);max_price=Number(prices[prices.length-1]);if(nums.length>1)
{nums.sort(function(a,b){return a-b});var min_num=Number(nums[0]);var max_num=Number(nums[nums.length-1]);for(var i=min_num+1;i<=max_num-1;i++)
{disabled_prices.push(i);}
if(disabled_prices.length>0)
{for(var i=0;i<disabled_prices.length;i++)
{$('.price-filter[value='+disabled_prices[i]+']').attr({'checked':'checked','disabled':'disabled'});}}}}
parent.priceFilter(min_price,max_price,nums);});$('input[name=name_contains]').keydown(function(event){if(event.keyCode==13)
{parent.nameFilter();}});this.search_id=params.search_id;},priceFilter:function(min,max,nums)
{var search_filters={current_min_price:min,current_max_price:max,prices:nums}
this.request(search_filters);},ratingFilter:function(min,max)
{var search_filters={min_rating:min,max_rating:max}
this.request(search_filters);},confidenceFilter:function(min,max)
{var search_filters={min_confidence:min,max_confidence:max}
this.request(search_filters);},nameFilter:function()
{var name_filter=$('input[name=name_contains]').val();if(name_filter=='')
{name_filter=-1;}
var search_filters={name_contains:name_filter};this.request(search_filters);},amenitiesFilter:function()
{var parent=this;parent.amenities=[];$('input[name=amenities]:checked').each(function(){parent.amenities.push($(this).attr('value'));});if(this.amenities.length==0)
{this.amenities.push(-1);}
var search_filters={amenities:parent.amenities};this.request(search_filters);},checkAllAmenities:function(param)
{if(param)
{$('input[name=amenities]').each(function(){$(this).attr('checked','checked');});}
else
{$('input[name=amenities]').each(function(){$(this).removeAttr('checked');});}
this.amenitiesFilter();},sortHotels:function(param,elem)
{$('.sort').removeClass('active');$(elem).addClass('active');var search_filters={sort_field:param};this.request(search_filters);},loadingBlock:function(message)
{if(!message)
{message='Updating your results, please wait...';}
$('#loading_filter [id=txt_content]').html('<strong>'+message+'</strong>');Modal.open({html:$('#loading_filter').html(),width:$('#loading_filter').css('width'),height:$('#loading_filter').css('height'),unclosable:true});},loadingUnblock:function()
{Modal.close();},loadPage:function(page_num)
{this.request({page:page_num},true);},request:function(search_filters,scroll_to_top)
{search_filters.search_id=this.search_id;var parent=this;parent.loadingBlock();setTimeout(function(){$.ajax({url:'https://www.justfly.com/hotel/filter',data:search_filters,type:'post',dataType:'json',success:function(data)
{if(data.result)
{parent.loadingUnblock();$('#result-packages').html(data.html.packages);$('.container-paging').html(data.html.pagination);if($('#total-packages').val())
{$('#num-packages').html($('#total-packages').val());}
else
{$('#num-packages').html("0");}}
if(scroll_to_top)
{$('html, body').animate({scrollTop:0},500);}}});},1);}};function ProgressBar(params){this.timer=0;this.completion=0;this.interval=1000;this.active=true;this.max_increase_speed=params.max_increase_speed?params.max_increase_speed:4;this.min_increase_speed=params.min_increase_speed?params.min_increase_speed:2;this.bar_selector=params.bar_selector;this.txt_selector=params.txt_selector;this.completeCallback=params.completeCallback?params.completeCallback:function(){};this.progress_txt=params.progress_txt?params.progress_txt:{};this.increaseProgressBar=function(){if(!this.active){return;}
this.completion+=Math.floor((Math.random()*this.max_increase_speed)+this.min_increase_speed);if($(this.bar_selector).length){var parent=this;$(this.bar_selector).animate({width:(parent.completion<100?parent.completion:100)+'%'},{duration:1000,queue:false,complete:function(){if(parent.completion<100){parent.timer=setTimeout(function(){parent.increaseProgressBar();},parent.interval);}else{parent.completeCallback();}}});}
this._displayLoadingTxt();};this.changeSpeed=function(min,max){this.min_increase_speed=min;this.max_increase_speed=max;};this.stop=function(){this.active=false;};this._displayLoadingTxt=function(){if($(this.txt_selector).length){var message='';for(var x in this.progress_txt){if(x<=this.completion){message=this.progress_txt[x];}}
$(this.txt_selector).html(message);}};this.clearTimeout=function(){this.completion=0;clearTimeout(this.timer);};this._displayLoadingTxt();$(this.bar_selector).css('width',0);this.timer=setTimeout((function(){this.increaseProgressBar();}).bind(this),this.interval);};var Validator={form_id:null,class_prefix:'.validate_',blur_callback:null,rules:{only_alpha_space:{"type":"regex","value":/^[a-z\s]*$/i,"msg":"Only characters and spaces are accepted"},only_alpha_space_dash:{"type":"regex","value":/^[a-z\s\-]*$/i,"msg":"The name you have provided is invalid. Please enter your name as it appears on your  %key1%"},only_alpha_space_dash_apostrophe:{"type":"regex","value":/^[a-z\s\-\"]*$/i,"msg":"The name you have provided is invalid. Please enter your name as it appears on your  %key1%"},only_numeric:{"type":"regex","value":/^[\d]*$/,"msg":"Only numbers are accepted"},only_phone_char:{"type":"regex","value":/^[\d\(\)\- ]*$/,"msg":"Only numbers are accepted"},only_numeric_space:{"type":"regex","value":/^[\d\s]*$/,"msg":"Only numbers and spaces are accepted"},only_alphanumeric_space:{"type":"regex","value":/^[\w\s]*$/,"msg":"Only numbers, letters and spaces are accepted"},only_alphanumeric:{"type":"regex","value":/^[\w]*$/,"msg":"Only numbers and letters are accepted"},no_special_characters:{"type":"regex","value":/^[a-z\d\s\-\.\:\,\'0-9]*$/i,"msg":"Please don't use special characters such as:  %key1%"},numeric_dash:{"type":"regex","value":/^[\d\-\.]*$/,"msg":"Only numbers, space and dash are accepted"},numeric_space_dash:{"type":"regex","value":/^([\d\s\-\.]*)$/,"msg":"Only numbers, space and dash are accepted"},gender:{"type":"regex","value":/^(m|f|M|F)$/,"msg":"Invalid gender type"},required:{"type":"not_equal","value":"","msg":"Please fill the required fields marked with *"},day:{"type":"between","value":[1,31],"msg":"Day out of range"},month:{"type":"between","value":[1,12],"msg":"Month out of range"},year:{"type":"greater_than","value":1900,"msg":"Year out of range"},year_future:{"type":"between","value":[2012,2030],"msg":"Year out of range"},cc_type:{"type":"enum","value":["AX","DS","CA","VI"],"msg":"Invalid card type"},cc_number_luhn:{"type":"cc_number_luhn","value":"","msg":"The credit card number you have provided is invalid. Please make sure it matches your card."},cc_number_type:{"type":"cc_number_type","value":"","msg":"You have provided an invalid  %key1% card number. Please make sure it matches your card."},cc_cvv_type:{"type":"cc_cvv_type","value":"","msg":"You have provided an invalid  %key1% cvv code. Please make sure it matches your card."},current_cc_expiry:{"type":"combined_current_cc_expiry","value":"","msg":"Current credit card is expired."},email:{"type":"regex","value":/^([a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})?$/,"msg":"Invalid email address"},terms:{"type":"checked","value":true,"msg":"You need to accept the terms and conditions."},field_length:{"type":"field_length","value":[],"msg":"Field length out of range"},phone_length:{"type":"phone_length","value":[],"msg":"Phone number too short. Make sure you provide your area code, if applicable"},combined_maxlength:{"type":"combined_maxlength","value":[],"msg":"The combined value of  %key1%  and  %key2% cannot exceed  %key3%  characters"},combined_dependancy:{"type":"combined_dependancy","value":[],"msg":"You must provide %key1%"},equals_to_field:{"type":"equals_to_field","value":/^(.*)_conf$/,"msg":"Email confirmation does not match"},region:{"type":"region","value":1,"msg":"Please fill the required fields marked with *"},password:{"type":"password","value":6,"msg":"Invalid password provided"},cuba_travel_reason:{"type":"not_equal","value":"Reason","msg":"Please enter a travel reason"}},fields:{name:['only_alpha_space_dash','field_length'],gender:['required','gender'],day:['required','only_numeric','day'],month:['required','only_numeric','month'],year:['required','only_numeric','year'],cc_type:['required','cc_type','cc_number_type','cc_cvv_type'],cc_number:['required','only_numeric_space','cc_number_luhn','cc_number_type','cc_cvv_type'],cc_cvv:['required','only_numeric_space','cc_cvv_type'],year_future:['required','year_future'],current_cc_expiry:['only_numeric_space','current_cc_expiry'],required:['required'],terms:['terms'],numeric:['only_numeric','field_length'],numeric_space:['only_numeric_space','field_length'],phone_char:['only_phone_char','field_length'],alphanumeric_space:['field_length','only_alphanumeric_space'],numeric_dash:['field_length','numeric_dash'],numeric_space_dash:['field_length','numeric_space_dash'],frequent_flyer:['only_alphanumeric_space'],region:['region'],freestring:['field_length','no_special_characters'],freestring_required:['field_length','no_special_characters','required'],cc_email:['required','email'],cc_email_conf:['required','email','equals_to_field'],contact_email:['email'],contact_email_conf:['email','equals_to_field'],pax_email:['combined_dependancy','email'],pax_email_conf:['email','equals_to_field'],pax_phone:['field_length','numeric_space_dash','phone_length'],special_request:['field_length'],password:['password'],password_conf:['password','equals_to_field'],required_password:['required','password'],required_email:['required','email'],required_phone:['required','only_phone_char'],},nonPayPalErrors:['cc_zip','billing_phone','cc_billing_address_line1','cc_city','cc_email','cc_email_conf'],init:function(form_id,blur_callback){this.form_id=form_id;this.blur_callback=blur_callback;for(field_name in this.fields){elem_selector=this.form_id+' '+this.class_prefix+field_name;$(elem_selector).keypress(function(){$(this).removeClass('error');});if(field_name==='current_cc_expiry'){$(elem_selector).change(innerValidate);}else{$(elem_selector).blur(innerValidate);}
function innerValidate(){Validator.validate(this,true);if(Validator.blur_callback){Validator.blur_callback($(this).attr('name'),Validator.errors[$(this).attr('name')]);}}}},validate_paypal_fields:function(){var isIE7=(navigator.userAgent.indexOf('MSIE 7')!=-1);var isIE8=(navigator.userAgent.indexOf('MSIE 8')!=-1);if(isIE7){return true;}
Validator.validate_all_errors=[];if(isIE8){this._validate_all_ie();}else{for(field_name in this.fields){elem_selector=Validator.form_id+' '+Validator.class_prefix+field_name;$(elem_selector).each(function(){value=Validator.validate('[id='+$(this).attr('id')+']');});}}
var count_error=0;for(field in Validator.errors){if(this.nonPayPalErrors.indexOf(field)>-1){continue;}
count_error++;}
return count_error===0;},validate_all:function(){var isIE7=(navigator.userAgent.indexOf('MSIE 7')!=-1);var isIE8=(navigator.userAgent.indexOf('MSIE 8')!=-1);if(isIE7){return true;}
Validator.validate_all_errors=[];if(isIE8){this._validate_all_ie();}else{for(field_name in this.fields){elem_selector=Validator.form_id+' '+Validator.class_prefix+field_name;$(elem_selector).each(function(){value=Validator.validate('[id='+$(this).attr('id')+']');});}}
var count_error=0;for(i in Validator.errors){count_error++;}
if(!count_error)
return true;else
return false;},_validate_all_ie:function(){var _elem_selector,_elem_selector_field;$.each(this.fields,function(field_name){elem_selector=Validator.form_id+' '+Validator.class_prefix+field_name;_elem_selector=$(elem_selector)[0];if(_elem_selector!=undefined){_elem_selector_field='[name='+_elem_selector.name+']';value=Validator.validate(_elem_selector_field);}});},validate:function(elem,onblur_validate){var _elem=$(elem)[0];if(_elem.id==="cc_billing_address_line1"||_elem.id==="cc_billing_address_line2"||_elem.id==="cc_city"||_elem.id==="cc_city"||$(_elem).hasClass('validate_freestring_required')){_elem.value=removeDiacritics(_elem.value);}
if(_elem.hasAttribute("disabled")){delete this.errors[_elem.id];return true;}
var field_rules;var class_list=_elem.className.split(/\s+/);for(i in class_list){if(class_list[i]==''){continue;}
class_patt=/^validate_(.*)$/;type_match=class_patt.exec(class_list[i]);if(!type_match||!type_match[1]){continue;}
else if(!this.fields[type_match[1]]){continue;}
field_rules=this.fields[type_match[1]];}
if(!field_rules)
return true;var cached_elem=elem;for(i in field_rules){var rule_name=field_rules[i];var rule=this.rules[rule_name];var valid;var patt=/^combined_/;var combined_rule=false;if(patt.exec(rule.type)){combined_rule=true;}
else if(rule_name=='cc_number_type'){combined_rule=true;}
if(rule_name=='cc_cvv_type'){elem='[name=cc_cvv]';}
else{elem=cached_elem;}
if(rule.type=='field_length'&&_elem.getAttribute('validateminlength')>0&&_elem.value.length==0){rule_name='required';rule=this.rules[rule_name];}
this.remove_server_errors(_elem.id);if(!this.apply_rule(elem,rule,onblur_validate)){var field_id=_elem.id;this.set_error(field_id?field_id:_elem.name,rule_name,this.get_error_msg(rule_name,_elem.name));if(combined_rule){this.set_error($(elem).attr('validatecombinedwith'),rule_name,this.get_error_msg(rule_name,_elem.name));}
valid=false;break;}
else{this.remove_error(_elem.id,rule_name);if(rule.type=='field_length'&&parseInt(_elem.getAttribute('validateminlength'))>0)
this.remove_error(_elem.id,'required');if(combined_rule)
this.remove_error(_elem.getAttribute('validatecombinedwith'),rule_name);valid=true;}}
this.apply_errors();return valid;},errors:{},set_error:function(field_id,error_type,message){if(!this.errors[field_id])
this.errors[field_id]={}
this.errors[field_id][error_type]=message;},remove_error:function(field_id,error_type){if(typeof Validator.errors[field_id]!="undefined"&&typeof Validator.errors[field_id][error_type]!="undefined"){delete Validator.errors[field_id][error_type];}
if(typeof Validator.errors[field_id]!="undefined"){var error_count=0;for(i in Validator.errors[field_id])
error_count++;if(!error_count)
delete Validator.errors[field_id];}},remove_server_errors:function(field_id){var patt=/^server_/;for(error_name in this.errors[field_id]){if(patt.exec(error_name)){this.remove_error(field_id,error_name);}}},remove_errors:function(field_id){delete Validator.errors[field_id];},apply_errors:function(){$(this.form_id).find('.error').removeClass('error');$(this.form_id).find('.select-wrapper').removeClass('input-error');$(this.form_id).find('.feedback-label').removeClass('active');$(this.form_id).find('.form-error').empty().hide();for(field_id in this.errors){for(error_type in this.errors[field_id]){var first=true;$('#'+field_id).closest('.select-wrapper').addClass('input-error');$('#'+field_id).siblings('.feedback-label').removeClass('active');$('#'+field_id).siblings('.feedback-label.invalid').addClass('active');$('#'+field_id).addClass('error').closest('.fields-row').find('.form-error:first').each(function(){if(first){if($(this).find('.error_'+error_type).length===0){$(this).show().append(Validator.get_error_html(field_id,error_type));}}
first=false;return;});}}},get_error_html:function(field_id,error_type){error_message_template='<div class="error_'+error_type+' form_validate validate-error"><span class="fa fa-warning"></span> %message%</div>';return error_message_template.replace(/%message%/,this.errors[field_id][error_type]);},get_error_msg:function(error_type,field_name){var patt=/^(.[^_]*)_(.*)$/;var field_name_parts=patt.exec(field_name);msg=this.rules[error_type].msg;switch(error_type){case 'required':if(field_name=='insurance_package'){msg='Please select one of the insurance options provided';}
break;case 'only_alpha_space_dash':case 'only_alpha_space_dash_apostrophe':var patt=/^cc_/;var patt_name=/_name$/;msg=msg.replace(/%key1%/,patt.exec(field_name)?'credit card':'passport');break;case 'only_numeric':msg=(field_name=='cc_cvv'?"The CVV code you have provided is invalid. Please make sure it matches your card.":msg);break;case 'combined_current_cc_expiry':msg="Current credit card is expired.";break;case 'combined_maxlength':msg=msg.replace(/%key1%/,'"First Name"');msg=msg.replace(/%key2%/,'"Last Name"');msg=msg.replace(/%key3%/,$('[name='+field_name+']').attr('validatemaxlength'));break;case 'combined_dependancy':switch(field_name_parts[2]){case 'frequent_flyer_plan_number':msg=msg.replace(/%key1%/,'a Frequent Flyer Airline');break;case 'frequent_flyer_plan':msg=msg.replace(/%key1%/,'your Frequent Flyer number');break;case 'pax_email':case 'pax_email_conf':msg=msg.replace(/%key1%/,'an email for your primary contact');break;case 'mobile_phone_area':msg=msg.replace(/%key1%/,'an area code for your primary contact');break;case 'mobile_phone':msg=msg.replace(/%key1%/,'a phone number for your primary contact');break;default:msg=msg.replace(/%key1%/,$('[name='+field_name+']').attr('validatecombinedwith'));break;}
break;case 'field_length':patt=/_last_name$/;if(field_name=='cc_cvv'){msg="The CVV code you have provided is invalid. Please make sure it matches your card.";}
else if(field_name=='cc_phone'||field_name=='cc_phone_area'){msg='The phone number you have provided is invalid. Please review.';}
else if(patt.exec(field_name)&&$('[name='+field_name+']').val().length<2)
{placeholder='passport';if(field_name=='cc_last_name')
placeholder='credit card'
msg='The name you have provided is invalid. Please enter your name as it appears on your {{placeholder}} (min. 2 characters).'.replace('{{placeholder}}',placeholder);}
break;case 'cc_number_type':case 'cc_cvv_type':case 'only_numeric_space':card_name=this.get_cc_type_name($('#cc_type_select').val());msg=msg.replace(/%key1%/,card_name);if(field_name=='cc_number')
msg=this.rules.cc_number_type.msg.replace(/%key1%/,card_name);break;case 'equals_to_field':var patt=/password/;if(patt.exec(field_name))
msg='Password confirmation does not match';break;case 'no_special_characters':patt=/[a-z\s\-\.\:\,0-9]/gi;invalid_chars=$('[name='+field_name+']').val().replace(patt,'');invalid_string=' ';for(var i=0;i<invalid_chars.length;i++){invalid_string+=invalid_chars[i];if(i<invalid_chars.length-1)
invalid_string+=', ';}
msg=msg.replace(/%key1%/,invalid_string);break;}
return msg;},get_cc_type_name:function(cc_type){switch(cc_type){case 'VI':return 'Visa';case 'CA':return 'Master Card';case 'DS':return 'Discovery Card';case 'AX':return 'American Express';default:return '';}},apply_rule:function(elem,rule,onblur_validate){var _elem=$(elem)[0];value=$.trim(_elem.value);field_name=_elem.name;onblur_validate=onblur_validate?true:false;try{switch(rule.type){case 'not_equal':if(field_name=='cc_zip'){country_code=$('[name=cc_country_code]').val();if(country_code!='US'&&country_code!='CA')
return true;}
return value!=rule.value;break;case 'equals_to_field':matches=$(elem).attr('name').match(rule.value);if($(elem).attr('name').indexOf("password")!=-1){return value==$(Validator.form_id+' [name='+matches[1]+']').val();}
else
{return value.toLowerCase()==$(Validator.form_id+' [name='+matches[1]+']').val().toLowerCase();}
break;case 'password':value=$(elem).val();if(value.length==0){return true;}
return value.length>=rule.value;break;case 'regex':return value.match(rule.value)?true:false;break;case 'between':return parseInt(value)>=rule.value[0]&&parseInt(value)<=rule.value[1];break;case 'greater_than':return value>rule.value;break;case 'lesser_than':return value>rule.value;break;case 'length_equal':return value.length==rule.value;break;case 'enum':for(x in rule.value){if(rule.value[x]==value)
return true;}
return false;break;case 'checked':return $(elem).prop('checked');break;case 'field_length':minlength=$(elem).attr('validateminlength');maxlength=$(elem).attr('validatemaxlength');if(!minlength)
minlength=0;if(!maxlength)
maxlength=200;return value.length>=minlength&&value.length<=maxlength;case 'phone_length':var length=$(elem).val().length;if(length==0){return true;}
return length>=6&&length<=15;case 'region':if($(elem+' option').length>1){return this.apply_rule(elem,this.rules.required);}
else{return true;}
case 'combined_maxlength':minlength=$(elem).attr('validateminlength');maxlength=$(elem).attr('validatemaxlength');combined_with=$(elem).attr('validatecombinedwith');if(!maxlength)
maxlength=200;if(!combined_with)
return true;combined_with_value=$(this.form_id+' [name='+combined_with+']').val();return(value.length+combined_with_value.length)<=maxlength;case 'combined_dependancy':if(onblur_validate){return true;}
combined_with=$(elem).attr('validatecombinedwith');is_radio=$('#'+combined_with).attr('type')=='radio';if(!$('#'+combined_with+(is_radio?':checked':'')).val()&&!$(elem).val()){return true;}
return $('#'+combined_with).val()&&$(elem).val()?true:false;case 'combined_current_cc_expiry':var currentYear=parseInt(new Date().getFullYear());var currentMonth=parseInt(new Date().getMonth())+1;var yearExpiryStr=$("#cc_expiry_year").val();var monthExpiryStr=$("#cc_expiry_month").val();if(!yearExpiryStr||!monthExpiryStr){return true;}
var yearExpiry=parseInt(yearExpiryStr);var monthExpiry=parseInt(monthExpiryStr);return yearExpiry>currentYear||(yearExpiry===currentYear&&monthExpiry>currentMonth);case 'cc_number_type':value=$('[name=cc_number]').val();value=value.replace(/\s*/g,'');var cc_type_found='';if(!value&&(field_name=='cc_type'||field_name=='cc_type_select')){return true;}
if(value){if(!cc_type_found&&value.length==16){n=51;cc_start=value.substring(0,2);while(n<=55){if(cc_start==n){cc_type_found='CA';break;}
n++;}
cc_start=value.substring(0,4);if(cc_start>=2221&&cc_start<=2720){cc_type_found='CA';}}
if(!cc_type_found&&(value.length==16||value.length==13)){if(value.substring(0,1)==4){cc_type_found='VI';}}
if(!cc_type_found&&value.length==15){n=34;cc_start=value.substring(0,2);cvv_length=4;while(n<=37){if(cc_start==n){cc_type_found='AX';break;}
n++;}}
if(!cc_type_found&&value.length==16){cc_start=value.substring(0,4);if(cc_start==6011){cc_type_found='DS';}
cc_start=value.substring(0,2);if(cc_start==65){cc_type_found='DS';}
cc_start=value.substring(0,6);if(cc_start>=622126&&cc_start<=622925){cc_type_found='DS';}
cc_start=value.substring(0,3);if(cc_start>=644&&cc_start<=649){cc_type_found='DS';}}}
if(!$('[name=cc_type], [name=cc_type_select]').val()){if($('[name=cc_type] option[value='+cc_type_found+'], [name=cc_type_select]  option[value='+cc_type_found+']').length>0){$('[name=cc_type], [name=cc_type_select]').prop('value',cc_type_found);$('[rel=cc_type_select] .select-first-text').html($('#cc_type_select option:selected').html())}}
if(cc_type_found)
$('[name=cc_type_select]').removeClass('error');return cc_type_found==$('[name=cc_type]').val();case 'cc_number_luhn':value=value.replace(/\D/g,'');if(value==5401999999999999){return true;}
var ca,sum=0,mul=1;var len=value.length;while(len--){ca=parseInt(value.charAt(len),10)*mul;sum+=ca-(ca>9)*9;mul^=3;};return(sum%10===0)&&(sum>0);case 'cc_cvv_type':if(value.length==0)
return true;var cvv_length;var cc_type_val;$.each($("[name='cc_type'], [name='cc_type_select']"),function(){if($(this).val()){cc_type_val=$(this).val();}});if(cc_type_val){if(cc_type_val=='AX')
cvv_length='4';else
cvv_length='3';$('[name=cc_cvv]').attr({'validateminlength':cvv_length,'validatemaxlength':cvv_length});}
else{$('[name=cc_cvv]').attr({'validateminlength':3,'validatemaxlength':4});}
return this.apply_rule(elem,this.rules.field_length);}}
catch(e){console.log(rule);}},applyErrorMessage:function(jquery_elem,message){if(jquery_elem.children('.validation_errors:eq(0)').length==0){jquery_elem.children('h1').after('<div class="validation_errors" style="display:block"></div>');$('.validation_error').show();}
jquery_elem.children('.validation_errors:eq(0)').append(message+'<br/>');}};function FlightSearch(params)
{this.form_selector='';this.airportsearch_field_class='';this.form_view_type='';this.segments_to_show='';this.current_trip_type='';this.minimal_display='';this.error_message_template='';this.Calendar={calendar_class:'.search-calendar',start_day_limit:0};this.AirportAutocomplete={};this.resetDefault=function()
{this.form_selector='form[name=air_search_form]';this.airportsearch_field_class='.airport_search';this.form_view_type='home';this.segments_to_show=2;this.min_segments_to_display_multi=1;this.show_hide_effect='showhide';this.current_trip_type='roundtrip';this.minimal_display=true;this.error_message_template='<div class="feedback-error">:error_message</div>';};this._mergeParams=function(params)
{for(param_name in params)
{if(typeof this[param_name]=='object')
{if(typeof params[param_name]!='object')
{continue;}
for(sub_param_name in params[param_name])
{this[param_name][sub_param_name]=params[param_name][sub_param_name];}}
else if(typeof this[param_name]!=='undefined')
{this[param_name]=params[param_name];}}};this._getNumDefaultSegmetsByType=function(flight_type)
{switch(flight_type)
{case 'roundtrip':return 1;case 'oneway':return 1;case 'multi':return(this.form_view_type!='landing3')?3:2;}};this.changeFlightTypeTab=function(flight_type,keep_input_values)
{this.closeTripType();if(flight_type!='roundtrip'&&flight_type!='multi'&&flight_type!='oneway')
{return;}
if(this.current_trip_type==flight_type)
{return;}
this.current_trip_type=flight_type;this.segments_to_show=this._getNumDefaultSegmetsByType(flight_type);var parent=this;this._reorganizeFormElements();this._showSegmentFields(keep_input_values);$(this.form_selector+' [name=flight_type]').attr('value',flight_type);$(this.form_selector+' .flight_type_button').removeClass('active');$(this.form_selector+' .flight_type_button_'+flight_type+'').addClass('active');$(this.form_selector+' .route-type-button').removeClass('active');$(this.form_selector+' .route-type-button[rel='+flight_type+']').addClass('active');this.Calendar.resetMinDate();$(this.form_selector+' .error').removeClass('error');};this._reorganizeFormElements=function()
{if(this.form_view_type=='home')
{this._reorganizeFormElementsDefault();}
else if(this.form_view_type=='widget')
{this._reorganizeFormElementsDefault();}
else if(this.form_view_type=='modal')
{this._reorganizeFormElementsDefault();}
else if(this.form_view_type=='sidebar')
{this._reorganizeFormElementsDefault();}
else if(this.form_view_type=='compact')
{this._reorganizeFormElementsCompact();}
else if(this.form_view_type=='landing')
{this._reorganizeFormElementsLanding();}
else if(this.form_view_type=='landing3')
{this._reorganizeFormElementsLanding3();}
else if(this.form_view_type=='landingGeneral')
{this._reorganizeFormElementsLandingGeneral();}};this._reorganizeFormElementsDefault=function()
{var seg1_date=$(this.form_selector+' .seg1_date_wrap').detach();$(this.form_selector+' .buttons-add-remove').hide();if(this.current_trip_type=='roundtrip')
{$(this.form_selector+' .wrap_seg0 .container-home-search-to:eq(0)').append(seg1_date);seg1_date_label='Return';}
else
{$(this.form_selector+' .wrap_seg1 .container-home-search-from:eq(0)').append(seg1_date);if(this.current_trip_type=='multi')
{$(this.form_selector+' .buttons-add-remove').show();}
seg1_date_label='Depart';}
$(this.form_selector+' .seg1_date_wrap strong').html(seg1_date_label);};this._reorganizeFormElementsCompact=function()
{if(this.current_trip_type!='roundtrip')
{$(this.form_selector+' .form-arrow').hide();$(this.form_selector+' [name=seg1_date]').hide();}};this._reorganizeFormElementsLanding=function()
{var seg0_to_li=$('#seg0_to_li').detach();var seg1_date_li=$('#seg1_date_li').detach();$(this.form_selector+' .buttons-add-remove').hide();if(this.current_trip_type=='roundtrip')
{$('#roundtrip_fields_right ul:eq(0)').append(seg0_to_li).append(seg1_date_li);$('.hp-fields-multi:eq(0)').removeClass('hp-fields-multi').addClass('hp-fields-left');$('.hptext-multi').removeClass('hptext-multi').addClass('hptext');$('.hp-fields-right').show();}
else
{$('#seg0_from_li').after(seg0_to_li);$('#wrap_seg1 ul').append(seg1_date_li);$('.hp-fields-left').removeClass('hp-fields-left').addClass('hp-fields-multi');$('input.hptext').removeClass('hptext').addClass('hptext-multi');$('.hp-fields-right').hide();if(this.current_trip_type=='multi')
{$(this.form_selector+' .buttons-add-remove').show();}}};this._reorganizeFormElementsLanding3=function()
{var seg1_date_input=$('#seg1_date').detach();var seg1_date_label=$('#seg1_date_label').detach();$('.form-type-button').removeClass('selected-form-button');var id=$('#'+this.current_trip_type).attr('id');$('#'+this.current_trip_type).addClass('selected-form-button');switch(this.current_trip_type)
{case 'roundtrip':$('#validation_errors').hide();$('.round-multi-trip-segment').show();$('.multiple-city-flight-number').hide();$('#multiple-city-form').hide();$('.seg1').hide();$('.multiple-city-flight-title').hide();$('#seg0_to_label_wrap').append(seg1_date_label);$('#seg0_to_input_wrap').append(seg1_date_input);break;case 'oneway':$('#validation_errors').hide();$('.round-multi-trip-segment').hide();$('#multiple-city-form').hide();$('.multiple-city-flight-number').hide();$('.multiple-city-flight-title').hide();$('#seg1_from_label_wrap').append(seg1_date_label);$('#seg1_from_input_wrap').append(seg1_date_input);break;case 'multi':$('#validation_errors').hide();$('.round-multi-trip-segment').show();$('.multiple-city-flight-number').show();$('#multiple-city-form').show();$('.multiple-city-flight-title').show();$('.seg1').show();$('#seg1_from_label_wrap').append(seg1_date_label);$('#seg1_from_input_wrap').append(seg1_date_input);break;}
if(this.current_trip_type=='multi')
{$('#seg1_date_label').html('Depart');}
else
{$('#seg1_date_label').html('Return');}};this._reorganizeFormElementsLandingGeneral=function()
{var seg1_date=$('.detachement').detach();$('.tabs-container').children().removeClass('selected-tab');$('.'+this.current_trip_type).addClass('selected-tab');$('#validation_errors').hide();switch(this.current_trip_type)
{case 'roundtrip':$('.return-field-first').append(seg1_date);$('.return-depart-name').html('').html('Return');$('.return-field-first').fadeIn();$('.multi-form').hide();$('.flight-count').hide();break;case 'oneway':$('#seg1_date').val('');$('.return-field-first').append(seg1_date);$('.return-field-first').fadeOut();$('.return-field-first').find('#seg1_date').val('');$('.multi-form').hide();$('.flight-count').hide();break;case 'multi':$('.multi-form').show();$('.flight-count').fadeIn();$('.seg1').find('.depart-return-wrapper').empty().append(seg1_date);$('.return-depart-name').html('').html('Depart');break;}};this.multiSegmentAddRemove=function(type,keep_input_values)
{switch(type)
{case 'add':this.segments_to_show++;break;case 'remove':this.segments_to_show--;break;default:return;}
if(this.segments_to_show>5)
{this.segments_to_show=5;}
else if(this.segments_to_show<1)
{this.segments_to_show=1;}
this._showSegmentFields(keep_input_values);this._reorganizeFormElements();};this.displayPassengers=function()
{var selector='[rel=passengers_select]';$(selector).css('display',$(selector).css('display')=='block'?'none':'block')
var t;$(selector+', #passengers_select').hover(function(e)
{clearTimeout(t);},function(e){var $target=$(e.target);if(!$target.is('option')&&!$target.is('select'))
{t=setTimeout("$('"+selector+"').hide()",200);}});};this.displayTripType=function()
{var selector='[rel=triptype_select]';$(selector).css('display',$(selector).css('display')=='block'?'none':'block')
var t;$(selector+', #triptype_select').mouseout(function(){t=setTimeout("$('"+selector+"').hide()",1000);});$(selector+', #triptype_select').mouseover(function(){clearTimeout(t);});};this.closeTripType=function()
{$('[rel=triptype_select]').hide();};this.updateNumPassengers=function()
{var num_passengers=0;$(this.form_selector).find('[rel=passengers_select] select').each(function(){num_passengers+=parseInt($(this).val());});$('#passengers_select div span').html(num_passengers+' Passenger'+(num_passengers>1?'s':''));};this.displaySeatClass=function()
{var selector='[rel=seat_class_select]';$(selector).css('display',$(selector).css('display')=='block'?'none':'block')
var t;$(selector+', #seat_class_select').mouseout(function(){t=setTimeout("$('"+selector+"').hide()",1000);});$(selector+', #seat_class_select').mouseover(function(){clearTimeout(t);});};this.updateSeatClass=function(elem)
{var seat_class=0;seat_class=$(elem).parent('li').find('label').html();$('#class_select div span').html(seat_class);};this._getCurrentTripTypeString=function()
{switch(this.current_trip_type)
{case 'roundtrip':return 'Round Trip';case 'oneway':return 'Oneway';case 'multi':return 'Multi';}};this._showSegmentFields=function(keep_input_values)
{switch(this.show_hide_effect)
{case 'slide':var showFunction='slideDown';var hideFunction='slideUp';break;default:var showFunction='show';var hideFunction='hide';}
for(var i=0;i<=5;i++)
{if(i<this.segments_to_show)
{$(this.form_selector+' .seg'+i)[showFunction]();}
else
{$(this.form_selector+' .seg'+i)[hideFunction]();if(!keep_input_values)
{$(this.form_selector+' .seg'+i).find('input').prop('value','');}}}};this.toggleMoreOptions=function()
{$('#more_options').slideToggle(200,function(){var arrow_direction=($('#more_options').css('display')=='block')?'up':'down';$('#more_options_arrow').attr('src','/images/icon-arrow-'+arrow_direction+'.png');});};this.toggleMoreOptionsLanding=function()
{var arrow_direction=($('#more_options').css('display')=='block')?'down':'up';var view_type=this.form_view_type;$('#more_options').slideToggle(200,function(){if(view_type=='landingGeneral')
{$('#more_options_arrow').attr('src','/images/cheap_flights_landing_4/icon-arrow-'+arrow_direction+'.png');}
else
{$('#more_options_arrow').attr('src','/images/icon-arrow-'+arrow_direction+'.png');}});};this.toggleCompactMinimalDisplay=function(force_open)
{var parent=this;$('.minimal_display').each(function(){if($(this).hasClass('buttons-add-remove')&&parent.current_trip_type!='multi')
{return;}
else if(force_open&&$('.minimal_display').css('display')=='block')
{return;}
$(this).slideToggle(200,function(){parent.minimal_display=$('.minimal_display').css('display')=='none';var toggle_text=$('#toggle_minimal_display_button span:eq(0)').html();$('#toggle_minimal_display_button span:eq(0)').html(toggle_text=='+'?'-':'+');});})};this.submit=function(originator,tryHotelCrossSearch)
{tryHotelCrossSearch=tryHotelCrossSearch||false;if(this.AirportAutocomplete.isSelectingValue())
{return;}
var errors={field_ids:[],error_messages:[],passenger_error:false,infant_passenger_error:false};var num_pax={'adults':0,'seniors':0,'children':0,'infants':0,'infants_lap':0};var parent=this;$(this.form_selector).find('input:visible, select:visible, [name^=num_]').each(function()
{if($(this).attr('name'))
{if(matches=$(this).attr('name').match(/seg(\d*)_(\w*)/))
{var has_value=false;$(parent.form_selector).find('[name^=seg'+matches[1]+'_]').each(function(){if($(this).val())
{has_value=true;}});switch(matches[2])
{case 'from':if($(this).val()=='')
{var append='.';if(parent.current_trip_type=='multi')
{var flight=$(this).attr('name').substring(3,4);flight++;append=' for flight No. '+flight+'.';}
errors.field_ids.push($(this).attr('id'));errors.error_messages.push('Please select a departure city'+append);}
break;case 'to':var append='.';if(parent.current_trip_type=='multi')
{var flight=$(this).attr('name').substring(3,4);flight++;append=' for flight No. '+flight+'.';}
if($(this).val()=='')
{errors.field_ids.push($(this).attr('name'));errors.error_messages.push('Please select a destination city'+append);}
else if($(this).val()==$(parent.form_selector+' [name=seg'+matches[1]+'_from]').val())
{errors.field_ids.push($(this).attr('name'));errors.error_messages.push('Your destination should be different from your departure'+append);}
break;case 'date':var append='.';if(parent.current_trip_type=='multi')
{var flight=$(this).attr('name').substring(3,4);flight++;append=' for flight No. '+flight+'.';}
if($(this).val()=='')
{var type=$(this).attr('name').substring(3,4);var date_type=type%2==0?'departure':'return';errors.field_ids.push($(this).attr('id'));errors.error_messages.push('Please select a '+date_type+' date'+append);}
else if(!$(this).val().match(/(\d{4})-(\d{2})-(\d{2})/))
{var type=$(this).attr('name').substring(3,4);var date_type=type%2==0?'departure':'return';errors.field_ids.push($(this).attr('name'));errors.error_messages.push('Invalid date format for the '+date_type+' date'+append);}
break;}}
else if(matches=$(this).attr('name').match(/num_(adults|seniors|infants|infants_lap|children)$/))
{num_pax[matches[1]]+=parseInt($(this).val());}
else if($(this).attr('name').match('fare_alert_email'))
{if($(this).val()!='')
{var email=$(this).val();var filter=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;if(!filter.test(email))
{errors.field_ids.push($(this).attr('id'));errors.error_messages.push('Please enter a valid email');}}}}});if(num_pax.adults+num_pax.children+num_pax.infants+num_pax.infants_lap==0)
{errors.field_ids.push('num_pax');errors.error_messages.push('Not enough passengers.');}
else if(num_pax.adults+num_pax.children+num_pax.infants+num_pax.infants_lap>9)
{errors.field_ids.push('num_pax');errors.error_messages.push('A maximum of 9 passengers is allowed per booking.');errors.max_passenger_error=true;}
else if(num_pax.infants+num_pax.infants_lap>num_pax.adults)
{errors.field_ids.push('num_pax');errors.error_messages.push('The number of infants cannot exceed the number of adults.');errors.infant_passenger_error=true;}
var error_count=0;for(k in errors.error_messages)
{if(errors.error_messages[k])
{error_count++;}}
if(error_count)
{this._applyErrorMessages(errors);return;}
$('#validation_errors').hide();var formValues=this._getFormValues();var flightSearchUrl=$(this.form_selector).attr('action')+'?'+$.param(formValues);if(tryHotelCrossSearch){processSearchSubmitForHotelCrossSearch(originator,flightSearchUrl,true,{selectedCurrency:'US',checkIn:formValues.seg0_date||"",checkOut:formValues.seg1_date||"",firstTo:$('[name="seg0_to"]').val()||"",seg0ToCode:$('[name="seg0_to_code"]').val(),firstToIsCity:$('[name="seg0_to"]').attr("data-auto-meta-is-city"),numAdt:formValues.num_adults||0,numChd:formValues.num_children||0,numIns:formValues.num_infants||0,numInl:formValues.num_infants_lap||0,tripType:this.current_trip_type,});}else{window.location.href=flightSearchUrl;}};this._getFormValues=function()
{var form_values=$(this.form_selector).serializeObject();for(field_name in form_values)
{if(form_values[field_name]==='')
{delete form_values[field_name];}}
if(form_values.form_type)
{delete form_values.form_type;}
for(var i=0;i<this.segments_to_show;i++)
{if(form_values['seg'+i+'_from_code'])
{form_values['seg'+i+'_from']=form_values['seg'+i+'_from_code'];delete form_values['seg'+i+'_from_code'];}
if(form_values['seg'+i+'_to_code'])
{form_values['seg'+i+'_to']=form_values['seg'+i+'_to_code'];delete form_values['seg'+i+'_to_code'];}}
if(this.current_trip_type=='roundtrip')
{form_values.seg1_from=form_values.seg0_to;form_values.seg1_to=form_values.seg0_from;}
return form_values;};this._applyErrorMessages=function(errors)
{$(this.form_selector+' .error').removeClass('error');for(x in errors.field_ids)
{if(errors.field_ids[x]=='num_pax')
{$('#passengers_select').addClass('error');if(this.form_view_type=='compact')
{this.toggleCompactMinimalDisplay(true);}}
else
{$('#'+errors.field_ids[x]).addClass('error');}}
error_string='';if(this.form_view_type=='compact')
{if(errors.max_passenger_error)
{error_string='A maximum of 9 passengers is allowed per booking.';}
else if(errors.infant_passenger_error)
{error_string='The number of infants cannot exceed the number of adults.';}
else
{error_string='Please make sure that all the fields are filled';}}
else
{for(x in errors.error_messages)
{error_string+=errors.error_messages[x];error_string+='<br/>';}}
$('#validation_errors').show().html(this.error_message_template.replace(':error_message',error_string));};this.resetDefault();this._mergeParams(params);var parent=this;autocomplete_params={};if(params.autocomplete_select_callback)
{autocomplete_params.autocomplete_select_callback=params.autocomplete_select_callback;}
parent.AirportAutocomplete=new AirportAutocomplete(autocomplete_params);parent.Calendar=new Calendar(parent.Calendar);$(parent.form_selector).find('[rel=passengers_select] select').change(function(){parent.updateNumPassengers();});$(parent.form_selector).find('[rel=seat_class_select] input[type=radio]').change(function(){parent.updateSeatClass(this);});$(parent.form_selector).find('option, select, input').keypress(function(e){if(e.which==13&&!parent.AirportAutocomplete.options_open)
{parent.submit();}});if(this.form_view_type=='landing3')
{this.min_segments_to_display_multi=2;this.show_hide_effect='slide';this.changeFlightTypeTab('multi');this.changeFlightTypeTab('roundtrip');}};function HotelSearch(params)
{this.form_selector='form[name=hotel_search_form]';this.form_view_type='';this.submit_type='default';this.rooms_drop_down_selector='#num_rooms';this.room_wrap_selector='#rooms_wrap';this.room_element_selector='.room_element';this.room_html_template='';this.room_replace_patt=':room_num:';this.num_children_element_selector='.num_children_element';this.child_age_wrap_selector='#room_:room_num:_children_ages';this.child_age_element_selector='.child_age_element';this.child_age_html_template='';this.child_replace_patt=':child_num:';this.error_selector='#feedback_message';this.error_html_template='<ul class="feedback-error"><li>:error_message:</li></ul>';this.calendar_field_selector='.search-calendar',this.form_values={};this.errors={count:0,field_names:[],error_messages:[]};this.resetDefault=function(){};this.Calendar={};this._mergeParams=function(params)
{for(param_name in params)
{if(typeof this[param_name]=='object')
{if(typeof params[param_name]!='object')
{continue;}
for(sub_param_name in params[param_name])
{this[param_name][sub_param_name]=params[param_name][sub_param_name];}}
else if(typeof this[param_name]!=='undefined')
{this[param_name]=params[param_name];}}};this._replacePatt=function(patt,replacement,subject)
{return subject.replace(new RegExp(patt,'g'),replacement);};this.updateNumRooms=function(num_rooms)
{$(this.rooms_drop_down_selector).prop('value',num_rooms);if($(this.room_element_selector).length>num_rooms)
{var parent=this;$(this.room_element_selector).each(function(i){if(i+1>num_rooms)
{$(this).remove();}});}
else if($(this.room_element_selector).length<num_rooms)
{var missing_rooms=num_rooms-$(this.room_element_selector).length;for(var i=0;i<missing_rooms;i++)
{var room_html=this._replacePatt(this.room_replace_patt,$(this.room_element_selector).length+1,this.room_html_template);$(this.room_wrap_selector).append(room_html);var parent=this;$(this.num_children_element_selector).change(function(){parent.updateChildAges($(this).attr('rel'),$(this).val());});}
prepareStyledSelect();}
return true;};this.addRoomAction=function()
{if(this.form_values['num_rooms']==9)
{return;}
this.form_values['num_rooms']++;this.updateNumRooms(this.form_values['num_rooms']);var parent=this;$(this.form_selector+' [name^="room'+this.form_values['num_rooms']+'"]').each(function(){parent.form_values[$(this).attr('name')]=parseInt($(this).val(),10);});this.updateFrontendCounters();}
this.removeRoomAction=function()
{if(this.form_values['num_rooms']==1)
{return;}
var last_room_key=this.form_values['num_rooms'];this.form_values['num_rooms']--;var room_patt=/^room([\d]{1,})/;for(field_name in this.form_values)
{matches=room_patt.exec(field_name);if(matches&&matches[1]==last_room_key)
{delete this.form_values[field_name];}}
rooms={};this.updateNumRooms(this.form_values['num_rooms']);this.updateFrontendCounters();};this.applyFormValues=function()
{var filtered_form_values={};var patt_child=/^room([\d]{1,})_children/;var patt_children_ages=/^room([\d]{1,})_children_ages$/;for(field_name in this.form_values)
{matches=patt_children_ages.exec(field_name);if(matches)
{children_ages=this.form_values[field_name].split(",");for(child_num in children_ages)
{filtered_form_values[field_name+'['+(parseInt(child_num,10)+1)+']']=children_ages[child_num];}}
else
{filtered_form_values[field_name]=this.form_values[field_name];}}
this.form_values={};this.form_values=filtered_form_values;var patt_children_ages=/^room([\d]{1,})_children_ages/;var children_ages={}
for(field_name in this.form_values)
{if(!patt_children_ages.test(field_name))
{element_selector=this.form_selector+' [name="'+field_name+'"]';$(element_selector).prop('value',this.form_values[field_name]);if(patt_child.test(field_name))
{this.updateChildAges($(element_selector).attr('rel'),$(element_selector).val());}}
else
{children_ages[field_name]=this.form_values[field_name];}}
for(field_name in children_ages)
{for(child_num in children_ages[field_name])
{$(this.form_selector+' [name="'+field_name+'"]').prop('value',children_ages[field_name]);}}
prepareStyledSelect();this.updateFrontendCounters();}
this.updateFrontendCounters=function()
{num_rooms=this.form_values['num_rooms'];num_travellers=0;travellers_patt=/^room[\d]{1,}_(children|adults)$/;for(field_name in this.form_values)
{if(travellers_patt.test(field_name))
{this.form_values[field_name]=parseInt($('[name="'+field_name+'"]').val(),10);num_travellers+=this.form_values[field_name];}}
$('#num_rooms_string').html(num_rooms+' Room'+(num_rooms>1?'s':''));$('#num_travellers_string').html(num_travellers+' Traveller'+(num_travellers>1?'s':''));};this.updateChildAges=function(room_num,num_children)
{var child_age_wrap_selector=this._replacePatt(this.room_replace_patt,room_num,this.child_age_wrap_selector);var child_age_element_selector=child_age_wrap_selector+' '+this.child_age_element_selector;if($(child_age_element_selector).length>num_children)
{var parent=this;$(child_age_element_selector).each(function(i){if(i+1>num_children)
{$(this).remove();}})}
else if($(child_age_element_selector).length<num_children)
{var missing_selects=num_children-$(child_age_element_selector).length;for(var i=0;i<missing_selects;i++)
{var child_age_html=this._replacePatt(this.child_replace_patt,$(child_age_element_selector).length+1,this.child_age_html_template);child_age_html=this._replacePatt(this.room_replace_patt,room_num,child_age_html);$(child_age_wrap_selector).append(child_age_html);}
prepareStyledSelect();}
return true;};this._addError=function(field_name,error_message)
{this.errors.count++;this.errors.field_names.push(field_name);this.errors.error_messages.push(error_message);};this._resetErrors=function()
{this.errors={count:0,field_names:[],error_messages:[]};};this._validate=function()
{this._resetErrors();var parent=this;$(this.form_selector).find('input, select').each(function(i){switch($(this).attr('name'))
{case 'destination':if(!$(this).val())
{parent._addError($(this).attr('name'),'Please specify your destination');}
break;case 'arrival_date':case 'departure_date':field_string=$(this).attr('name')=='arrival_date'?'checkin':'checkout';if(!$(this).val())
{parent._addError($(this).attr('name'),'Please specify your '+field_string+' date');}
else if(!$(this).val().match(/(\d{4})-(\d{2})-(\d{2})/))
{parent._addError($(this).attr('name'),'Invalid date format for the '+field_string+' date');}
break;case 'hotel_class':value=parseInt($(this).val(),10);if($(this).val()&&(value<0||value>5))
{parent._addError($(this).attr('name'),'Invalid selection for hotel class');}}});num_rooms_selector=this.form_selector+' [name=num_rooms]';num_rooms=parseInt($(num_rooms_selector).val(),10);if(!num_rooms)
{num_rooms=0;this._addError($(num_rooms_selector).attr('name'),'Please specify the number of rooms desired');}
else if(num_rooms>9)
{this._addError($(num_rooms_selector).attr('name'),'You cannot reserve more then 9 rooms on the same booking');}
for(var room_key=1;room_key<=num_rooms;room_key++)
{room_prefix='room'+room_key+'_';value=parseInt($(this.form_selector+' [name='+room_prefix+'adults]').val(),10);if(value<1)
{this._addError($(this.form_selector+' [name='+room_prefix+'adults]').attr('name'),'You need at least one adult per room');}
i=0;$(this.form_selector+' [name^='+room_prefix+'children_ages]').each(function(){if($(this).val()=='')
{parent._addError($(this).attr('name'),'Please specify the child\'s age');}
else if(parseInt($(this).val())>17)
{parent._addError($(this).attr('name'),'The age limit of a child guest is of 17 years');}});}
this._applyErrors();return this.errors.count>0?false:true;};this._applyErrors=function()
{$(this.form_selector+' .error').removeClass('error');for(x in this.errors.field_names)
{$(this.form_selector+' [name='+this.errors.field_names[x]+']').addClass('error');}
error_string='';for(x in this.errors.error_messages)
{error_string+=this.errors.error_messages[x];error_string+='<br/>';}
$(this.error_selector).html(this._replacePatt(':error_message:',error_string,this.error_html_template));if(error_string.length)
{$(this.error_selector).show();}};this.submit=function()
{if(this.LocationAutocomplete.isSelectingValue())
{return;}
if(this._validate())
{$(this.error_selector).hide();if(this.submit_type=='ajax')
{this._ajaxSubmit();}
else
{$(this.form_selector).submit();}}};this._ajaxSubmit=function()
{var form=new AjaxForm({form_selector:this.form_selector,feedback_selector:this.error_selector,preajax_callback:function(){HotelFilter.loadingBlock();},success_callback:function(data){if(data.redirect)
{window.location.href=data.redirect;return;}
$('#hotel-list-content').html(data.html);HotelFilter.loadingUnblock();},error_callback:function(data){if(data.redirect)
{window.location.href=data.redirect;}
HotelFilter.loadingUnblock();}});form.submit();};this.checkIfValidated=function()
{if(this._validate())
{$(this.error_selector).hide();return true;}}
this.LocationAutocomplete={max_results:15,field_class:'.location_search',options_open:false,options_open_timeout:null,open_field_cached_value:'',open_field_cached_object:'',init:function()
{try
{var parent=this;$(this.field_class).each(function(){var input_selector='#'+$(this).attr('id');var hidden_input_selector='#region_id';$(input_selector).keypress(function(e){if(e.which!=13&&e.which!=0)
{$(hidden_input_selector).attr('value','');}});$(input_selector).autocomplete({minLength:3,source:function(request,response){$(input_selector).addClass('loading-input');$.ajax({url:'https://www.justfly.com/hotel/autocomplete',type:'GET',dataType:'json',data:{'max_results':parent.max_results,term:request.term},success:function(data){$(input_selector).removeClass('loading-input');response($.map(data,function(item){return{label:item.name,value:item.name,region_id:item.region_id}}));$(hidden_input_selector).attr('value','');},error:function(data){$(input_selector).removeClass('loading-input');$(hidden_input_selector).attr('value','');}});},select:function(event,ui){$(input_selector).attr('value',ui.item.label);$(hidden_input_selector).attr('value',ui.item.region_id);parent._setOptionsAsClosed();},focus:function(event,ui){$(input_selector).attr('value',ui.item.label);},change:function(event,ui){},open:function(event,ui){parent._setOptionsAsOpen(this);},close:function(event,ui){parent._setOptionsAsClosed();}});});}
catch(err){alert(err)}},_setOptionsAsOpen:function(field_object)
{this.open_field_cached_value=$(field_object).val();this.open_field_cached_object=field_object;this.options_open=true;clearTimeout(parent.options_open_timeout);},_setOptionsAsClosed:function()
{var parent=this;this.autocomplete_open_timeout=setTimeout(function(){parent.options_open=false;},200);},isSelectingValue:function()
{if(this.options_open)
{if($(this.open_field_cached_object).val()!=this.open_field_cached_value)
{return true;}
$(this.open_field_cached_object).autocomplete('close');this._setOptionsAsClosed();}
return false;}};this.resetDefault();this._mergeParams(params);this.updateNumRooms($(this.rooms_drop_down_selector).val());var parent=this;$(document).ready(function(){parent.LocationAutocomplete.init();this.Calendar=new Calendar({min_days_diff:1,max_days_diff:28,calendar_class:parent.calendar_field_selector,start_day_limit:0});$(parent.form_selector).find('select[name=num_rooms]').change(function(){parent.updateNumRooms($(this).val());});$(parent.form_selector).find('option, select, input').keypress(function(e){if(e.which==13&&!parent.LocationAutocomplete.options_open)
{parent.submit();}});parent.applyFormValues();});};var MarketingAds={current_code:'',current_city:'',initial_city:'',initial_code:'',show_code_display:false,init:function(code,city)
{this.current_code=code;this.current_city=city;},updateCode:function(code)
{this.current_code=code;},updateCity:function(city)
{this.current_city=city;},displayCity:function()
{if(this.show_code_display==true)
{return this.current_city+' ['+this.current_code+']';}
else
{return this.current_city;}},createTextBox:function()
{this.validationMarkUp('off');$('.expand-arrow-flight').addClass('expand-arrow-text-enter');$('.from-name').hide();$('.from-autocomplete').show();$('#deals_airport').val(this.displayCity());$('#deals_airport').focus();if($('#deals_airport_code').val()=='')
{var is_exist=this.displayCity().indexOf("[");if(is_exist!=-1)
{$('#deals_airport_code').val(this.current_code);}}},removeTextBox:function(city,code)
{$('.expand-arrow-flight').removeClass('expand-arrow-text-enter');if(code!='')
{if(code!=this.current_code)
{this.updateCode(code);this.updateCity(city);this.validationMarkUp('off');}}
$('.from-name').show().text(this.displayCity());$('.from-autocomplete').hide();},validationFlightCodeIsPass:function(code)
{if(code=='')
{return false;}
else
{return true;}},validationMarkUp:function(toggle)
{if(toggle=='on')
{$('.deals-airport-validation').fadeIn();$('#deals_airport').css('border','1px solid #F00');}
else
{$('.deals-airport-validation').hide();$('#deals_airport').css('border','1px solid #dcdcdc');}},getFlightDataTable:function(from,default_continents)
{var default_string='';for(var i=0;i<default_continents.length;i++)
{default_string+='default[]='+default_continents[i]+'&';}
default_string=default_string.slice(0,-1);console.log(default_string);$('.flight-list-table').children().fadeOut();$('.loading-message').show();$.ajax({url:'https://www.justfly.com/landing-flights/ajax-get-flight-table/?new_route='+from+'&'+default_string,dataType:'json',type:'POST',complete:function(){},success:function(data){$('.loading-message').hide();if(data.result)
{$('.flight-list-table').hide().html(data.html).fadeIn();}
else
{}},error:function(request,status,error){console.log(request.responseText);}})},flightAccordian:function(jq_this)
{var parent=jq_this;var paginator=parent.next().find('.expand-list-container');var is_showing=paginator.attr('is_showing');if(is_showing=='closed')
{paginator.fadeIn(500);paginator.attr('is_showing','open');}
else
{paginator.fadeOut(250);paginator.attr('is_showing','closed');}
parent.next('.list-accordian').animate({height:'toggle'},{duration:400});},_validateNextPrevious:function(this_next,this_previous,step_min,step_max)
{if(step_min==1)
{this_previous.addClass('previous-disable');this_next.removeClass('previous-disable');}
else if((step_min>1)&&(step_min<step_max))
{this_previous.removeClass('previous-disable');this_next.removeClass('previous-disable');}
else
{this_next.addClass('previous-disable');this_previous.removeClass('previous-disable');}},pageNext:function(jq_this)
{var parent=jq_this.parent().prev();var previous=jq_this.parent().find('.previous');var step_max=parent.attr('step_max');var step_min=parent.attr('step_min');jq_this.parent().find('.pagination-item').removeClass('pagination-selected');if(step_min<step_max)
{parent.animate({marginTop:"-=150px"},400);if(step_min==step_max)
{step_min=step_max;}
else
{step_min++;}
parent.attr('step_min',step_min);}
this._validateNextPrevious(jq_this,previous,step_min,step_max);jq_this.parent().find('.pagination-item:eq('+(step_min-1)+')').addClass('pagination-selected');},pagePrevious:function(jq_this)
{var parent=jq_this.parent().prev();var next=jq_this.parent().find('.next');var step_max=parent.attr('step_max');var step_min=parent.attr('step_min');jq_this.parent().find('.pagination-item').removeClass('pagination-selected');if((step_min<=step_max)&&(step_min>1))
{parent.animate({marginTop:"+=150px"},400);step_min--;parent.attr('step_min',step_min);}
this._validateNextPrevious(next,jq_this,step_min,step_max);jq_this.parent().find('.pagination-item:eq('+(step_min-1)+')').addClass('pagination-selected');},paginateButtons:function(jq_this)
{jq_this.parent().find('.pagination-item').removeClass('pagination-selected');var parent=jq_this.parent().prev();var next=jq_this.parent().find('.next');var previous=jq_this.parent().find('.previous');jq_this.addClass('pagination-selected')
var step_interval=jq_this.attr('step_interval');var step_max=parent.attr('step_max');var step_min=parent.attr('step_min');if(step_interval!=step_min)
{if(step_interval<step_min)
{var step_difference=step_min-step_interval;var to_move=(step_min-step_interval)*150;parent.animate({marginTop:"+="+to_move+"px"},400);step_min=parseInt(step_min,10)-parseInt(step_difference,10);parent.attr('step_min',step_min);}
if(step_interval>step_min)
{var step_difference=step_interval-step_min;var to_move=(step_interval-step_min)*150;parent.animate({marginTop:"-="+to_move+"px"},400);step_min=parseInt(step_min,10)+parseInt(step_difference,10);parent.attr('step_min',step_min);}}
this._validateNextPrevious(next,previous,step_min,step_max);}};var Matrix={matrix_selector:'#matrix',button_selectors:{'next':'.matrix_next','previous':'.matrix_previous'},max_step:0,max_to_slide:0,current_step:1,window_width:0,column_width:0,slide_lock:false,init:function(params)
{for(param_name in params)
{if(typeof this[param_name]!=='undefined')
{this[param_name]=params[param_name];}}
var num_columns=$(this.matrix_selector+' .slider .matrix-column').length;var step_width=$(this.matrix_selector+' .matrix-column:eq(0)').width();var slider_width=num_columns*step_width;this.window_width=$(this.matrix_selector+' .matrix-middle:eq(0)').width();this.max_step=Math.ceil(slider_width/this.window_width);this.max_to_slide=slider_width-this.window_width;var parent=this;$(this.matrix_selector+' .slider').css('width',slider_width+'px');$(this.matrix_selector+' '+this.button_selectors.next).click(function(){parent.slide('next');});$(this.matrix_selector+' '+this.button_selectors.previous).click(function(){parent.slide('previous');});},slide:function(direction)
{if(direction=='next'&&this.current_step==(this.max_step)||direction=='previous'&&this.current_step==1)
{return;}
if(direction=='next')
{this.current_step++;}
else
{this.current_step--;}
var amount_to_slide=(this.current_step-1)*(this.window_width);if(amount_to_slide>this.max_to_slide)
{amount_to_slide=this.max_to_slide;}
var parent=this;$('.slider').animate({'margin-left':(-1*amount_to_slide)+'px'},500,function(){parent.slide_lock=false;});}};function AjaxForm(params)
{this._double_submit=false;this.ajax_icons={loading:'https://www.justfly.com/images/ajax-loader.gif',success:'https://www.justfly.com/images/ajax-success.png',error:'https://www.justfly.com/images/ajax-error.png'}
this.ajax_icon_selector=params.ajax_icon_selector?params.ajax_icon_selector:'.ajax_loading';this.form_selector=params.form_selector;this.feedback_selector=params.feedback_selector?params.feedback_selector:'#feedback_message';this.ajax_url='';this.ajax_type='';this.ajax_data=params.ajax_data;this.validate=params.validate?params.validate:function(){return true};this.preajax_callback=params.preajax_callback?params.preajax_callback:function(){};this.success_callback=params.success_callback?params.success_callback:function(data){};this.error_callback=params.error_callback?params.error_callback:function(data){};this.submit=function()
{var parent=this;if(parent._double_submit)
{return false;}
else if(!parent.validate())
{return false;}
else
{parent._double_submit=true;}
parent.clearFeedback();parent.displayLoadingIcon(parent.form_selector);parent.preajax_callback();$.ajax({url:parent.ajax_url,type:parent.ajax_type,dataType:'json',data:parent.ajax_data?parent.ajax_data:$(parent.form_selector).serialize(),success:function(data){parent._double_submit=false;if(data.result)
{parent.displayResultIcon(parent.form_selector,'success');parent.success_callback(data);}
else
{parent.displayResultIcon(parent.form_selector,'error');parent.error_callback(data);}
parent.printFeedback(data.feedback_message,false);},error:function(data){parent._double_submit=false;parent.displayResultIcon(parent.form_selector,'error');parent.error_callback(data);}});}
this.printFeedback=function(message,auto_close)
{var parent=this;if(!message)
{return false;}
$(parent.feedback_selector).show().html(message);if(auto_close)
{setTimeout(function(){$(parent.feedback_selector).slideUp(250,function(){$(this).empty().css('display','block');})},3500);}}
this.clearFeedback=function()
{var parent=this;$(parent.feedback_selector).empty().hide();}
this.displayLoadingIcon=function()
{if($(this.form_selector+' '+this.ajax_icon_selector+':eq(0)').length)
{$(this.form_selector+' '+this.ajax_icon_selector+':eq(0)').show().attr('src',this.ajax_icons.loading);}}
this.displayResultIcon=function(type)
{if(type!='error'&&type!='success')
{$(this.form_selector+' '+this.ajax_icon_selector+':eq(0)').hide();return;}
$(this.form_selector+' '+this.ajax_icon_selector+':eq(0)').attr('src',this.ajax_icons[type]).show();var parent=this;setTimeout(function()
{},2000);}
this.ajax_url=params.ajax_url?params.ajax_url:$(this.form_selector).attr('action');this.ajax_type=params.ajax_type?params.ajax_type:$(this.form_selector).attr('method');var parent=this;$(this.form_selector).find('option, select, input').keypress(function(e){if(e.which==13)
{parent.submit();}});$(this.form_selector).attr('onsubmit','return false;')};;var HotelPromo={loadedResults:false,ssl:true,fetch:function(flight_search_id,num_results,seg0_to,arrival_date,departure_date,promo_view)
{var parent=this;$.ajax({url:'https://www.justfly.com/hotel/fetch-promo'+(this.ssl?'-ssl':''),type:'POST',dataType:'json',data:{'flight_search_id':flight_search_id,'seg0_to':seg0_to,'arrival_date':arrival_date,'departure_date':departure_date,'num_rooms':1,'room1_adults':2,'num_results':(num_results>10?10:num_results),'promo_view':promo_view},success:function(data){if(data.result&&$('#hotel-promo').length)
{$('#hotel-promo').show().html(data.html);}
else
{this.error();}},error:function(){$('#hotel-promo-wrap').hide();}});}};var carsTabIsActive=false;function isMobile(){return $(window).width()<=649;}
$.fn.extend({showCustomTooltip:function(content){var self=$(this);toolTipsterContent=$(content);self.tooltipster({delay:0,content:toolTipsterContent.html(),contentAsHTML:true,theme:'bgp-tooltip',maxWidth:400});}});function activateHoverTooltips(){$('.js-tooltipster-trigger').each(function(){var self=$(this);$(this).tooltipster({content:self.find('.js-tooltipster-content').html(),contentAsHTML:true,delay:0,theme:'bgp-tooltip',maxWidth:400,interactive:true,});});$('.js-tooltipster-toggleable').each(function(){var self=$(this);$(this).tooltipster({content:self.find('.js-tooltipster-content').html(),contentAsHTML:true,delay:0,theme:'bgp-tooltip',maxWidth:400,trigger:'click',interactive:true});});}
function ffButtonHover(el){if($(el).hasClass('ff-ipad-btn')){if($(el).prev('.tooltip-test-text').css('visibility')==='visible'){$(el).prev('.tooltip-test-text').css('visibility','hidden');}else{$(el).prev('.tooltip-test-text').css('visibility','visible');}}};window.onpopstate=function(event){if(event.state&&event.state.gotoLocation){window.location=event.state.gotoLocation;}};(function($){var mainDoc=$(document);mainDoc.ready(function(){if($('.tooltip').size()>0){$('.tooltip').tooltipster({contentAsHTML:true,debug:false});}
if($('.tooltip-300').size()>0){$('.tooltip-300').tooltipster({maxWidth:300,contentAsHTML:true,debug:false});}
function attachToggleListeners(selector){$(selector).each(function(){$(this).click(function(event){event.preventDefault();var caller=$(this);var toggleElement=$(caller.attr('rel'));if(toggleElement.length>0){$(toggleElement).slideToggle();}});});}
attachToggleListeners(".toggleFixed");Mv.attachToggleListeners=attachToggleListeners;var lastToggleOpened=null;$('.toggle').each(function(){$(this).click(function(event){event.preventDefault();var caller=$(this);var toggleElement=$(caller.attr('rel'));if(toggleElement.length>0){if(toggleElement.is(':visible')){return false;}
$('.toggleElement').hide();toggleElement.addClass('toggleElement');toggleElement.mouseover(function()
{toggleElement.addClass('toggleHoverOn');});toggleElement.mouseout(function()
{toggleElement.removeClass('toggleHoverOn');});toggleElement.toggle({duration:250,queue:false,done:function(){if($(this).is(':visible')){setTimeout(function(){closeToggleElement(toggleElement);},1500);}}});}});});function closeToggleElement(el)
{if($(el).hasClass('toggleHoverOn')){setTimeout(function(){closeToggleElement(el);},500);}else{$(el).removeClass('toggleHoverOn').fadeOut(350);}}
if(Mv.env.user.isTouchDevice){loadClearInputButton();}
var dropDownOpened=false;var passengersContainer=$('#passengers');var theDropDown=null;mainDoc.on('click','.passenger-toggle',function(e){e.preventDefault();theDropDown=getToggleDropDown($(this));if(!theDropDown.hasClass('open')){theDropDown.addClass('open').show();var passengersPositionTop=passengersContainer.offset().top;var passengersHeight=passengersContainer.height();var passengerPositionBottom=passengersPositionTop+passengersHeight;if(!$('html').hasClass('search')&&$(window).width()<768&&$(window).height()<passengerPositionBottom){$('html, body').animate({scrollTop:passengersPositionTop-150});}
dropDownOpened=true;}});mainDoc.on('focus','.passenger-toggle',function(e){e.preventDefault;theDropDown=getToggleDropDown($(this));if(!theDropDown.hasClass('open')){theDropDown.addClass('open').show();dropDownOpened=true;}});mainDoc.on('focus','.main-search-form input, .main-search-form button, .form-field-to-date input, .form-field-button button ',function(e){e.preventDefault;closeAndUpdateTravelers();});mainDoc.on('click','.picker-button',function(e){e.preventDefault();var self=$(this);var pickerParent=self.closest('.passenger-picker');var pickerInput=pickerParent.find('.passengerType');var pickerData=pickerParent.find('.passengerType').data('field-id');var pickerQty=pickerParent.find('#'+pickerData);var pickerLimit=pickerParent.find('.passengerType').data('field-limit');var pickerMinimum=pickerParent.find('.passengerType').data('field-min');var updatedValue=0;var currentValue=parseInt(pickerInput.val());self.siblings('.picker-button').removeClass('disabled');if(self.is('.add')){if(currentValue<pickerLimit){updatedValue=currentValue+1;if(updatedValue==pickerLimit){self.addClass('disabled');}}else{return;}}else{if(currentValue>pickerMinimum){updatedValue=currentValue-1;if(updatedValue==pickerMinimum){self.addClass('disabled');}}else{return;}}
pickerInput.val(updatedValue).trigger('change');pickerQty.html(updatedValue);});$('body').on('update-passenger-count',function(){if(dropDownOpened){var totalPassengers=0;if(theDropDown.hasClass('hotel-rooms')){var roomCount=$('input[name="no_rooms"]').val();theDropDown.closest('.search-dropdown-toggle').find('.num-rooms').html(roomCount);}else if(theDropDown.hasClass('hotel-guests')){var adultCount=$('input[name="group_adults"]').val();var childrenCount=$('input[name="group_children"]').val();var adultHtml=adultCount+' Adult';if(adultCount>1){adultHtml=adultHtml+'s';}
var childrenHtml=' ';if(childrenCount>0){childrenHtml=', '+childrenCount;if(childrenCount>1){childrenHtml=childrenHtml+' Children';}else{childrenHtml=childrenHtml+' Child';}}
theDropDown.closest('.search-dropdown-toggle').find('.num-guests').html(adultHtml+childrenHtml);}else{theDropDown.find('.passengerType').each(function(){var theInput=$(this);var aux=parseInt(theInput.val());totalPassengers=totalPassengers+aux;});theDropDown.closest('.search-dropdown-toggle').find('.num-passengers').html(totalPassengers);}}});mainDoc.on('mouseup touchstart','.js-package-tooltip-trigger',function(e){e.preventDefault();var btnInfo=$(this);$('.has-hidden-content').removeClass('active');$('.is-hidden-content').hide();$('.js-package-tooltip-trigger').removeClass('active');$('.js-package-tooltip-content').hide();btnInfo.addClass('active');btnInfo.find('.js-package-tooltip-content').show();});mainDoc.on('mouseup touchstart',function(e){var container=$('.has-hidden-content.active');if(!container.is(e.target)&&container.has(e.target).length===0){$('.has-hidden-content').removeClass('active');$('.is-hidden-content').hide();}});mainDoc.on('click','.close-passenger-picker',function(e){e.preventDefault();e.stopPropagation();closeAndUpdateTravelers();});mainDoc.on('click',function(e){var container=$('.passenger-toggle');if(dropDownOpened){if(!container.is(e.target)&&container.has(e.target).length===0){closeAndUpdateTravelers();}}});var isHomePage=$('html').hasClass('home');var isMobileApp=$('html').hasClass('is-mobile-app');if(isHomePage){mainDoc.on('click','.search-selection-tab',function(e){e.preventDefault();var self=$(this);selectHomePageActiveSearchTab(self);});var urlHash=window.location.hash;if(urlHash){if(urlHash=='#hotels'){$('.main-search-form').hide();$('.search-selection-tab').removeClass('active');$('.search-selection-tab.hotels').addClass('active');$('.main-search-form.hotels').show();if(!isMobileApp){$('.hp-slogan').hide();$('.hp-slogan.hotels').show();}
hotelTabIsActive=true;carsTabIsActive=false;}else if(urlHash=='#cars'){$('.main-search-form').hide();$('.search-selection-tab').removeClass('active');$('.search-selection-tab.cars').addClass('active');$('.main-search-form.cars').show();if(!isMobileApp){$('.hp-slogan').hide();$('.hp-slogan.cars').show();}
hotelTabIsActive=false;carsTabIsActive=true;}else if(urlHash=='#cruises'){$('.main-search-form').hide();$('.search-selection-tab').removeClass('active');$('.search-selection-tab.cruises').addClass('active');$('.main-search-form.cruises').show();if(!isMobileApp){$('.hp-slogan').hide();$('.hp-slogan.cruises').show();}
hotelTabIsActive=false;cruisesTabIsActive=true;}}
function selectHomePageActiveSearchTab(tab){if(!tab.hasClass('active')){var dataTabTarget=tab.data('tab');selectHomePageSearchForm(dataTabTarget);tab.addClass('active');}}
function selectHomePageSearchForm(dataTabTarget){var targetForm=$('.main-search-form[data-tab-target="'+dataTabTarget+'"]');if(dataTabTarget=='search-hotels'){window.location.hash='hotels';hotelTabIsActive=true;carsTabIsActive=false;}else if(dataTabTarget=='search-cars'){window.location.hash='cars';hotelTabIsActive=false;carsTabIsActive=true;}else if(dataTabTarget=='search-cruises'){window.location.hash='cruises';hotelTabIsActive=false;cruisesTabIsActive=true;}else{window.location.hash='flights';hotelTabIsActive=false;carsTabIsActive=false;}
$('.search-selection-tab').removeClass('active');$('.main-search-form').hide();targetForm.fadeIn(300);if(!isMobileApp){var targetIntro=$('.hp-slogan[data-tab-text="'+dataTabTarget+'"]');$('.hp-slogan').hide();targetIntro.fadeIn(300);}}}
function getToggleDropDown(dropDownToggle){var self=dropDownToggle;dropDownTarget=self.data('dropdown');dropDownContainer=$('#'+dropDownTarget);return dropDownContainer;}
function closeAndUpdateTravelers(){$('.search-dropdown').removeClass('open').hide();$('body').triggerHandler('update-passenger-count');dropDownOpened=false;}
function loadClearInputButton(){var hasClearButton=false;var clearButton='<div class="clear-input"></div>';mainDoc.on('focus','.main-search-form input[type="text"]',function(e){var self=$(this);if(hasClearButton==false&&!self.attr('readonly')){self.addClass('has-clear');self.parent().prepend(clearButton);hasClearButton=true;}});mainDoc.on('blur','.main-search-form  input[type="text"]',function(e){if($('.clear-input').length){$('.clear-input').remove();$('.main-search-form  input[type="text"]').removeClass('has-clear');hasClearButton=false;}});mainDoc.on('mouseup touchstart','.clear-input',function(e){e.preventDefault();var self=$(this);var closestInput=self.siblings('input[type="text"]');closestInput.val('').focus();});}
if(Mv.env.user.isTouchDevice){$('body').addClass('is-touch');}else{$('body').addClass('not-touch');}
$('.custom-tooltip').showCustomTooltip('.custom-tooltip-content');activateHoverTooltips();});})(jQuery);(function($,document){function prepareStyledSelect(){$('.select-wrapper').on('change','.styled-select',function(event){var name=$(this).attr('name');$(this).parent('a').find("span[rel='"+name+"']").html($(this).find("option:selected").text());});$('.select-wrapper').on('click',function(event){var name=$(this).attr('name');$('#'+name).focus();});$('.styled-select').each(function(){var name=$(this).attr('name');$(this).parent('a').find("span[rel='"+name+"']").html($(this).find("option:selected").text());});}
$(document).ready(prepareStyledSelect);})(jQuery,document);(function($,document){function trackPhoneLink(){$('.site-header-phone-number').on('click',function(e){e.preventDefault();Mv.SEM.trackGoogleRemarketing({phoneLink:true});window.location=$(this).attr('href');});}
$(document).ready(trackPhoneLink);})(jQuery,document);(function($,document){function initCustomHtmlDropDown(){var mainDoc=$(document);mainDoc.on('click','.js-custom-dropdown-selected',function(e){e.preventDefault();var self=$(this);var selfParent=self.closest('.js-custom-dropdown');$('.js-custom-dropdown').removeClass('active');$('.js-custom-dropdown-list').hide();if(!selfParent.hasClass('active')){selfParent.addClass('active').find('.js-custom-dropdown-list').show();}else{selfParent.removeClass('active').find('.js-custom-dropdown-list').hide();}});mainDoc.on('mouseup touchstart',function(e){var container=$('.js-custom-dropdown-list');if(!container.is(e.target)&&container.has(e.target).length===0){$('.js-custom-dropdown').removeClass('active');$('.js-custom-dropdown-list').hide();}});}
$(document).ready(initCustomHtmlDropDown);})(jQuery,document);;Mv.airportAutoComplete=function(els,selCallback,resetCallback,optsArg){var autoCompleteList;var autoCompleteItems;var currentInput=null;var focusedIndex=null;var inputEvent="input";var isIE9;var lastClicked=null;var opts;var originalVal=null;var reqCount=0;var reqHighest=0;var KEY_CODES;var isMouseFocusEnable=false;var activeSearchBoxDirection;var backspaceCounter=0;var keystrokeCounter=0;var lastStringInputted="";var lastActionIsClick=false;var planeIcon=`<svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.10526 5.11884L14 8.8421V10.3158L8.10526 8.45453V12.404L10.3158 13.6316V14.7368L7 14L3.68421 14.7368V13.6316L5.89474 12.4033V8.45379L0 10.3158V8.8421L5.89474 5.11884V1.10526C5.89474 0.812129 6.01118 0.531001 6.21846 0.323724C6.42574 0.116447 6.70687 0 7 0C7.29313 0 7.57426 0.116447 7.78154 0.323724C7.98882 0.531001 8.10526 0.812129 8.10526 1.10526V5.11884Z" fill="#2f4265"/>
</svg>
`
var cityGroupIcon=`<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.33624 2.84003L1.17627 10L0 8.82373L7.15914 1.66376H0.849347V0H10V9.15065H8.33624V2.84003V2.84003Z" fill="#2f4265"/>
</svg>

`
if(els===void 0){return;}
if((isIE9=navigator.userAgent.indexOf("MSIE 9")!==-1))inputEvent="keyup";opts={autoCompleteList:{tag:"ul",classes:"ui-autocomplete ui-front ui-menu ui-widget ui-widget-content airport-autocomplete",id:"airports-auto-complete-menu"},autoCompleteItems:{tag:"li",classes:"ui-menu-item",focusClass:"ui-state-focus"},resetButton:{tag:"div",classes:"clear-input",activeInputClass:"has-clear"},isRedesignEnabled:window.isAutocompleteRedesignEnabled,preventAutoFocusClass:"prevent-auto-focus",endpoint:Mv.env.app.dataBaseUrl+"airports/autocomplete",esendpoint:'https://www.justfly.com/'+"airports/autocomplete",endpointForXp:Mv.env.app.dataBaseUrl+"airports/get-xp",endpointForBehaviorTracking:'https://www.justfly.com/'+"airports/airportSuggestionsBehavior",maxResults:15};$.extend(true,opts,(optsArg||{}));KEY_CODES={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,TAB:9,BACKSPACE:8};autoCompleteList=$(document.createElement(opts.autoCompleteList.tag)).addClass(opts.autoCompleteList.classes).attr("id",opts.autoCompleteList.id).hide();for(var i=0;i<opts.maxResults;i++){autoCompleteList.append($(document.createElement(opts.autoCompleteItems.tag)).addClass(opts.autoCompleteItems.classes).attr("data-id",i).hide());}
$("body").append(autoCompleteList);autoCompleteList=$('#'+opts.autoCompleteList.id);autoCompleteItems=autoCompleteList.find(opts.autoCompleteItems.tag);els.on(inputEvent,handleInput);els.on("blur",handleBlur);els.on("keydown",handleKeyDown);els.on("focus",handleFocus);autoCompleteList.on("mousemove",function(){isMouseFocusEnable=true;});autoCompleteItems.off("mousedown").on("mousedown",function(){focusAirport($(this).data("id"),true);lastActionIsClick=true;$.post(opts.endpointForBehaviorTracking,{direction:activeSearchBoxDirection,lastString:lastStringInputted,backspaces:backspaceCounter,keystrokes:keystrokeCounter,clickedSuggestionName:$(this).text(),clickedSuggestionRank:$(this).data("id")+1,totalSuggestions:autoCompleteItems.filter(":visible").length},function(data){if(data.result===false){console.error('Event not sent');}});});$(window).on('unload',function(){if(lastStringInputted!==""){var params={direction:activeSearchBoxDirection,lastString:lastStringInputted,backspaces:backspaceCounter,keystrokes:keystrokeCounter,clickedSuggestionName:"",clickedSuggestionRank:lastActionIsClick?1:0,totalSuggestions:autoCompleteItems.filter(":visible").length};var fd=new FormData();for(var key in params){fd.append(key,params[key]);}
navigator.sendBeacon(opts.endpointForBehaviorTracking,fd);}})
$(document).off("mousedown",'div[class="form-field-button"]').on("mousedown",'div[class="form-field-button"]',function(){lastStringInputted="";backspaceCounter=0;keystrokeCounter=0;});$(document).off("mousedown",'li[data-id="0"], li[data-id="1"], li[data-id="2"], li[data-id="3"], li[data-id="4"], li[data-id="5"]').on("mousedown",'li[data-id="0"], li[data-id="1"], li[data-id="2"], li[data-id="3"], li[data-id="4"], li[data-id="5"]',function(){if(window.es){_gaq.push(["_trackEvent",'Interaction','Clicked on top 6 search results - ES',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Clicked on top 6 search results - ES","nonInteraction":true});}else{_gaq.push(["_trackEvent",'Interaction','Clicked on top 6 search results - Control',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Clicked on top 6 search results - Control","nonInteraction":true});}});$(document).off("mousedown",'li[data-id="6"], li[data-id="7"], li[data-id="8"], li[data-id="9"], li[data-id="10"], li[data-id="11"], li[data-id="12"], li[data-id="13"], li[data-id="14"]').on("mousedown",'li[data-id="6"], li[data-id="7"], li[data-id="8"], li[data-id="9"], li[data-id="10"], li[data-id="11"], li[data-id="12"], li[data-id="13"], li[data-id="14"]',function(){if(window.es){_gaq.push(["_trackEvent",'Interaction','Clicked on bottom 7-15 search results - ES',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Clicked on bottom 7-15 search results - ES","nonInteraction":true});}else{_gaq.push(["_trackEvent",'Interaction','Clicked on bottom 7-15 search results - Control',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Clicked on bottom 7-15 search results - Control","nonInteraction":true});}});autoCompleteItems.on("mouseover",function(){if(isMouseFocusEnable){focusAirport($(this).data("id"),true);}});$(document).on("mousedown",function(e){lastClicked=$(e.target);});activateResetButtons(els);function handleInput(e){if(window.es){_gaq.push(["_trackEvent",'Interaction','Search query made - ES',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Search query made - ES","nonInteraction":true});}else{_gaq.push(["_trackEvent",'Interaction','Search query made - Control',,,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Search query made - Control","nonInteraction":true});}
lastActionIsClick=false;var oldActiveSearchBoxDirection=activeSearchBoxDirection
activeSearchBoxDirection=(this.name=="seg0_from")?"from":"to";if(activeSearchBoxDirection!==oldActiveSearchBoxDirection){backspaceCounter=0;keystrokeCounter=0;lastStringInputted="";}
var reqNum;var value=$(this).val();if(isIE9&&((e.keyCode>=KEY_CODES.LEFT&&e.keyCode<=KEY_CODES.DOWN)||e.keyCode===KEY_CODES.TAB||e.keyCode===KEY_CODES.ENTER)){return;}
var changeInStringLength=value.length-lastStringInputted.length;if(changeInStringLength<0){backspaceCounter-=changeInStringLength;keystrokeCounter-=changeInStringLength;}else{keystrokeCounter+=changeInStringLength;}
lastStringInputted=value;if(!(value)){hideInputResetBtn($(this));return autoCompleteList.hide();}
showInputResetBtn($(this));reqNum=++reqCount;$.get((window.es==1?opts.esendpoint:opts.endpoint),{term:value,direction:(this.name=="seg0_from")?"departure":"destination"},function(data){if(data.es_error){console.error(data.es_error);delete data.es_error;}
if(reqNum>reqHighest){reqHighest=reqNum;outputResults.call(this,data);}}.bind(this));}
function handleFocus(e){currentInput=$(this);$(this).select();lastClicked=null;focusedIndex=null;}
function preProcessResults(data){var filteredAirports=[];var filteredCities=[];var cityGroups=data.filter(function(airport){if(airport.is_city==1){filteredCities.push(airport.raw_code);return true;}
return false;});cityGroups=cityGroups.reduce(function(cityGroups,city){var cityGroup=data.filter(function(airport){if(airport.city_group===city.raw_code&&(airport.is_city==0||airport.is_major_airport==1)){filteredAirports.push(airport.raw_code);return true;}
return false;});cityGroups[city.raw_code]={city,airports:cityGroup};return cityGroups;},{});var processedData=[];for(var i=0;i<data.length;i++){var currentAirport=data[i];if(filteredCities.includes(currentAirport.raw_code)){processedData.push({...cityGroups[currentAirport.raw_code].city,is_main_city:true});cityGroups[currentAirport.raw_code].airports.forEach(function(airport){processedData.push({...airport,in_city_group:true});})
continue;}
if(!filteredAirports.includes(currentAirport.raw_code)){processedData.push(currentAirport)}}
return processedData;}
function renderAirportResult(airportData){if(!opts.isRedesignEnabled){return{html:`${airportData.name} [${airportData.code}]`,value:`${airportData.clean_name} [${airportData.clean_code}]`};}
var in_city_group=airportData.in_city_group;var is_only_airport=!in_city_group&&(airportData.is_major_airport&&!airportData.is_main_city);var airportName=(in_city_group||is_only_airport)?`${airportData.highlighted_airport_name} - ${airportData.code}`:`${airportData.short_city_name} - All Airports (${airportData.code})`;return{html:`
<div class="icon ${in_city_group?'offset':''}">
    ${in_city_group?cityGroupIcon:planeIcon}
</div>
<div class="content">
    <span class="airport-name">${airportName}</span>
    <span class="airport-address">${airportData.short_address}</span>
</div>
            `,value:airportData.short_name}}
function outputResults(data){if(opts.isRedesignEnabled){var airportData={...data};delete airportData.es_error;data=preProcessResults(Object.values(airportData))}
resetFocusedAirport(true);var maxResults=opts.isRedesignEnabled?8:opts.maxResults;for(var i=0;i<maxResults;i++){if(!(i in data)){$(autoCompleteItems[i]).hide();continue;}
var res=data[i];var renderedContent=renderAirportResult(res);$(autoCompleteItems[i]).html(renderedContent.html).data("code",res.clean_code).data("country_code",res.country_code).data("select_value",renderedContent.value).show()}
if(!$(this).val()||!$(this).is(":focus")){return;}
autoCompleteList.css({top:$(this).offset().top+$(this).outerHeight(),left:$(this).offset().left,minWidth:opts.isRedesignEnabled?$(this).parent().width()*1.5:'none',display:"block"});if(0 in data){focusAirport(0,false);}}
function handleKeyDown(e){isMouseFocusEnable=false;switch(e.keyCode){case KEY_CODES.ENTER:e.preventDefault();if(focusedIndex===null){return;}
handleBlur();break;case KEY_CODES.DOWN:case KEY_CODES.UP:e.preventDefault();handleMovement(e.keyCode);break;}}
function handleBlur(){var focusedAirport;var preventFocus=false;if(currentInput===null){return;}
if(lastClicked!==null&&(lastClicked[0].nodeName==="INPUT"||$(lastClicked[0]).hasClass(opts.preventAutoFocusClass)||$(lastClicked[0]).hasClass(opts.resetButton.classes))){preventFocus=true;}
if(focusedIndex!==null){focusedAirport=autoCompleteItems[focusedIndex];handleSelected({code:$(focusedAirport).data("code"),country_code:$(focusedAirport).data("country_code")},$(focusedAirport).data("select_value"),preventFocus);}else if((focusedAirport=$(autoCompleteItems[0])).is(":visible")){handleSelected({code:$(focusedAirport).data("code"),country_code:$(focusedAirport).data("country_code")},$(focusedAirport).data("select_value"),preventFocus);}
originalVal=null;currentInput=null;autoCompleteList.hide();}
function handleMovement(keyCode){var visibleAirportsNum=autoCompleteItems.filter(":visible").length;var toIndex=focusedIndex;if(visibleAirportsNum===0){return;}
if(toIndex===null){toIndex=(keyCode===KEY_CODES.UP)?visibleAirportsNum-1:0;}else{toIndex+=(keyCode===KEY_CODES.UP)?-1:1;if(toIndex<0||toIndex>=visibleAirportsNum){resetInput();resetFocusedAirport(true);return;}}
focusAirport(toIndex,true);}
function focusAirport(index,select){var focusedAirportElem=$(autoCompleteItems[index]);if(focusedIndex===null){originalVal=$(currentInput).val();}else{resetFocusedAirport();}
focusedIndex=index;focusedAirportElem.addClass(opts.autoCompleteItems.focusClass);if(select){handleSelected({code:$(focusedAirportElem).data("code"),country_code:$(focusedAirportElem).data("country_code")},$(focusedAirportElem).data("select_value"),true);}}
function resetFocusedAirport(resetTheIndex){autoCompleteItems.filter('.'+opts.autoCompleteItems.focusClass).removeClass(opts.autoCompleteItems.focusClass);if(resetTheIndex===true){focusedIndex=null;}}
function handleSelected(data,fullVal,preventFocus){if(currentInput===null){return;}
currentInput.val(fullVal);selCallback(currentInput,data,fullVal,preventFocus);$(document).trigger("airport-selection-changed",[data.code,currentInput]);}
function activateResetButtons(inputs){for(var i=0;i<inputs.length;i++){if($(inputs[i]).val()){showInputResetBtn($(inputs[i]));}}}
function resetInput(input){input=input||currentInput;if(originalVal){input.val(originalVal);originalVal=null;}else{input.val('');}
resetCallback(input);}
function showInputResetBtn(input){var resetBtn;if((resetBtn=input.prev()).length===0){resetBtn=$(document.createElement(opts.resetButton.tag)).addClass(opts.resetButton.classes).on("click",handleResetBtnClick).insertBefore(input);}
input.addClass(opts.resetButton.activeInputClass);resetBtn.show();}
function hideInputResetBtn(input){input.removeClass(opts.resetButton.activeInputClass).prev().hide();}
function handleResetBtnClick(e){var input=$(this).next();e.preventDefault();resetInput(input,true);hideInputResetBtn(input);input.focus();currentInput=input;}};;var carsTabIsActive=false;$(document).ready(function(){var noContentLabel="No results found, please click to try our advanced search",isiOS=/(iPhone|iPod|iPad)/.test(navigator.userAgent);var carsForm=$('.main-search-form.cars');var carsSearchInput=carsForm.find('#cars_autocomplete'),carsPickupIATACode=carsForm.find('input[name="pickupIATACode"]'),carsReturnIATACode=carsForm.find('input[name="returnIATACode"]'),carsPickupDateTime=carsForm.find('input[name="pickupDateTime"]'),carsReturnDateTime=carsForm.find('input[name="returnDateTime"]'),carsCountryId=carsForm.find('input[name="countryID"]'),carsCheckin=carsForm.find('input[name="prettyPickupDateTime"]'),carsCheckout=carsForm.find('input[name="prettyReturnDateTime"]'),carsNextInput=carsSearchInput.closest(".column").next().find("input");function hideValidationErrors(){$('.main-search-form-validation').fadeOut(200);}
function onAutocompleteSelect(ui){if(ui.item.label===noContentLabel){$(location).attr('href','https://www.justflycars.com/')}else{carsPickupIATACode.val(ui.item.code);carsReturnIATACode.val(ui.item.code);carsCountryId.val(ui.item.country_code);carsNextInput.focus();}}
if(typeof carsForm!=='undefined'&&carsForm.length>0){carsSearchInput.on('focusout',function(event,ui){if(carsPickupIATACode.val().length===''||carsReturnIATACode.val()===''){carsSearchInput.val('');carsPickupIATACode.val('');carsReturnIATACode.val('');carsCountryId.val('');}}).on('autocompletecreate',function(event,ui){$('.cars .input-wrap').find('input[data-mandatory="true"]').each(function(){$(this).val('');})}).on("autocompleteresponse",function(event,ui){var validOptions=0;$.each(ui.content,function(idx,option){ui.content[idx].label=option.label.replace(/\[.{0,}\]/,'');ui.content[idx].value=option.value.replace(/\[.{0,}\]/,'');validOptions+=1;});if(validOptions===0){ui.content[0]={label:noContentLabel,value:noContentLabel};$.each(ui.content,function(idx,option){if(idx>0){ui.content[idx]={label:'',value:''};}});}}).on('autocompletefocus',function(event,ui){if(isiOS){onAutocompleteSelect(ui);}}).on('autocompleteselect',function(event,ui){onAutocompleteSelect(ui);});var calendarParams={format:'yy-mm-dd',min_days_diff:0,max_days_diff:0,min_start_day:0,number_of_months:Mv.env.user.isMobile?1:2};carsCheckin.on('change',function(){var time='T10:00:00',datetime=new Date(),tzOffset=datetime.getTimezoneOffset();var today=datetime.toJSON().slice(0,10),nowMoreOneHour;if(carsCheckin.val()===today){nowMoreOneHour=new Date(datetime.setMinutes(datetime.getMinutes()-tzOffset+60)).toJSON().slice(11,19);time='T'+nowMoreOneHour;}
carsPickupDateTime.val(carsCheckin.val()+decodeURI(time));}).rangeDatepicker(calendarParams,carsCheckout);carsCheckout.on('change',function(){var time='T10:00:00';if(carsCheckout.val()===carsCheckin.val()){time='T23:30:00';}
carsReturnDateTime.val(carsCheckout.val()+decodeURI(time));}).rangeDatepicker(calendarParams);carsForm.on('submit',function(e){$('.cars .search-field-wrap').find('input').each(function(){var self=$(this);if(self.val()==''){hideValidationErrors();self.closest('.search-field-wrap').find('.main-search-form-validation').fadeIn(300);setTimeout(hideValidationErrors,5000);e.preventDefault();return false;}});});$(document).on('click',hideValidationErrors);}});;var hotelTabIsActive=false;$(document).ready(function(){function hideValidationErrors(){$('.search-field-wrap').removeClass('invalid');$('.main-search-form-validation').fadeOut(200);}
if($('#hotel-search-form').length){var hotelCityId=$('input[name="dest_id"]');var hotelDestinationType=$('input[name="dest_type"]');var hotelSearchInput=$('#hotel_autocomplete');hotelSearchInput.autocomplete({source:function(request,response){jQuery.get(Mv.env.app.baseUrl+"hotel/auto-complete",{term:request.term},function(data){var formattedForjQueryUI=$.map(data,function(item){return{label:item['label'],value:item['label'],type:item['dest_type'],dest_id:item['dest_id']};});response(formattedForjQueryUI);});},focus:function(e,ui){hotelSearchInput.val(ui.item['label']);hotelCityId.val(ui.item['dest_id']);hotelDestinationType.val(ui.item['type']);},select:function(e,ui){hotelSearchInput.val(ui.item['label']);hotelCityId.val(ui.item['dest_id']);hotelDestinationType.val(ui.item['type']);hotelSearchInput.closest('.search-field-wrap').next('.search-field-wrap').find('input[type=text]').focus();},minLength:3});var hotelCheckin=$('input[name="checkin"]');var hotelCheckout=$('input[name="checkout"]');var calendarParams={format:'yy-mm-dd',min_days_diff:0,max_days_diff:0,min_start_day:0,number_of_months:Mv.env.user.isMobile?1:2};hotelCheckin.rangeDatepicker(calendarParams,hotelCheckout);hotelCheckout.rangeDatepicker(calendarParams);var childrenAge=12;$('.main-search-form.hotels').on('submit',function(e){var numChildren=$('input[name="group_children"]').val();if(numChildren>0){for(var i=1;i<=numChildren;i++){$('.main-search-form.hotels').find('.input-wrap').append('<input type="hidden" name="age" value="'+childrenAge+'">');}}
$('.main-search-form.hotels .search-field-wrap').find('input').each(function(){var self=$(this);if(self.val()==''){hideValidationErrors();self.closest('.search-field-wrap').addClass('invalid').find('.main-search-form-validation').fadeIn(300);setTimeout(hideValidationErrors,5000);e.preventDefault();return false;}});});$(document).on('click',hideValidationErrors);}});function saveHotelSearch(){$.get('/hotel/save-search?'+$('#hotel-search-form').serialize());return true;};var hotelTabIsActive;var carsTabIsActive;(function($){$.fn.extend({rangeDatepicker:function(params,linkedTo){function updateLinkedDpDate(){var params=$(this).data('params');var linkedTo=$(this).data('linkedTo');var datePattern=/^([\d]{4})-([\d]{2})-([\d]{2})$/;var thisDate=$(this).val();var matches=datePattern.exec(thisDate);if(matches===null){$(this).val('');if(linkedTo!==null){$(linkedTo).val('').change();}
return;}
if(linkedTo!==null){if($(this).val()===''){$(linkedTo).val('').change();return;}
var currentTimestamp=new Date(_parseDate(thisDate)).getTime();var newRetMinDate=new Date(currentTimestamp+((params.min_days_diff+1)*86400001));$(linkedTo).datepicker('option','minDate',newRetMinDate);if(params.max_days_diff!==0){var newRetMaxDate=new Date(currentTimestamp+((params.max_days_diff+1)*86400001));$(linkedTo).datepicker('option','maxDate',newRetMaxDate);}
$(linkedTo).datepicker("setDate",$(linkedTo).val());$(linkedTo).change();}}
params=$.extend({format:'yy-mm-dd',min_days_diff:0,max_days_diff:0,min_start_day:1,number_of_months:2},params);if(params!==undefined){$(this).data('params',params);}
var _parseDate=function(date){var _date=date;if(!$.support.placeholder){_date=date.replace('-','/').replace('-','/');}
return _date;};var linkedDate='',linkedToVal=$(linkedTo).val();if(linkedTo===undefined){linkedTo=null;}else{if(!!linkedToVal){linkedDate=new Date(_parseDate(linkedToVal));if(isNaN(linkedDate.getTime())){linkedDate='';}}}
if(linkedTo!==undefined){$(this).data('linkedTo',linkedTo);}
var minDate=new Date(new Date().getTime()+(params.min_start_day*86400000));return $(this).datepicker({dateFormat:params.format,minDate:minDate,numberOfMonths:params.number_of_months}).on('change',function(event){updateLinkedDpDate.call(this);var container=$(this).closest('div.inline-search-form');if(container.hasClass('highlight')&&$(this).attr('name')==='seg0_date'){setTimeout(function(){container.find('input[name=seg1_date]').eq(0).datepicker('show');},100);}else{if((hotelTabIsActive==false)&&(carsTabIsActive==false)){var nextField=$(this).closest('div').next('div').find('input[type=text]:visible:first');if(nextField.length>0){setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}else{nextField=$(this).closest('div.inline-search-form').find('div.form-fields-wrap-multi-container div.form-fields-wrap-multi:first input[type=text]:visible:first');if(nextField.length>0){setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}}}else{var nextField=$(this).closest('.search-field-wrap').next('.search-field-wrap').find('input[type=text]');setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}}}).on('allDatepickersInitialized',function(event){updateLinkedDpDate.call(this);});}});})(jQuery);;(function($,Mv){function focusNextField(currentField){var nextField=currentField.closest('div').next('div').find('input[type=text]:visible:first');if(nextField.length>0){setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}else{nextField=currentField.closest('div').parent().next('div.form-fields-wrap-multi').find('input[type=text]:visible:first');if(nextField.length>0){setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}else if(currentField.closest('div.form-fields-wrap-multi').length===0){nextField=currentField.closest('div.inline-search-form').find('div.form-fields-wrap-multi-container div.form-fields-wrap-multi:first input[type=text]:visible:first');if(nextField.length>0){setTimeout(function(){if(!$(nextField).is(':focus')){$(nextField).focus();}},50);}}}}
$(document).ready(function(){var cachedFormData=null;var pricedDatePickerRequest=null;window.__pricedDatePickerTimeout=null;$('input[name="seg0_from"], input[name="seg0_to"], input[name="type"]').on('change blur',function(){clearTimeout(window.__pricedDatePickerTimeout);window.__pricedDatePickerTimeout=setTimeout(function(){var departureCode=$('input[name="seg0_from_code"]').val();var destinationCode=$('input[name="seg0_to_code"]').val();var tripType=$('input[name="type"]').val();if(departureCode&&destinationCode&&tripType){var cacheKey=''+departureCode+destinationCode+tripType;var isValidTripType=['roundtrip','oneway'].indexOf(tripType)!==-1;if(cacheKey!==cachedFormData||!isValidTripType){cachedFormData=cacheKey;$(window).trigger('force-refresh-datepicker');}
if(isValidTripType){pricedDatePickerRequest=$.ajax({url:`/date-picker-prices?departure_code=${departureCode}&destination_code=${destinationCode}&trip_type=${tripType}`,type:'GET',success:function(data){if(data['success']&&data.data){$(document).trigger('flex-date-calendar-prices',[data.data,tripType]);}else{$(document).trigger('clear-datepicker');}},beforeSend:function(){if(pricedDatePickerRequest!=null){pricedDatePickerRequest.abort();}}});}}},500);})
var displayCount=$('.displayed-field').length-1;if(displayCount>0){for(var i=0;i<displayCount;i++){_.defer(function(){$('a.inline-search-form-add-segment:visible').eq(0).click();});}}
if($('#search-form-errors').length){Modal.open({html:$('#search-form-errors').html(),width:550,unclosable:false});}
var formInputs=$('.form-field-wrap input');var inputWrapper='.form-field-wrap';var focusClass='focus';formInputs.focus(function(){var self=$(this);var wrapper=self.closest(inputWrapper);wrapper.addClass(focusClass);});formInputs.blur(function(){var self=$(this);var wrapper=self.closest(inputWrapper);wrapper.removeClass(focusClass);});function resetInlineSearchForm(form){$(form).find('input[type=text]').val('');}
var lockedInlineSearchForm=false;var calendarParams={format:'yy-mm-dd',min_days_diff:0,max_days_diff:0,min_start_day:0,number_of_months:Mv.env.user.isMobile?1:2};var formContainerClass='inline-search-form';var formClass=formContainerClass+'-form';var formClassElement=$('.'+formClass);var modeContainerClass=formContainerClass+'-mode';var segmentContainerClass='form-fields-wrap-multi';var addSegmentClass=formContainerClass+'-add-segment';var removeSegmentClass=formContainerClass+'-remove-segment';$('.'+formClass+' *').on('keydown',function(event){if(lockedInlineSearchForm){event.preventDefault();}});var seg0FromTo=formClassElement.find('[name="seg0_from"], [name="seg0_to"]');if(seg0FromTo.val()!==""){seg0FromTo.trigger("change");}
formClassElement.find('input[name$="_from"], input[name$="_to"]').on('keyup',function(event){var keyCode=event.keyCode;var allowedKeyCodes=[9,13,45,46,20,27,16,17,18,91,116,144,33,34,35,36,37,38,39,40];if(!in_array(keyCode,allowedKeyCodes)){$(this).removeData('auto_meta_is_city');var name=$(this).attr('name');var codeField=$('input[name="'+name+'_code"]');if(codeField.length>0){codeField.val('');}}});var hotelSearchCheckbox=formClassElement.find("[name=hotels_search]");formClassElement.on("change","[name=hotels_search]",function(){formClassElement.attr("data-hotels-search",$(this).is(":checked"))
hotelSearchCheckbox.prop("checked",$(this).is(":checked"));});hotelSearchCheckbox.trigger("change");var cleanAllAirportsFullName=function(fullName){var cleanedName=fullName.replace(/\[[A-Z]{3}\]/,"").replace(/(<[^>]*?>)/g,"");var match=cleanedName.match(/^[^-]*/);if(match!=null){cleanedName=(match[0]).trim();}
return cleanedName;}
var getCityFromFullName=function(fullName){var city=null;var match=fullName.match(/^[^,]+/);if(match!=null){city=(match[0]).trim();}
return city;}
var getCountryFromFullName=function(fullName){var country=null;var match=fullName.match(/^[^,]+,([^-]+)/);if(match!=null){country=(match[1]).trim();}
return country;}
var getAirportCodeFromString=function(string){if(string.length==3){return string;}
var matches=string.match(/\[([a-zA-z]{3})\]/);return matches&&matches[1]?matches[1]:null;}
var isAirportCodeFormat=function(string){return string.match(/^[a-zA-Z]{3}$/)!==null};var getFormStrippedAction=function(){var flightsFormAction=formClassElement.prop("action")
var match=flightsFormAction.match(/^([^\?]*)/);if(match!=null){flightsFormAction=match[0];}
return flightsFormAction;}
var SEARCH_TYPE_ROUNDTRIP='roundtrip';var SEARCH_TYPE_ONEWAY='oneway';var SEARCH_TYPE_MULTI='multi';var getFlightSearchFormSerializedSubmitUrl=function(){var formStripedAction=getFormStrippedAction(),formParams=formClassElement.serializeArray(),formParamsPass2=[],flightsSearchParams={};flightsSearchParams['type']=formClassElement.find('[name=type]').val();for(var i in formParams){var formParam=formParams[i],name=formParam['name'],value=formParam['value'].trim();if(!value){continue;}
switch(name){case "seg4_from":case "seg4_to":case "seg4_date":case "seg3_from":case "seg3_to":case "seg3_date":case "seg2_from":case "seg2_to":case "seg2_date":case "seg1_from":case "seg1_to":if(flightsSearchParams['type']==SEARCH_TYPE_MULTI){flightsSearchParams[name]=value;}
break;case "seg1_date":if([SEARCH_TYPE_ROUNDTRIP,SEARCH_TYPE_MULTI].indexOf(flightsSearchParams['type'])!=-1){if(flightsSearchParams['type']==SEARCH_TYPE_ROUNDTRIP&&flightsSearchParams[name]){break;}
flightsSearchParams[name]=value;}
break;case "new_search":case "seg0_from":case "seg0_to":case "seg0_date":case "num_adults":case "num_children":case "num_infants":case "num_infants_lap":case "seat_class":case "campaign":flightsSearchParams[name]=value;break;case "seg4_from_code":case "seg4_to_code":case "seg3_from_code":case "seg3_to_code":case "seg2_from_code":case "seg2_to_code":case "seg1_from_code":case "seg1_to_code":if(flightsSearchParams['type']==SEARCH_TYPE_MULTI){formParamsPass2.push(formParam);}
break;case "seg0_from_code":case "seg0_to_code":formParamsPass2.push(formParam);break;}}
for(var i in formParamsPass2){var formParam=formParamsPass2[i],name=formParam['name'],value=formParam['value'].trim();if(!value){break;}
var match=name.match(/(.*)(_code)$/);if(match){flightsSearchParams[match[1]]=value;}}
if((navigator.userAgent.indexOf('Safari')!==-1&&navigator.userAgent.indexOf('Chrome')===-1)&&document.getElementById('hotels_search_after')!==null&&document.getElementById('hotels_search_after').checked){flightsSearchParams.isonhp=1;}
return formStripedAction+"?"+$.param(flightsSearchParams);}
if(typeof(Storage)!=="undefined"){try{if(sessionStorage.travelPurpose==='business')
$('input#travel_purpose').prop('checked',true);}catch(e){console.log('ERROR sessionStorage',e);}}
var flightsSearchSubmit=function(event){window.flightSearchURL=getFlightSearchFormSerializedSubmitUrl();var travelPurpose=$('input#travel_purpose').prop('checked')?'business':'personal';if(typeof(Storage)!=="undefined")
sessionStorage.travelPurpose=travelPurpose;_gaTracker('send',{hitType:'event',eventCategory:'Interaction',eventAction:'Search data - Travel purpose',eventLabel:travelPurpose,nonInteraction:true},{transport:'beacon',hitCallback:function(){window.location=window.flightSearchURL;}});setTimeout(function(){window.location=window.flightSearchURL;},500);return false;};var flightsHotelsSearchSubmit=function(event){var firstFromInput=formClassElement.find("[name=seg0_from]");var firstToInput=formClassElement.find("[name=seg0_to]");processSearchSubmitForHotelCrossSearch(this,getFlightSearchFormSerializedSubmitUrl(),formClassElement.find("[name=hotels_search]").is(":checked"),{selectedCurrency:formClassElement.data("selected-currency"),checkIn:formClassElement.find("[name=seg0_date]").val(),checkOut:formClassElement.find("[name=seg1_date]").val(),firstFrom:firstFromInput.val(),firstTo:firstToInput.val(),seg0FromCode:formClassElement.find("[name=seg0_from_code]").val()||formClassElement.find('[name="seg0_from"]').val(),seg0ToCode:formClassElement.find("[name=seg0_to_code]").val()||formClassElement.find('[name="seg0_to"]').val(),firstToIsCity:firstToInput.data("auto_meta_is_city"),numAdt:formClassElement.find("[name=num_adults]").val(),numChd:formClassElement.find("[name=num_children]").val(),numIns:formClassElement.find("[name=num_infants]").val(),numInl:formClassElement.find("[name=num_infants_lap]").val(),tripType:formClassElement.find("[name=type]").val(),label:formClassElement.find("[name=tracking_label]").val(),},true);};formClassElement.on('click','.form-field-submit-button',flightsHotelsSearchSubmit);formClassElement.on('submit',flightsSearchSubmit);$('.'+modeContainerClass+' a').on('click',function(event){event.preventDefault();$('.'+formContainerClass).removeClass('highlight');if($(this).hasClass('active')){return;}
$('.'+modeContainerClass+' a.active').removeClass('active');$(this).addClass('active');var mode=$(this).attr('rel');var formContainer=$(this).closest('form').find('.'+formContainerClass);if(formContainer.length>0){var typeField=formContainer.find('input[name="type"]');if(typeField.length>0){typeField.val(mode).trigger('change');}
var activeClass=formContainer.attr('class').split(' ');activeClass=activeClass[1];if(mode==='multi'){formContainer.find('.inline-search-form-add-segment-container, .inline-search-form-remove-segment-container').css('display','none');formContainer.find('.form-fields-wrap-multi-container').slideDown({duration:200,easing:'linear',complete:function(){formContainer.find('.inline-search-form-add-segment-container, .inline-search-form-remove-segment-container').fadeIn(250);}});}
if(activeClass==='form-wrap-multi'){formContainer.find('.form-fields-wrap-multi-container').stop().slideUp({duration:200,easing:'linear',complete:function(){formContainer.stop().removeClass(activeClass).addClass('form-wrap-'+mode);}});}else{formContainer.stop().removeClass(activeClass).addClass('form-wrap-'+mode);}}});function getTotalPassengers(){var total=0;$('.'+formContainerClass+' .form-field-passengers select').each(function(){total+=parseInt($(this).val());});total=Math.max(total,1);return total.toString()+(total>1?' Passengers':' Passenger');}
$('.'+formContainerClass+' .form-field-passengers select').on('change',function(){$('.'+formContainerClass+' .nbPassengers').html(getTotalPassengers());});function updateFlightOptionsLabel(){$('.'+formContainerClass+' .form-filters-wrap input').each(function(){var labelElement=$(this).closest('ul').closest('li').find('a:first').find('span.title');var value='';if($(this).attr('type')==='radio'){if(!$(this).is(':checked')){return;}
value=$(this).next('label').html();}else{value=$(this).val();}
if(value===''||value===undefined){labelElement.html('empty !');}else{labelElement.html(value);}});}
$('.'+formContainerClass+' .form-filters-wrap input').on('change',function(){setTimeout(function(){updateFlightOptionsLabel();$('.'+formContainerClass+' .form-filter-box').hide();},50);});updateFlightOptionsLabel();$('.'+addSegmentClass).on('click',function(event){event.preventDefault();var container=$(this).parent().parent().parent();var nbSegments=container.parent().find('.'+segmentContainerClass+':visible').length;var nbSegmentsAvailable=container.parent().find('.'+segmentContainerClass+'').length;if(nbSegments<nbSegmentsAvailable){var nextRow=container.parent().find('.'+segmentContainerClass+':visible:last').next();container.find('a.'+addSegmentClass).css('display','none');container.find('a.'+removeSegmentClass).css('display','none');nextRow.show().find('a.'+removeSegmentClass).css('display','block');if((nbSegments+1)<nbSegmentsAvailable){nextRow.find('a.'+addSegmentClass).css('display','block');}else{nextRow.find('a.'+addSegmentClass).css('display','none');}}});$('.'+removeSegmentClass).on('click',function(event){event.preventDefault();var container=$(this).parent().parent().parent();var nbSegments=container.parent().find('.'+segmentContainerClass+':visible').length;var nbSegmentsAvailable=container.parent().find('.'+segmentContainerClass+'').length;if(nbSegments>1){var lastRow=container.parent().find('.'+segmentContainerClass+':visible:last');lastRow.hide();var segmentNumber=lastRow.attr('id').charAt(lastRow.attr('id').length-1);lastRow.find('input[name="seg'+segmentNumber+'_from"]').val('').trigger('change');lastRow.find('input[name="seg'+segmentNumber+'_from_code"]').val('');lastRow.find('input[name="seg'+segmentNumber+'_to"]').val('').trigger('change');lastRow.find('input[name="seg'+segmentNumber+'_to_code"]').val('');lastRow.find('input[name="seg'+segmentNumber+'_date"]').val('');container.find('a.'+addSegmentClass).css('display','none');container.find('a.'+removeSegmentClass).css('display','none');lastRow.prev().find('a.'+addSegmentClass).css('display','block');if(nbSegments>2){lastRow.prev().find('a.'+removeSegmentClass).css('display','block');}}});Mv.airportAutoComplete($('input.airport-related:not(#hotel_autocomplete)'),function set(currentInput,data,fullVal,preventFocus){if($(currentInput).attr('id')!==undefined&&$(currentInput).attr('id').indexOf('cars_')===0){$('.main-search-form.cars').find('input[name="pickupIATACode"]').val(data.code);$('.main-search-form.cars').find('input[name="returnIATACode"]').val(data.code);$('.main-search-form.cars').find('input[name="countryID"]').val(data.country_code);}
currentInput.next().val(data.code);if(preventFocus){return;}
focusNextField(currentInput);},function reset(currentInput){currentInput.next().val('');});Mv.searchFormDatePicker($(".date-picker-on"),function(currentField,val){focusNextField(currentField);});(function broadcastSearchMode(){var SEARCH_MODES;var activeSearchMode;var activeToggleId;var searchModeChangeEvent="search-mode-change";SEARCH_MODES=Mv.searchFormDatePicker().MODES;activeToggleId=$(".search-type-toggle.active").attr("id");switch(activeToggleId){case "toggle-roundtrip":activeSearchMode=SEARCH_MODES.ROUND_TRIP;break;case "toggle-oneway":activeSearchMode=SEARCH_MODES.ONE_WAY;break;case "toggle-multi":activeSearchMode=SEARCH_MODES.MULTI_CITY;break;}
$(document).trigger(searchModeChangeEvent,[activeSearchMode]);$("#toggle-roundtrip").click(function(e){$(document).trigger(searchModeChangeEvent,[SEARCH_MODES.ROUND_TRIP]);});$("#toggle-oneway").click(function(e){$(document).trigger(searchModeChangeEvent,[SEARCH_MODES.ONE_WAY]);});$("#toggle-multi").click(function(e){$(document).trigger(searchModeChangeEvent,[SEARCH_MODES.MULTI_CITY]);});})();$('body').on('click','.prefill-search-form',function(event){var fromAirport=$(this).data('from-airport');var fromCity=$(this).data('from-city');var fromCompleteName=$(this).data('from-complete-name');var toAirport=$(this).data('to-airport');var toCity=$(this).data('to-city');var toCompleteName=$(this).data('to-complete-name');var formContainer=$('.'+formContainerClass).eq(0);if(_gaTracker){_gaTracker('send',{'hitType':"event",'eventCategory':'Interaction','eventAction':'Homepage Deals','eventLabel':'Selected','eventValue':toAirport,'nonInteraction':0});}
lockedInlineSearchForm=true;resetInlineSearchForm(formContainer);formContainer.addClass('highlight');formContainer.find('input[name="seg0_from"]').val(fromCompleteName).trigger('change');formContainer.find('input[name="seg0_from_code"]').val(fromAirport).trigger('change');var seg0To=formContainer.find('input[name="seg0_to"]').val(toCompleteName).trigger('change');formContainer.find('input[name="seg0_to_code"]').val(toAirport).trigger('change');var seg0ToData=seg0To.data();for(var key in seg0ToData){if(key.indexOf("auto_meta_")===0){delete seg0ToData[key];}}
lockedInlineSearchForm=false;$('.search-selection-tab.flights').click();window.scrollTo({top:0,behavior:'smooth'});formContainer.find('input[name="seg0_date"]').focus();});});function in_array(needle,haystack){var length=haystack.length;for(var i=0;i<length;i++){if(haystack[i]==needle)return true;}
return false;}})(jQuery,window.Mv);;var CruiseSearch=function(){var self=this;self.formSelector='form[name=cruise_search_form]';self.feedbackContainer='#cruise_feedback_message';self.destinationIdSelector='[name="destination_id"]';self.startDateSelector='[name="start_date"]';self.vendorIdSelector='[name="vendor_id"]';self.departurePortIdSelector='[name="departure_port_id"]';self.errorContainerWrapper='.search-field-wrap';self.errorContainer='.main-search-form-validation';self.calendar=null;self.destinationId=null;self.startDate=null;self.vendorId=null;self.departurePortId=null;self.init=function(){};self.getValidData=function(){var data={destinationId:$(self.formSelector).find(self.destinationIdSelector).val(),startDate:$(self.formSelector).find(self.startDateSelector).val(),vendorId:$(self.formSelector).find(self.vendorIdSelector).val(),departurePortId:$(self.formSelector).find(self.departurePortIdSelector).val()};if(self.cruiseFormHasErrors(data)){return false;}else{return data;}};self.cruiseFormHasErrors=function(data){var errorMsg='';var inputSelector='';if(!data['destinationId']){inputSelector=self.destinationIdSelector;errorMsg='Please select a destination';renderErrorMsg(inputSelector,errorMsg);return true;}
if(!data['startDate']){inputSelector=self.startDateSelector;errorMsg='Please select a departure month';renderErrorMsg(inputSelector,errorMsg);return true;}
return false;function renderErrorMsg(input,msg){$(self.errorContainerWrapper).removeClass('invalid');$(input).closest(self.errorContainerWrapper).addClass('invalid').find(self.errorContainer).html(msg).fadeIn();}};self.submit=function(){var validData=self.getValidData();_gaq.push(["_trackEvent",'Interaction','Cruise','Search',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Cruise","eventLabel":"Search","nonInteraction":true});if(validData){var url=$(self.formSelector).attr('action')+'?'+decodeURIComponent($.param(self.prepData(validData)));window.open(url,'_blank');}
return false;};self.prepData=function(data){var date=new Date(data['startDate']);var yyyy=date.getFullYear();var mm=("0"+(date.getMonth()+1)).slice(-2);var mm2=("0"+(date.getMonth()+2)).slice(-2);var dd=("0"+date.getDate()).slice(-2);var prepData={};prepData['start_date']=mm+'/'+dd+'/'+yyyy;prepData['end_date']=mm2+'/'+dd+'/'+yyyy;prepData['destination_ids[]']=data['destinationId'];prepData['vendor_ids[]']=data['vendorId'];prepData['departure_port_ids[]']=data['departurePortId'];prepData['clear']='all';prepData['from_price_min']='1';prepData['rel']='flighthub';return prepData;};};;var idleModalTimer;$(document).ready(function(){$(document).on('click','.modal-trigger',function(e){e.preventDefault();var self=$(this);var selfId=self.attr('id');triggerModal(selfId);});$(document).on('click','.reminder-modal-trigger',function(e){e.preventDefault();var self=$(this);var selfId=self.attr('id');clearInterval(idleModalTimer);var submitButton=$('#idle-modal-content').find('.submit-button');if(submitButton.data('submitSource')!='results_sticky_reminder'){submitButton.data('submitSource','results_sticky_reminder');}
triggerModal(selfId);});$('.close-modal').click(function(e){e.preventDefault();if($(this).hasClass('site-overlay')){var cookieElement=$(this).next('.site-modal');}else{var cookieElement=$(this).closest('.site-modal');}
if(typeof cookieElement.data('cookieClose')!==typeof undefined&&cookieElement.data('cookieClose')!==false){var modalDismissCookieName=cookieElement.data('cookieClose');setModalCookie(modalDismissCookieName);}
closeModal();});});function closeModal(){$('.site-modal').stop(false,false).fadeOut(150,function(){$('.site-modal').removeClass('modal-triggered');$('.site-overlay').fadeOut(150);if($('.site-modal .fareAlertEmail').length){$('.site-modal .fareAlertEmail').val('');}});}
function setModalCookie(cookieName){$.cookie(cookieName,1,{expires:1});}
function idleModal(modalId,time){var timer=0;idleModalTimer=setInterval(function(){timer++;if(timer>time){triggerModal(modalId);clearInterval(idleModalTimer);}},1000);$(document).on('mousemove keydown touchmove',function(){timer=0;});}
function triggerModal(modalId){var modal=$('.site-modal[data-target="'+modalId+'"]');var input=modal.find('.fareAlertEmail');if(Mv.env.user.userAccountEmail){input.val(Mv.env.user.userAccountEmail);}
if(Mv.env.user.prefillEmail){input.val(Mv.env.user.prefillEmail);}
$('.site-overlay, .site-modal').hide();$('.site-overlay[data-target="'+modalId+'"]').fadeIn(150,function(){modal.addClass('modal-triggered').fadeIn(150);});};$(document).ready(function(){var processingCancellation;var bookingHash;$('[data-void-booking]').click(function(e){e.preventDefault();bookingHash=$(this).data("void-booking");_gaq.push(["_trackEvent",'Interaction','Booking Void Request','Modal displayed',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Booking Void Request","eventLabel":"Modal displayed","nonInteraction":true});Modal.open({html:$('[data-void-booking-modal="'+bookingHash+'"]').html(),width:500,unclosable:true});$('.container-modal .booking-cancel-confirm').click(cancelBooking);});function cancelBooking(){if(processingCancellation){return;}
toggleProcessingState(true);$.post(Mv.env.app.baseUrl+'booking/cancel-user-booking',{bookingHash:bookingHash},function(data){if(!data.result){toggleProcessingState(false);$('#cancellation-error').text(data.response_text);Modal.open({html:$('.form-errors').html(),width:500,unclosable:false});_gaq.push(["_trackEvent",'Interaction','Booking Void Request','Booking Cancellation Error',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Booking Void Request","eventLabel":"Booking Cancellation Error","nonInteraction":true});return;}
$('.booking-cancel-modal .spinner-wrap, .booking-cancel-modal .body').hide();$('.booking-cancel-modal .body.confirmation').show();_gaq.push(["_trackEvent",'Interaction','Booking Void Request','Booking Cancellation Success',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Booking Void Request","eventLabel":"Booking Cancellation Success","nonInteraction":true});});}
$(document).on('click','.booking-cancel-reload-btn',function(e){e.preventDefault();$('.booking-cancel-modal .spinner-wrap').show();window.location.reload();});function toggleProcessingState(activate){processingCancellation=activate||false;$('.booking-cancel-btn').attr('disabled',processingCancellation);$('.booking-cancel-modal .spinner-wrap').show();}});;var countryIsoCode={"Afghanistan":"AF","Aland Islands":"AX","Albania":"AL","Algeria":"DZ","American Samoa":"AS","Andorra":"AD","Angola":"AO","Anguilla":"AI","Antarctica":"AQ","Antigua and Barbuda":"AG","Argentina":"AR","Armenia":"AM","Aruba":"AW","Australia":"AU","Austria":"AT","Azerbaijan":"AZ","Bahamas":"BS","Bahrain":"BH","Bangladesh":"BD","Barbados":"BB","Belarus":"BY","Belgium":"BE","Belize":"BZ","Benin":"BJ","Bermuda":"BM","Bhutan":"BT","Bolivia, Plurinational State of":"BO","Bonaire, Sint Eustatius and Saba":"BQ","Bosnia and Herzegovina":"BA","Botswana":"BW","Bouvet Island":"BV","Brazil":"BR","British Indian Ocean Territory":"IO","Brunei Darussalam":"BN","Bulgaria":"BG","Burkina Faso":"BF","Burundi":"BI","Cambodia":"KH","Cameroon":"CM","Canada":"CA","Cape Verde":"CV","Cayman Islands":"KY","Central African Republic":"CF","Chad":"TD","Chile":"CL","China":"CN","Christmas Island":"CX","Cocos (Keeling) Islands":"CC","Colombia":"CO","Comoros":"KM","Congo":"CG","Congo, the Democratic Republic of the":"CD","Cook Islands":"CK","Costa Rica":"CR","Cote d'Ivoire":"CI","Croatia":"HR","Cuba":"CU","Curacao":"CW","Cyprus":"CY","Czech Republic":"CZ","Denmark":"DK","Djibouti":"DJ","Dominica":"DM","Dominican Republic":"DO","Ecuador":"EC","Egypt":"EG","El Salvador":"SV","Equatorial Guinea":"GQ","Eritrea":"ER","Estonia":"EE","Ethiopia":"ET","Falkland Islands (Malvinas)":"FK","Faroe Islands":"FO","Fiji":"FJ","Finland":"FI","France":"FR","French Guiana":"GF","French Polynesia":"PF","French Southern Territories":"TF","Gabon":"GA","Gambia":"GM","Georgia":"GE","Germany":"DE","Ghana":"GH","Gibraltar":"GI","Greece":"GR","Greenland":"GL","Grenada":"GD","Guadeloupe":"GP","Guam":"GU","Guatemala":"GT","Guernsey":"GG","Guinea":"GN","Guinea-Bissau":"GW","Guyana":"GY","Haiti":"HT","Heard Island and McDonald Islands":"HM","Holy See (Vatican City State)":"VA","Honduras":"HN","Hong Kong":"HK","Hungary":"HU","Iceland":"IS","India":"IN","Indonesia":"ID","Iran, Islamic Republic of":"IR","Iraq":"IQ","Ireland":"IE","Isle of Man":"IM","Israel":"IL","Italy":"IT","Jamaica":"JM","Japan":"JP","Jersey":"JE","Jordan":"JO","Kazakhstan":"KZ","Kenya":"KE","Kiribati":"KI","Korea, Democratic People's Republic of":"KP","Korea, Republic of":"KR","Kuwait":"KW","Kyrgyzstan":"KG","Lao People's Democratic Republic":"LA","Latvia":"LV","Lebanon":"LB","Lesotho":"LS","Liberia":"LR","Libya":"LY","Liechtenstein":"LI","Lithuania":"LT","Luxembourg":"LU","Macao":"MO","Macedonia, the Former Yugoslav Republic of":"MK","Madagascar":"MG","Malawi":"MW","Malaysia":"MY","Maldives":"MV","Mali":"ML","Malta":"MT","Marshall Islands":"MH","Martinique":"MQ","Mauritania":"MR","Mauritius":"MU","Mayotte":"YT","Mexico":"MX","Micronesia, Federated States of":"FM","Moldova, Republic of":"MD","Monaco":"MC","Mongolia":"MN","Montenegro":"ME","Montserrat":"MS","Morocco":"MA","Mozambique":"MZ","Myanmar":"MM","Namibia":"NA","Nauru":"NR","Nepal":"NP","Netherlands":"NL","New Caledonia":"NC","New Zealand":"NZ","Nicaragua":"NI","Niger":"NE","Nigeria":"NG","Niue":"NU","Norfolk Island":"NF","Northern Mariana Islands":"MP","Norway":"NO","Oman":"OM","Pakistan":"PK","Palau":"PW","Palestine, State of":"PS","Panama":"PA","Papua New Guinea":"PG","Paraguay":"PY","Peru":"PE","Philippines":"PH","Pitcairn":"PN","Poland":"PL","Portugal":"PT","Puerto Rico":"PR","Qatar":"QA","Reunion":"RE","Romania":"RO","Russian Federation":"RU","Rwanda":"RW","Saint Barthelemy":"BL","Saint Helena, Ascension and Tristan da Cunha":"SH","Saint Kitts and Nevis":"KN","Saint Lucia":"LC","Saint Martin (French part)":"MF","Saint Pierre and Miquelon":"PM","Saint Vincent and the Grenadines":"VC","Samoa":"WS","San Marino":"SM","Sao Tome and Principe":"ST","Saudi Arabia":"SA","Senegal":"SN","Serbia":"RS","Seychelles":"SC","Sierra Leone":"SL","Singapore":"SG","Sint Maarten (Dutch part)":"SX","Slovakia":"SK","Slovenia":"SI","Solomon Islands":"SB","Somalia":"SO","South Africa":"ZA","South Georgia and the South Sandwich Islands":"GS","South Sudan":"SS","Spain":"ES","Sri Lanka":"LK","Sudan":"SD","Suriname":"SR","Svalbard and Jan Mayen":"SJ","Swaziland":"SZ","Sweden":"SE","Switzerland":"CH","Syrian Arab Republic":"SY","Taiwan, Province of China":"TW","Tajikistan":"TJ","Tanzania, United Republic of":"TZ","Thailand":"TH","Timor-Leste":"TL","Togo":"TG","Tokelau":"TK","Tonga":"TO","Trinidad and Tobago":"TT","Tunisia":"TN","Turkey":"TR","Turkmenistan":"TM","Turks and Caicos Islands":"TC","Tuvalu":"TV","Uganda":"UG","Ukraine":"UA","United Arab Emirates":"AE","United Kingdom":"GB","United States":"US","United States Minor Outlying Islands":"UM","Uruguay":"UY","Uzbekistan":"UZ","Vanuatu":"VU","Venezuela, Bolivarian Republic of":"VE","Viet Nam":"VN","Virgin Islands, British":"VG","Virgin Islands, U.S.":"VI","Wallis and Futuna":"WF","Western Sahara":"EH","Yemen":"YE","Zambia":"ZM","Zimbabwe":"ZW"};function processSearchSubmitForHotelCrossSearch(linkElement,flightsSearchUrl,doHotelCrossSearch,searchParams,fromHome){function cleanAllAirportsFullName(fullName){var cleanedName=fullName.replace(/\[[A-Z]{3}\]/,"").replace(/(<[^>]*?>)/g,"");var match=cleanedName.match(/^[^-]*/);if(match!=null){cleanedName=(match[0]).trim();}
return cleanedName;}
function getCityFromFullName(fullName){var city=null;var match=fullName.match(/^[^,]+/);if(match!=null){city=(match[0]).trim();}
return city;}
function getCountryFromFullName(fullName){var country=null;var match=fullName.match(/,([^-,]+)\s?-/);if(match!=null){country=(match[1]).trim();}
return country;}
function getAirportCodeFromString(string){if(typeof string==='undefined'||Object.prototype.toString.call(string)!=='[object String]'){return null;}
if(string.length==3){return string;}
var matches=string.match(/\[([a-zA-z]{3})\]/);return matches&&matches[1]?matches[1]:null;}
function isAirportCodeFormat(string){return string.match(/^[a-zA-Z]{3}$/)!==null};if(!searchParams.selectedCurrency||!searchParams.checkIn||!searchParams.firstTo){window.location=flightsSearchUrl;}
var bookingComSearchBaseUrl="/hotel/searchresults";var bookingBuddySearchBaseUrl=Mv.env.app.baseUrl+'hotel-offers';var hotelSearchFullUrlList=[];function redirectToRandomHotelSearch(){if(hotelSearchFullUrlList.length>0){window.location=hotelSearchFullUrlList[Math.floor((hotelSearchFullUrlList.length)*Math.random())];}}
var selectedCurrency=searchParams.selectedCurrency,checkIn=searchParams.checkIn,checkOut=searchParams.checkOut,firstTo=searchParams.firstTo,firstFrom=searchParams.firstFrom||searchParams.firstTo,seg0ToCode=searchParams.seg0ToCode,seg0FromCode=searchParams.seg0FromCode||searchParams.seg0ToCode,firstFromCode=seg0FromCode&&isAirportCodeFormat(seg0FromCode)?seg0FromCode:getAirportCodeFromString(firstFrom),firstToCode=seg0ToCode&&isAirportCodeFormat(seg0ToCode)?seg0ToCode:getAirportCodeFromString(firstTo),firstToIsCity=searchParams.firstToIsCity,numAdt=searchParams.numAdt||0,numChd=searchParams.numChd||0,numIns=searchParams.numIns||0,numInl=searchParams.numInl||0,tripType=searchParams.tripType,label=searchParams.label||'unknown',bookingBuddyMaxTravelers=4;fromHome=fromHome||false;if(!checkOut){var d=new Date(checkIn);d.setUTCDate(d.getUTCDate()+2);checkOut=d.getUTCFullYear()+"-"+(d.getUTCMonth()+1)+"-"+d.getUTCDate();}
if(selectedCurrency&&checkIn){var cityUnderscoredName=getCityFromFullName(firstTo).replace(/\s/g,"_");var bookingBuddySearchParams={city:firstToCode,date1:checkIn,date2:checkOut,travelers:parseInt(numAdt)+parseInt(numChd)};var bookingComSearchParams={selected_currency:selectedCurrency,dest_type:"airport",checkin:checkIn,checkout:checkOut,group_adults:numAdt,group_children:numChd,label:'ctz_xp_71_v2',iata:firstToCode,};if(Mv.env.user&&Mv.env.user.isMobile){bookingComSearchParams.label+="_mobile";}else{bookingComSearchParams.label+="_desktop";}
var jsonMajorCitiesCode=(Mv.env.app.parallelHotelSearch&&Mv.env.app.parallelHotelSearch.jsonMajorCitiesCode)?Mv.env.app.parallelHotelSearch.jsonMajorCitiesCode:null;if(!firstToCode||(firstToIsCity!=undefined&&firstToIsCity==="1")||((jsonMajorCitiesCode&&jsonMajorCitiesCode.indexOf(firstToCode)!==-1)||(firstTo.toLowerCase()).indexOf("all airport")!==-1)){delete bookingComSearchParams["iata"];bookingComSearchParams["dest_type"]="city";var cleanedCityName=cleanAllAirportsFullName(firstTo);bookingComSearchParams["ss"]=cleanedCityName;bookingBuddySearchParams.city=cleanedCityName;}
hotelSearchFullUrlList.push(bookingComSearchBaseUrl+"?"+$.param(bookingComSearchParams));}
var flightsSearchFullUrl=flightsSearchUrl;if(fromHome){flightsSearchFullUrl+="&newWindowFromHome=1";}
if(doHotelCrossSearch&&hotelSearchFullUrlList.length>0){function currentTabRedirect(){redirectToRandomHotelSearch();}
var clicktripzUrl="https://www.clicktripz.com/x/pas?";var siteId=window.location.href.includes('flighthub')?'flighthub.com':'justfly.com';var params=[];params.push("aid=23c0fd3a-74d0-4b85-bb87-d56f157671dc");if(Mv.env&&Mv.env.user){if(Mv.env.user.geoIpCountry){params.push("userCountry="+Mv.env.user.geoIpCountry);}}
params.push("siteID="+siteId);var affiliate=(window.Mv&&window.Mv.env&&window.Mv.env.user&&typeof window.Mv.env.user.affiliateId!=='undefined')?window.Mv.env.user.affiliateId:1;var trafficSource=window.location.href.split('?')[0]+'?affiliateId='+affiliate;params.push("origin="+firstFromCode);params.push("destination="+firstToCode);params.push("adults="+numAdt);params.push("startDate="+checkIn);params.push("endDate="+checkOut);params.push("trafficSource="+encodeURIComponent(trafficSource));clicktripzUrl+=params.join("&");currentTabRedirect=function(){if(window.isBookingUrlEnabled){window.location=hotelSearchFullUrlList[Math.floor((hotelSearchFullUrlList.length)*Math.random())];}else{window.location=clicktripzUrl;}}
setTimeout(currentTabRedirect,1000);$(linkElement).attr("target","_blank");}
$(linkElement).attr("href",flightsSearchFullUrl);};;function changeCountry(country_code,updateRegionParams){$.ajax({url:'/checkout/region-select/'+country_code,dataType:'json',success:function(data){var phoneCountryToSet=$('#billing_phone_country').attr("data-value-to-set");$('#billing_phone_country').prop('value',phoneCountryToSet||country_code);if(phoneCountryToSet){$('#billing_phone_country').removeAttr("data-value-to-set")}
var regionCodeToSet=$('select#cc_region_code').attr("data-value-to-set");var options=$(data.html).find("option");$('select#cc_region_code').html(options).val("").trigger("change");if(regionCodeToSet){$('select#cc_region_code').val(regionCodeToSet);$('select#cc_region_code').removeAttr("data-value-to-set")}
var dataSelector=country_code=='US'?'data-us-text':'data-gen-text';var required_html=' <span class="pink">*</span>';var zipRequired=(country_code!='CA')?required_html:"";var regionRequired=country_code!='US'||$('#region-select option').length>1?required_html:"";$('#zip-postal-code-label').html($('#zip-postal-code-label').attr(dataSelector)+zipRequired);$('#region-label').html($('#region-label').attr(dataSelector)+regionRequired);if(updateRegionParams){function recursiveRegionLevelCheck(selectElementId,spanElementQuery,valuesToSearch,counter){var selectElement=document.getElementById(selectElementId);var valueToSearch=removeDiacritics(valuesToSearch['regionName'+counter]);Object.keys(selectElement.children).some(function(key,index){if(selectElement.children[key].innerHTML.toLowerCase()==valueToSearch.toLowerCase()||selectElement.children[key].value.toLowerCase()==valuesToSearch['regionCode'+counter].toLowerCase()){selectElement.value=selectElement.children[key].value;document.getElementById(spanElementQuery).innerHTML=valueToSearch;return true;}else if(index===Object.keys(selectElement.children).length-1&&valuesToSearch['regionName'+(counter+1)]&&counter<2){return recursiveRegionLevelCheck(selectElementId,spanElementQuery,valuesToSearch,counter+1);}else{return false;}});}
setTimeout(function(){recursiveRegionLevelCheck(updateRegionParams.selectToUpdate,updateRegionParams.spanToUpdate,updateRegionParams.regionLevels,1);},1000);}}});};var StoredPaymentInfo={MAIN_WRAPPER_SELECTOR:"#billing_info_wrapper",PAYMENT_BOX_SELECTOR:"#payment_box",BILLING_BOX_SELECTOR:"#billing_box",MANUAL_PAYMENT_CONTAINER_SELECTOR:".manual-payment-box-wrap",STORED_PAYMENT_CONTAINER_SELECTOR:".stored-payment-box",MAIN_WRAPPER_USING_STORED_CLASS:"stored-payment-used",MAIN_WRAPPER_SHOW_MANUAL_CLASS:"manual-payment-shown",CHOICE_SELECTED_CLASS:"saved-payment-info-selected",CHOICE_HAS_PROCESSING_ERROR_CLASS:'has-saved-cc-processing-error',ATTENTION_LABEL_SELECTOR:".feedback-label.attention",CVV_INPUT_SELECTOR:"[name='cc_cvv']",TOGGLE_NEW_PAYMENT_SECTION_SELECTOR:'.add-new-cc-button',MANUAL_PAYMENT_SWITCH_SELECTOR:'[data-manual-payment-switch]',mainWrapper:null,storedPaymentContainer:null,manualPaymentContainer:null,billingInfoContainer:null,checkboxes:null,cvvInputs:null,init:function(){StoredPaymentInfo.mainWrapper=$(StoredPaymentInfo.MAIN_WRAPPER_SELECTOR);StoredPaymentInfo.storedPaymentContainer=$(StoredPaymentInfo.STORED_PAYMENT_CONTAINER_SELECTOR);StoredPaymentInfo.manualPaymentContainer=$(StoredPaymentInfo.MANUAL_PAYMENT_CONTAINER_SELECTOR);StoredPaymentInfo.billingInfoContainer=$(StoredPaymentInfo.BILLING_BOX_SELECTOR);StoredPaymentInfo.checkboxes=StoredPaymentInfo.storedPaymentContainer.find('input[type=checkbox]');StoredPaymentInfo.cvvInputs=StoredPaymentInfo.storedPaymentContainer.find(StoredPaymentInfo.CVV_INPUT_SELECTOR);StoredPaymentInfo.checkboxes.on("click",function(){StoredPaymentInfo.clearPaymentInfo();if($(this).is(":checked")){StoredPaymentInfo.selectChoice($(this).val());}else{StoredPaymentInfo.unselectChoices();}});$(StoredPaymentInfo.TOGGLE_NEW_PAYMENT_SECTION_SELECTOR).on('click',function(e){e.preventDefault();StoredPaymentInfo.toggleNewPaymentBox();});$(StoredPaymentInfo.MANUAL_PAYMENT_SWITCH_SELECTOR).on('click',function(e){e.preventDefault();StoredPaymentInfo.enableManualPaymentInputs();if(Mv.env.user.isMobile===true){scrollToElement(StoredPaymentInfo.storedPaymentContainer.find('.add-new-cc-button'),-10);}});},autofillPaymentInfo:function(paymentInfo){var inputsToClear=StoredPaymentInfo.manualPaymentContainer.find('input, select').add(StoredPaymentInfo.billingInfoContainer.find('input, select'));inputsToClear.each(function(){Validator.remove_errors($(this).attr("name"));});Validator.apply_errors();if(paymentInfo['cc_type']){StoredPaymentInfo.manualPaymentContainer.find("[name=cc_type_select]").val(paymentInfo['cc_type']);}
if(paymentInfo['cc_expiry_month']){StoredPaymentInfo.manualPaymentContainer.find("[name=cc_expiry_month]").val(paymentInfo['cc_expiry_month']);}
if(paymentInfo['cc_expiry_year']){StoredPaymentInfo.manualPaymentContainer.find("[name=cc_expiry_year]").val(paymentInfo['cc_expiry_year']);}
if(paymentInfo['cc_first_name']){StoredPaymentInfo.manualPaymentContainer.find("[name=cc_first_name]").val(paymentInfo['cc_first_name']);}
if(paymentInfo['cc_last_name']){StoredPaymentInfo.manualPaymentContainer.find("[name=cc_last_name]").val(paymentInfo['cc_last_name']);}
if(paymentInfo['cc_billing_address_line1']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_billing_address_line1]").val(paymentInfo['cc_billing_address_line1']);}
if(paymentInfo['cc_billing_address_line2']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_billing_address_line2]").val(paymentInfo['cc_billing_address_line2']);}
if(paymentInfo['cc_city']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_city]").val(paymentInfo['cc_city']);}
if(paymentInfo['cc_country_code']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_country_code]").val(paymentInfo['cc_country_code']).trigger("change");}
if(paymentInfo['cc_region_code']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_region_code]").val(paymentInfo['cc_region_code']).attr("data-value-to-set",paymentInfo['cc_region_code']);}
if(paymentInfo['cc_zip']){StoredPaymentInfo.billingInfoContainer.find("[name=cc_zip]").val(paymentInfo['cc_zip']);}
if(paymentInfo['billing_phone_country']){StoredPaymentInfo.billingInfoContainer.find("[name=billing_phone_country]").val(paymentInfo['billing_phone_country']).attr("data-value-to-set",paymentInfo['billing_phone_country']);}
if(paymentInfo['billing_phone']){StoredPaymentInfo.billingInfoContainer.find("[name=billing_phone]").val(paymentInfo['billing_phone']);}
if(paymentInfo['billing_phone_extension']){StoredPaymentInfo.billingInfoContainer.find("[name=billing_phone_extension]").val(paymentInfo['billing_phone_extension']);}},selectChoice:function(hash,softSelect){softSelect=softSelect||false;StoredPaymentInfo.removeErrorFocus();StoredPaymentInfo.checkboxes.prop("checked",false);StoredPaymentInfo.disableManualPaymentInputs();StoredPaymentInfo.mainWrapper.addClass(StoredPaymentInfo.MAIN_WRAPPER_USING_STORED_CLASS);var selected=StoredPaymentInfo.checkboxes.filter('[value="'+hash+'"]');var selectedParent=selected.parents('.stored-payment-info-selection').first();var storedPaymentInfo=JSON.parse(selected.attr('data-saved-payment-info'));if(storedPaymentInfo){StoredPaymentInfo.autofillPaymentInfo(storedPaymentInfo);}
selected.prop('checked',true);selectedParent.addClass(StoredPaymentInfo.CHOICE_SELECTED_CLASS);StoredPaymentInfo.activateOneCvvInput(selectedParent.find(StoredPaymentInfo.CVV_INPUT_SELECTOR),softSelect);},unselectChoices:function(){StoredPaymentInfo.removeErrorFocus();$(StoredPaymentInfo.CVV_INPUT_SELECTOR).each(function(){Validator.remove_errors($(this).attr("id"));$(this).prop('disabled',true).removeClass("error");});Validator.apply_errors();StoredPaymentInfo.mainWrapper.removeClass(StoredPaymentInfo.MAIN_WRAPPER_USING_STORED_CLASS);StoredPaymentInfo.checkboxes.prop("checked",false);StoredPaymentInfo.storedPaymentContainer.find("."+StoredPaymentInfo.CHOICE_SELECTED_CLASS).removeClass(StoredPaymentInfo.CHOICE_SELECTED_CLASS);StoredPaymentInfo.activateOneCvvInput($(StoredPaymentInfo.MANUAL_PAYMENT_CONTAINER_SELECTOR).find(StoredPaymentInfo.CVV_INPUT_SELECTOR));},errorFocusSelectedChoice:function(){var selectedRow=StoredPaymentInfo.checkboxes.filter(":checked").parents('.stored-payment-info-selection').first();selectedRow.addClass(StoredPaymentInfo.CHOICE_HAS_PROCESSING_ERROR_CLASS);selectedRow.find(StoredPaymentInfo.CVV_INPUT_SELECTOR).addClass("error");},removeErrorFocus:function(){StoredPaymentInfo.storedPaymentContainer.find('.'+StoredPaymentInfo.CHOICE_HAS_PROCESSING_ERROR_CLASS).removeClass(StoredPaymentInfo.CHOICE_HAS_PROCESSING_ERROR_CLASS);},clearPaymentInfo:function(){StoredPaymentInfo.manualPaymentContainer.find('input, select').each(function(){Validator.remove_errors($(this).attr("name"));});Validator.apply_errors();StoredPaymentInfo.manualPaymentContainer.find('input, select').prop('disabled',false).val("");StoredPaymentInfo.billingInfoContainer.find('input, select').val("");},disableManualPaymentInputs:function(){StoredPaymentInfo.manualPaymentContainer.find('input, select').each(function(){Validator.remove_errors($(this).attr("name"));$(this).prop('disabled',true);});Validator.apply_errors();StoredPaymentInfo.mainWrapper.removeClass(StoredPaymentInfo.MAIN_WRAPPER_SHOW_MANUAL_CLASS);},enableManualPaymentInputs:function(){StoredPaymentInfo.unselectChoices();StoredPaymentInfo.clearPaymentInfo();StoredPaymentInfo.openManualPaymentInputs();},openManualPaymentInputs:function(){StoredPaymentInfo.manualPaymentContainer.find('input, select').prop('disabled',false);StoredPaymentInfo.mainWrapper.addClass(StoredPaymentInfo.MAIN_WRAPPER_SHOW_MANUAL_CLASS);},resetAttentionLabels:function(){$(StoredPaymentInfo.ATTENTION_LABEL_SELECTOR).removeClass("active");},activateOneCvvInput:function(inputToActivate,softSelect){softSelect=softSelect||false;var self=this;$(StoredPaymentInfo.CVV_INPUT_SELECTOR).not(inputToActivate).each(function(){$(this).prop('disabled',true).removeClass("error");Validator.remove_errors($(this).attr("id"));});Validator.apply_errors();inputToActivate.prop('disabled',false);if(!softSelect&&inputToActivate.attr("id")!="cc_cvv"){inputToActivate.focus();}
this.resetAttentionLabels();inputToActivate.siblings(StoredPaymentInfo.ATTENTION_LABEL_SELECTOR).addClass("active");inputToActivate.on("mousedown.attention",function(){self.resetAttentionLabels();$(this).off("mousedown.attention");});},toggleNewPaymentBox:function(){if(StoredPaymentInfo.mainWrapper.hasClass(StoredPaymentInfo.MAIN_WRAPPER_SHOW_MANUAL_CLASS)){StoredPaymentInfo.disableManualPaymentInputs();}else{StoredPaymentInfo.enableManualPaymentInputs();}}};$(document).ready(function(){StoredPaymentInfo.init();setTimeout(function(){var preSelectedCheckbox=StoredPaymentInfo.checkboxes.filter("[data-preselected-payment-info]").first();if(preSelectedCheckbox.length>0){StoredPaymentInfo.clearPaymentInfo();StoredPaymentInfo.selectChoice(preSelectedCheckbox.val(),true);}},5000);});;window.Mv.jflyTooltip=function jflyTooltip(){var els={};var opt={responsiveBreakpoint:767,tinyBreakpoint:350,isSmallScreen:false,isTinyScreen:false,tooltipYSpacing:0,smallTooltipYSpacing:0,minimalTooltipYSpacing:8,cachedContents:{}};var cbs={prepareTooltip:prepareTooltip,displayTooltip:displayTooltip};function prepareTooltip(trigger,els,opt,cbs){}
function displayTooltip(trigger,els,opt,cbs){var props={};cbs.prepareTooltip(trigger,els,opt);props.bottom=$(document).height()-Math.abs(trigger.offset().top)+opt.minimalTooltipYSpacing-3;if(opt.isSmallScreen){props.left=trigger.offset().left;props.right='auto';props.bottom+=opt.smallTooltipYSpacing;}else{props.left='auto';props.right=($(window).width()-(trigger.offset().left+trigger.outerWidth()));props.bottom+=opt.tooltipYSpacing;}
els.tooltip.css(props);els.tooltip.show();}
function addHoverEvents(){$(els.triggerSelector).mouseenter(function(){cbs.displayTooltip($(this),els,opt,cbs);});$(els.triggerSelector).mouseleave(function(){els.tooltip.hide();});}
function removeHoverEvents(){$(els.triggerSelector).off('mouseenter');$(els.triggerSelector).off('mouseleave');}
function reloadHoverEvents(event){removeHoverEvents();addHoverEvents();}
function updateScreenState(){opt.isSmallScreen=($(window).width()<=opt.responsiveBreakpoint);opt.isTinyScreen=($(window).width()<=opt.tinyBreakpoint);}
function init(elsArg,optArg,cbsArg){els=_.extend(els,elsArg);opt=_.extend(opt,optArg);cbs=_.extend(cbs,cbsArg);updateScreenState();$(window).on('resize',updateScreenState);addHoverEvents();$('body').on({'faresReloaded':reloadHoverEvents,'filter-action-success':reloadHoverEvents});}
return{init:init};};;(function(){function launch(){var amenitiesModule=window.Mv.jflyTooltip();function prepareTooltip(trigger,els,opt,cbs){var flightAmenity=trigger.find('.flight-amenity');if(_.isUndefined(flightAmenity)){return;}
flightAmenity.each(function(index,amenity){var row=els.tooltip.find($(amenity).data('class'));if($(amenity).data('available')){row.removeClass('disabled');}else{row.addClass('disabled');}
row.find('.text').html($(amenity).data('text'));});}
amenitiesModule.init({tooltip:$('#flight-amenities-tooltip'),triggerSelector:'.flight-amenities'},{},{prepareTooltip:prepareTooltip});}
$(document).ready(function(){var body=$('body');if(typeof new_search!=='undefined'&&new_search){body.on('fareLoaderInitialUpdate',launch);}else{launch();}
body.on('filtersApplied',launch);});})();;(function(){function launch(){var stopsModule=window.Mv.jflyTooltip();function prepareTooltip(trigger,els,opt,cbs){var uniqueId;var content;var builtContent;uniqueId=trigger.data('uniqueId');if(uniqueId in opt.cachedContents){content=opt.cachedContents[uniqueId];}else{content=trigger.data('display');builtContent='';for(var i=0;i<content.length;i++){builtContent+='<li>'+content[i].airport+'<sup>*</sup></li>';}
content=opt.cachedContents[uniqueId]=builtContent;}
els.tooltipContent.html(content);}
stopsModule.init({tooltip:$('#stops-tooltip'),tooltipContent:$('#stops-tooltip-content'),triggerSelector:'.stops-toggler'},{smallTooltipYSpacing:2},{prepareTooltip:prepareTooltip});}
$(document).ready(function(){var body=$('body');if(typeof new_search!=='undefined'&&new_search){body.on('fareLoaderInitialUpdate',launch);}else{launch();}
body.on('filtersApplied',launch);});})();;(function(){function launch(){var basicEconomyInfoModule=window.Mv.jflyTooltip();function prepareTooltip(trigger,els,opt,cbs){var parent=trigger.closest('.city-pair');var cityPairCarrier=parent.find('.column.carrier').data('carrier');if(_.isUndefined(cityPairCarrier)){return;}
var cabinName='Standard Economy';if(cityPairCarrier==='DL'){els.tooltip.addClass('is-delta');}else{els.tooltip.removeClass('is-delta');}
if(cityPairCarrier==='AA'){cabinName='Main Cabin';els.tooltip.find('.carry_on').hide();}else{els.tooltip.find('.carry_on').show();}
els.tooltip.find('.js-title').html(cabinName);}
basicEconomyInfoModule.init({tooltip:$('#basic-economy-details-tooltip'),triggerSelector:'.js-basic-economy-details'},{},{prepareTooltip:prepareTooltip});}
$(document).ready(function(){var body=$('body');if(typeof new_search!=='undefined'&&new_search){body.on('fareLoaderInitialUpdate',launch);}else{launch();}
body.on('filtersApplied',launch);});})();;/*!
* Datepicker
* https://github.com/fengyuanchen/datepicker
*
* Copyright (c) 2014-@YEAR Fengyuan Chen
* Released under the MIT license
*
*
*/(function(factory){if(typeof define==='function'&&define.amd){define('datepicker',['jquery'],factory);}else if(typeof exports==='object'){factory(require('jquery'));}else{factory(jQuery);}})(function($){'use strict';var $window=$(window);var document=window.document;var $document=$(document);var Number=window.Number;var NAMESPACE='datepicker';var EVENT_CLICK='click.'+NAMESPACE;var EVENT_KEYUP='keyup.'+NAMESPACE;var EVENT_FOCUS='focus.'+NAMESPACE;var EVENT_RESIZE='resize.'+NAMESPACE;var EVENT_SHOW='show.'+NAMESPACE;var EVENT_HIDE='hide.'+NAMESPACE;var EVENT_PICK='pick.'+NAMESPACE;var EVENT_DAY_READY='day.ready.'+NAMESPACE;var EVENT_RELOAD='reload.'+NAMESPACE;var REGEXP_FORMAT=/(y|m|d)+/g;var REGEXP_DIGITS=/\d+/g;var CLASS_DROPDOWN=NAMESPACE+'-dropdown';var CLASS_HIDE=NAMESPACE+'-hide';var calendarClasses={td:{regular:"",disabled:"ui-datepicker-unselectable ui-state-disabled",today:"ui-datepicker-days-cell-over ui-datepicker-today",selected:"ui-datepicker-current-day",empty:"ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled ui-state-empty",selection:"ui-datepicker-selection",},tdInnerElem:{regular:"ui-state-default",disabled:"ui-state-default ui-state-disabled",today:"ui-state-default ui-state-highlight",selected:"ui-state-default ui-state-active",selectedOther:"ui-state-default ui-state-active-other",selection:"ui-state-default ui-state-selection",empty:"",tagName:'a',tierPricedCheap:'date-priced date-priced-cheap',tierPricedAverage:'date-priced date-priced-average',tierPricedExpensive:'date-priced date-priced-expensive',tierPricedUnknown:'date-priced date-priced-unknown',},moneyValElem:{regular:"money-val",best:"best-price",worst:"worst-price"}};var VIEWS={DAYS:0,MONTHS:1,YEARS:2};var min=Math.min;var toString=Object.prototype.toString;function typeOf(obj){return toString.call(obj).slice(8,-1).toLowerCase();}
function isString(str){return typeof str==='string';}
function isNumber(num){return typeof num==='number'&&!isNaN(num);}
function isUndefined(obj){return typeof obj==='undefined';}
function isDate(date){return typeOf(date)==='date';}
function toArray(obj,offset){var args=[];if(Array.from){return Array.from(obj).slice(offset||0);}
if(isNumber(offset)){args.push(offset);}
return args.slice.apply(obj,args);}
function proxy(fn,context){var args=toArray(arguments,2);return function(){return fn.apply(context,args.concat(toArray(arguments)));};}
function isLeapYear(year){return(year%4===0&&year%100!==0)||year%400===0;}
function getDaysInMonth(year,month){return[31,(isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];}
function parseFormat(format){var source=String(format).toLowerCase();var parts=source.match(REGEXP_FORMAT);var length;var i;if(!parts||parts.length===0){throw new Error('Invalid date format.');}
format={source:source,parts:parts};length=parts.length;for(i=0;i<length;i++){switch(parts[i]){case 'dd':case 'd':format.hasDay=true;break;case 'mm':case 'm':format.hasMonth=true;break;case 'yyyy':case 'yy':format.hasYear=true;break;}}
return format;}
function Datepicker(element,options){options=$.isPlainObject(options)?options:{};if(options.language){options=$.extend({},Datepicker.LANGUAGES[options.language],options);}
this.$element=this.$controller=$(element);this.options=$.extend({},Datepicker.DEFAULTS,options);this.isBuilt=false;this.isShown=false;this.isInput=false;this.isInline=false;this.initialValue='';this.initialDate=null;this.startDate=null;this.previousDate=null;this.nextDate=null;this.endDate=null;this.percentiles={};this.matrix={};this.cashDatesEnabled=this.options.cashDatesEnabled;this.setCashDates(this.options.cashDates);this.today=new Date();this.currentYear=this.today.getFullYear();this.currentMonth=this.today.getMonth();this.currentDate=this.today.getDate();this.isInstantCalendar=false;this.isPricedCalendar=false;this.isPricedCalendarV2=false;this.isPricedCalendarV3=false;this.legendTripType='round-trip';this.legendCurrency='USD';this.init();}
Datepicker.prototype={constructor:Datepicker,init:function(){var options=this.options;var $this=this.$element;var startDate=options.startDate;var endDate=options.endDate;var date=options.date;this.$trigger=$(options.trigger);this.isInput=$this.is('input')||$this.is('textarea');this.isInline=options.inline&&(options.container||!this.isInput);this.format=parseFormat(options.format);this.oldValue=this.initialValue=this.getValue();date=this.parseDate(date||this.initialValue);if(startDate){startDate=this.parseDate(startDate);if(date.getTime()<startDate.getTime()){date=new Date(startDate);}
this.startDate=startDate;}
if(endDate){endDate=this.parseDate(endDate);if(startDate&&endDate.getTime()<startDate.getTime()){endDate=new Date(startDate);}
if(date.getTime()>endDate.getTime()){date=new Date(endDate);}
this.endDate=endDate;}
this.date=date;this.viewDate=new Date(date);this.initialDate=new Date(this.date);this.bind();if(options.autoShow||this.isInline){this.show();}
if(options.autoPick){this.pick();}
$window.on(EVENT_RELOAD,function(){if(this.cashDatesEnabled&&this.isShown&&this.isBuilt){this.fillDays();}}.bind(this));},build:function(){var $picker;if(this.isBuilt){return;}
this.isBuilt=true;this.$picker=$picker=$(this.options.template);this.$week=$picker.find('[data-view="week"]');this.$firstMonthMarkup=null;this.$secondMonthMarkup=null;this.$daysPicker=$picker.find('[data-view="days picker"]');this.$monthPrev=$picker.find('[data-view="month prev"]');this.$monthCurrent=$picker.find('[data-view="month current"]');this.$days=$picker.find('[data-view="days"]');this.$nextDays=$picker.find('[data-view="next days"]');this.$nextMonth=$picker.find('[data-view="next month"]');this.$monthNext=$picker.find('[data-view="month next"]');$(document.body).append($picker.addClass(CLASS_DROPDOWN));$picker.addClass(CLASS_HIDE);$picker.on("mousedown",function(){this.$controller.trigger("date-picker-mousedown");}.bind(this));this.fillWeekDaysMarkup();this.fillDaysMarkup();},setPercentiles:function(percentiles){this.clearLegend();if(!percentiles){return;}
this.percentiles=percentiles;},setMatrix:function(matrix){this.matrix={};if(matrix&&Object.keys(matrix).length){this.matrix=matrix;}},hasPercentiles:function(){return this.cashDatesEnabled&&Object.keys(this.percentiles).length>0;},setIsInstantSearchCalendar:function(enableInstantCalendar){this.isInstantCalendar=enableInstantCalendar;},setIsPricedCalendar:function(enabledPricedCalendar){this.isPricedCalendar=enabledPricedCalendar;},setIsPricedCalendarV2:function(enabledPricedCalendarV2){this.isPricedCalendarV2=enabledPricedCalendarV2;},setIsPricedCalendarV3:function(enabledPricedCalendarV3){this.isPricedCalendarV3=enabledPricedCalendarV3;if(enabledPricedCalendarV3){document.documentElement.classList.add('alternate-datepicker');}else{document.documentElement.classList.remove('alternate-datepicker');}},setLegendTripType:function(tripType){this.legendTripType=tripType;},setLegendCurrency:function(currency){this.legendCurrency=currency;},setCashDates:function(newCashDates){var lowest=90001;var highest=0;var loopedCashDate;if(!newCashDates){this.cashDates={};return;}
this.cashDates=newCashDates;for(var cashDate in newCashDates){loopedCashDate=newCashDates[cashDate];if(lowest>loopedCashDate){lowest=loopedCashDate;}
if(highest<loopedCashDate){highest=loopedCashDate;}}
this.cashDates.lowest=lowest;},loading:function(){if(!this.$picker){return this;}
this.doneLoading().$picker.append('<div class="spinner"></div>');},doneLoading:function(){if(!this.$picker){return this;}
this.$picker.find('.spinner').remove();return this;},clearLegend:function(){if(!this.$picker){return this;}
this.$picker.find('legend').remove();return this;},createLegend:function(){if(!this.$picker){return;}
this.clearLegend();if(this.isPricedCalendar&&this.isPricedCalendarV3){this.$picker.append('<legend>'
+'<div>'
+'<div class="item deal">'
+'$'+this.matrix['low']+'+ '+this.legendCurrency
+'</div>'
+'<div class="item avg">'
+'$'+this.matrix['medium']+'+ '+this.legendCurrency
+'</div>'
+'<div class="item pricey">'
+'$'+this.matrix['high']+'+ '+this.legendCurrency
+'</div>'
+'</div>'
+'<div class="disclaimer">'
+'Estimated prices for '+(this.legendTripType)+' flights'
+'</div>'
+'</legend>');return;}
if(this.isPricedCalendar&&this.isPricedCalendarV2){this.$picker.append('<legend>'
+'<div>'
+'<div class="item deal">'
+'$'
+'</div>'
+'<div class="item avg">'
+'$$'
+'</div>'
+'<div class="item pricey">'
+'$$$'
+'</div>'
+'</div>'
+'</legend>');return;}
if(!this.hasPercentiles()){return;}
if(this.isPricedCalendar){this.$picker.append('<legend>'
+'<div>'
+'<div class="item deal">'
+'$'+this.matrix['low']+'+ '+this.legendCurrency
+'</div>'
+'<div class="item avg">'
+'$'+this.matrix['medium']+'+ '+this.legendCurrency
+'</div>'
+'<div class="item pricey">'
+'$'+this.matrix['high']+'+ '+this.legendCurrency
+'</div>'
+'</div>'
+'<div class="disclaimer">'
+'Estimated prices for '+(this.legendTripType)+' flights'
+'</div>'
+'</legend>');return;}
this.$picker.append('<legend>'
+'<div>'
+'<div class="item deal">'
+'<span></span> From $'+(this.matrix[30]?this.matrix[30]:this.cashDates.lowest)
+'</div>'
+'<div class="item avg">'
+'<span></span> From $'+(this.matrix[80]?this.matrix[80]:'')
+'</div>'
+'<div class="item pricey">'
+'<span></span> From $'+(this.matrix[100]?this.matrix[100]:'')
+'</div>'
+'</div>'
+'<div>'
+'Estimated price per passenger including taxes and fees.'
+'</div>'
+'</legend>');},clearMenu:function(){if(!this.$picker)return;this.$picker.find('.datepicker__menu').remove();},createMenu:function(){if(!this.$picker)return;this.clearMenu();if(!(this.isPricedCalendar&&this.isPricedCalendarV3))return;this.$picker.append('<div class="datepicker__menu">'
+'<button class="datepicker__button-clear" type="reset" role="button">Clear Selection</button>'
+'</div>');$('.datepicker__button-clear').on('click',function(){$(document).trigger('clear-datepicker-selection');});},setStartDate:function(date){if(isDate(date)||isString(date)){this.startDate=this.parseDate(date);if(this.isBuilt){this.fillDays();}}},setPreviousDate:function(date){if(isDate(date)||isString(date)){this.previousDate=this.parseDate(date);if(this.isBuilt){this.fillDays();}}else{this.previousDate=null;if(this.isBuilt){this.fillDays();}}},setNextDate:function(date){if(isDate(date)||isString(date)){this.nextDate=this.parseDate(date);if(this.isBuilt){this.fillDays();}}else{this.nextDate=null;if(this.isBuilt){this.fillDays();}}},bind:function(){var options=this.options;var $this=this.$element;if($.isFunction(options.show)){$this.on(EVENT_SHOW,options.show);}
if($.isFunction(options.hide)){$this.on(EVENT_HIDE,options.hide);}
if($.isFunction(options.pick)){$this.on(EVENT_PICK,options.pick);}
if(this.isInput){$this.on(EVENT_KEYUP,$.proxy(this.keyup,this));}
if(!this.isInline){if(options.trigger){this.$trigger.on(EVENT_CLICK,$.proxy(this.toggle,this));}else if(this.isInput){$this.on(EVENT_FOCUS,$.proxy(this.show,this));}else{$this.on(EVENT_CLICK,$.proxy(this.show,this));}}},showView:function(view){var $daysPicker=this.$daysPicker;var format=this.format;if(format.hasYear||format.hasMonth||format.hasDay){switch(Number(view)){case VIEWS.YEARS:case 'years':if(format.hasYear){this.place();}else{this.showView(VIEWS.DAYS);}
break;case VIEWS.MONTHS:case 'months':if(format.hasMonth){this.place();}else{this.showView(VIEWS.YEARS);}
break;default:if(format.hasDay){this.fillDays();$daysPicker.removeClass(CLASS_HIDE);this.place();}else{this.showView(VIEWS.MONTHS);}}}},hideView:function(){this.$element.blur();this.hide();},changeElem:function(newElem){this.$element=newElem;},place:function(){var left,containerWidth;if(this.isInline){return;}
left=this.$element.offset().left;containerWidth=$document.outerWidth();if((left+this.$picker.outerWidth())>containerWidth){left=left-((left+this.$picker.outerWidth())-containerWidth);}
this.$picker.css({top:this.$element.offset().top+this.$element.outerHeight(),left:left});},trigger:function(type,data){var e=$.Event(type,data);this.$element.trigger(e);return e;},fillWeekDaysMarkup:function(){var options=this.options;var weekStart=parseInt(options.weekStart,10)%7;var days=options.daysMin;var list='';var i;days=$.merge(days.slice(weekStart),days.slice(0,weekStart));for(i=0;i<=6;i++){list+=('<th class="ui-datepicker-week-end"><span>'+
days[i]+
'</th></span>');}
this.$week.html(list);},fillDaysMarkup:function(){var columns=7;var rows=6;for(var i=0;i<rows;i++){var row=$(document.createElement("tr"));for(var j=0;j<columns;j++){row.append($(document.createElement("td")).html($(document.createElement("a")).addClass("ui-state-default").attr("href","#").html('1')));}
this.$days.append(row);this.$nextDays.append(row.clone());}
this.$firstMonthMarkup=this.$days;this.$secondMonthMarkup=this.$nextDays;},fillCalendarDays:function(els,calMonth,calYear,calNum){var date;var globalCount=0;var monthDays;var startEmptyDays;var selectedDay=this.date;var selectedYear=selectedDay.getFullYear();var selectedMonth=selectedDay.getMonth();var selectedDate=selectedDay.getDate();startEmptyDays=new Date(calYear,calMonth,1).getDay();for(var i=0;i<startEmptyDays;i++,globalCount++){$(els[globalCount]).removeClass().addClass(calendarClasses.td.empty).find(calendarClasses.tdInnerElem.tagName).removeClass().empty();}
monthDays=getDaysInMonth(calYear,calMonth);for(i=1;i<=monthDays;i++,globalCount++){var sel={text:i,dataDate:i,dataView:"day",tdClasses:calendarClasses.td.regular,tdInnerClasses:calendarClasses.tdInnerElem.regular};var innerElem=$(els[globalCount]).find(calendarClasses.tdInnerElem.tagName);var moneyValElem;date=new Date(calYear,calMonth,i);var isToday=this.currentDate===i&&this.currentMonth===calMonth&&this.currentYear===calYear;var isSelected=selectedDate===i&&selectedMonth===calMonth&&selectedYear===calYear;var isPrevious=this.previousDate&&this.previousDate.toDateString()===date.toDateString();var isNext=this.nextDate&&this.nextDate.toDateString()===date.toDateString();if(isSelected||(this.isPricedCalendar&&!this.isPricedCalendarV3&&isPrevious)){sel["tdClasses"]=calendarClasses.td.selected;sel["tdInnerClasses"]=calendarClasses.tdInnerElem.selected;}else if(this.startDate&&this.startDate.getTime()>date.getTime()||(this.$element[0].id=="esim-return-date"&&this.endDate&&this.endDate.getTime()<date.getTime())){sel["dataDate"]=0;sel["tdClasses"]=calendarClasses.td.disabled;sel["tdInnerClasses"]=calendarClasses.tdInnerElem.disabled;sel["dataView"]="day-disabled";}else if(isToday){sel["tdClasses"]=calendarClasses.td.today;sel["tdInnerClasses"]=calendarClasses.tdInnerElem.today;}else if(this.isPricedCalendarV3&&isPrevious){sel["tdClasses"]=calendarClasses.td.selected;sel["tdInnerClasses"]=calendarClasses.tdInnerElem.selectedOther;}else if(this.isPricedCalendarV3&&isNext){sel["tdClasses"]=calendarClasses.td.selected;sel["tdInnerClasses"]=calendarClasses.tdInnerElem.selectedOther;}else if(this.isPricedCalendarV3&&this.previousDate&&this.previousDate<date&&date<selectedDay){sel["tdClasses"]+=' '+calendarClasses.td.selection;sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.selection;}else if(this.isPricedCalendarV3&&this.nextDate&&this.nextDate>date&&date>selectedDay){sel["tdClasses"]+=' '+calendarClasses.td.selection;sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.selection;}
if(this.isPricedCalendar&&(isToday||date>this.today)){var dateData={};if(this.previousDate&&this.previousDate<date&&date<selectedDay)
{sel["tdClasses"]+=' '+calendarClasses.td.selection;sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.selection;}
else if((this.isPricedCalendarV2||this.isPricedCalendarV3)&&(dateData=this.getDateCashVal(calYear,calMonth+1,i)))
{switch(dateData.tier){case 'low':sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedCheap;break;case 'avg':sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedAverage;break;case 'high':sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedExpensive;break;default:sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedUnknown;break;}}
else if((sel.cash=this.getDateCashVal(calYear,calMonth+1,i)))
{sel.percentile=this.getPercentileVal(calYear,calMonth+1,i);if(sel.cash===-1){sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedUnknown;}else if(sel.percentile==='low'){sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedCheap;}else if(sel.percentile==='medium'){sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedAverage;}else if(sel.percentile==='high'){sel["tdInnerClasses"]+=' '+calendarClasses.tdInnerElem.tierPricedExpensive;}}}
if(!this.isPricedCalendar&&this.cashDatesEnabled&&sel["dataView"]!=="day-disabled"&&(sel.cash=this.getDateCashVal(calYear,calMonth+1,i))){sel.percentile=this.getPercentileVal(calYear,calMonth+1,i);if((moneyValElem=(innerElem.find(".money-val"))).length===0){moneyValElem=$(document.createElement("div")).appendTo(innerElem).addClass(calendarClasses.moneyValElem.regular);}
if(sel.cash<=this.cashDates.lowest){moneyValElem.addClass(calendarClasses.moneyValElem.best);}else if(sel.cash>=this.cashDates.highest){moneyValElem.addClass(calendarClasses.moneyValElem.worst);}else{moneyValElem.removeClass(calendarClasses.moneyValElem.best).removeClass(calendarClasses.moneyValElem.worst);}
sel.tdInnerClasses+=' has-cash-date';}else if((moneyValElem=(innerElem.find(".money-val"))).length>0){moneyValElem.hide();}
$(els[globalCount]).removeClass().addClass(sel.tdClasses);innerElem.attr("data-view",sel.dataView).attr("data-date",sel.dataDate).attr("data-cal-num",calNum).attr("data-cal-selector-formated",date.toISOString().slice(0,10)).removeClass().addClass(sel.tdInnerClasses).parent().addClass(sel.percentile?(' percentile-'+sel.percentile):'');if(innerElem.get(0).firstChild&&innerElem.get(0).firstChild.nodeType===3){innerElem.get(0).firstChild.nodeValue=sel.text;}else{innerElem.prepend(sel.text);}}
for(;$(els[globalCount]).length>0;globalCount++){$(els[globalCount]).removeClass().addClass(calendarClasses.td.empty).find(calendarClasses.tdInnerElem.tagName).removeClass().empty();}
this.createLegend();this.createMenu();},fillDays:function(){var nextMonth=this.viewDate.getMonth()+1;var nextYear=this.viewDate.getFullYear();if(nextMonth>11){nextMonth=0;nextYear++;}
if(this.$picker){if(this.isInstantCalendar){this.$picker.addClass('instant_search');}
if(this.isPricedCalendar){this.$picker.addClass('priced_calendar');}else{this.$picker.removeClass('priced_calendar');}}
if(this.$firstMonthMarkup){this.fillCalendarDays(this.$firstMonthMarkup.find("td"),this.viewDate.getMonth(),this.viewDate.getFullYear(),0);}
if(this.$secondMonthMarkup){this.fillCalendarDays(this.$secondMonthMarkup.find("td"),nextMonth,nextYear,1);}
if(this.$monthCurrent){this.$monthCurrent.html(this.options.months[this.viewDate.getMonth()]+' '+this.viewDate.getFullYear());}
if(this.$nextMonth){this.$nextMonth.html(this.options.months[nextMonth]+' '+nextYear);}
this.refreshBackButton();if(this.$element[0].id==="esim-return-date"||this.$element[0].id==="esim-departure-date"){this.refreshNextButton();}},refreshBackButton:function(){var firstDay=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth(),1);if(this.startDate.getTime()>=firstDay.getTime()){this.$monthPrev.parent().addClass("ui-state-disabled");this.$monthPrev.addClass("disabled");return;}
this.$monthPrev.parent().removeClass("ui-state-disabled");this.$monthPrev.removeClass("disabled");},refreshNextButton:function(){if(!this.endDate){return;}
if(this.$element[0].id=="esim-return-date"&&this.endDate.getMonth()<=new Date(this.$nextMonth[0].innerText).getMonth()){this.$monthNext.parent().addClass("ui-state-disabled");this.$monthNext.addClass("disabled");return;}
this.$monthNext.parent().removeClass("ui-state-disabled");this.$monthNext.removeClass("disabled");},getDateCashVal:function(year,month,date){var dateString=year+'-'+("0"+month).slice(-2)+'-'+("0"+date).slice(-2);return this.cashDates[dateString]||null;},getPercentileVal:function getPercentileVal(year,month,date){var dateString=year+'-'+("0"+month).slice(-2)+'-'+("0"+date).slice(-2),percentile=this.percentiles[dateString]||null;if(percentile&&typeof percentile==='object'){percentile=Math.min.apply(null,Object.values(percentile));}
return percentile;},click:function(e){var calNum;var count=0;var lookLimit=2;var view;var viewDate=this.viewDate;var viewDay;var viewMonth;var viewYear;var $target=$(e.target);e.stopPropagation();e.preventDefault();if($target.hasClass("disabled")){return;}
viewYear=viewDate.getFullYear();viewMonth=viewDate.getMonth();viewDay=viewDate.getDate();view=$target.attr('data-view');while(view===undefined){if(count++>lookLimit){return;}
if((this.$element[0].id==="esim-return-date"||this.$element[0].id==="esim-departure-date")&&($target[0].className=="ui-datepicker-next ui-corner-all"||$target[0].className=="ui-datepicker-prev ui-corner-all")){$target=$target.children();}
else{$target=$target.parent();}
view=$target.attr("data-view");}
switch(view){case "month prev":case "month next":viewMonth=view==="month prev"?viewMonth-1:view==="month next"?viewMonth+1:viewMonth;this.viewDate=new Date(viewYear,viewMonth,min(viewDay,28));this.fillDays();break;case "day":calNum=parseInt($target.data("cal-num"));if(calNum){viewMonth+=calNum;if(viewMonth>11){viewMonth=0;viewYear++;}}
viewDay=parseInt($target.attr("data-date"),10);this.date=this.viewDate=new Date(viewYear,viewMonth,viewDay);this.hideView();this.pick();break;}},keyupDoc:function(e){if(this.isInput&&e.target!==this.$element[0]&&this.isShown&&(e.key==='Tab'||e.keyCode===9)){this.hide();}},getValue:function(){var $this=this.$element;var val='';if(this.isInput){val=$this.val();}else if(this.isInline){if(this.options.container){val=$this.text();}}else{val=$this.text();}
return val;},setValue:function(val){var $this=this.$element;val=isString(val)?val:'';if(this.isInput){$this.val(val);}else if(this.isInline){if(this.options.container){$this.text(val);}}else{$this.text(val);}},show:function(elem){if(!this.isBuilt){this.build();}
if(this.isShown){return;}
if(this.trigger(EVENT_SHOW).isDefaultPrevented()){return;}
this.isShown=true;this.$picker.removeClass(CLASS_HIDE).on(EVENT_CLICK,$.proxy(this.click,this));this.showView(this.options.startView);if(!this.isInline){$window.on(EVENT_RESIZE,(this._place=proxy(this.place,this)));$document.on(EVENT_KEYUP,(this._keyupDoc=proxy(this.keyupDoc,this)));this.place(elem);}},hide:function(){if(!this.isShown){return;}
if(this.trigger(EVENT_HIDE).isDefaultPrevented()){return;}
this.isShown=false;this.$picker.addClass(CLASS_HIDE).off(EVENT_CLICK,this.click);if(!this.isInline){$window.off(EVENT_RESIZE,this._place);$document.off(EVENT_KEYUP,this._keyupDoc);}},toggle:function(){if(this.isShown){this.hide();}else{this.show();}},update:function(){var value=this.getValue();if(value===this.oldValue){return;}
this.setDate(value,true);this.oldValue=value;},pick:function(){this.$controller.trigger("date-picker-selection",[this.formatDate(this.date)]);},reset:function(){this.setDate(this.initialDate,true);this.setValue(this.initialValue);if(this.isShown){this.showView(this.options.startView);}},getDate:function(formatted){var date=this.date;return formatted?this.formatDate(date):new Date(date);},setDate:function(date,_isUpdated){var filter=this.options.filter;if(isDate(date)||isString(date)){date=this.parseDate(date);if($.isFunction(filter)&&filter.call(this.$element,date)===false){return;}
this.date=date;this.viewDate=new Date(date);if(this.isBuilt){this.fillDays();}}},resetDate:function(){this.date=new Date("1900-10-10");},setViewDate:function(date){var filter=this.options.filter;if(isDate(date)||isString(date)){date=this.parseDate(date);if($.isFunction(filter)&&filter.call(this.$element,date)===false){return;}
this.viewDate=new Date(date);if(this.isBuilt){this.fillDays();}}},setEndDate:function(date){if(isDate(date)||isString(date)){this.endDate=this.parseDate(date);if(this.isBuilt){this.fillDays();}}},parseDate:function(date){var format=this.format;var parts=[];var length;var year;var day;var month;var val;var i;if(isDate(date)){return new Date(date.getFullYear(),date.getMonth(),date.getDate());}else if(isString(date)){parts=date.match(REGEXP_DIGITS)||[];}
date=new Date();year=date.getFullYear();day=date.getDate();month=date.getMonth();length=format.parts.length;if(parts.length===length){for(i=0;i<length;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case 'dd':case 'd':day=val;break;case 'mm':case 'm':month=val-1;break;case 'yy':year=2000+val;break;case 'yyyy':year=val;break;}}}
return new Date(year,month,day);},formatDate:function(date){var format=this.format;var formatted='';var length;var year;var part;var val;var i;if(isDate(date)){formatted=format.source;year=date.getFullYear();val={d:date.getDate(),m:date.getMonth()+1,yy:year.toString().substring(2),yyyy:year};val.dd=(val.d<10?'0':'')+val.d;val.mm=(val.m<10?'0':'')+val.m;length=format.parts.length;for(i=0;i<length;i++){part=format.parts[i];formatted=formatted.replace(part,val[part]);}}
return formatted;},};Datepicker.LANGUAGES={};Datepicker.DEFAULTS={autoShow:false,autoHide:false,autoPick:false,inline:false,container:null,trigger:null,language:'',format:'mm/dd/yyyy',date:null,startDate:null,endDate:null,startView:0,weekStart:0,yearFirst:false,yearSuffix:'',days:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],daysShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],daysMin:['Su','Mo','Tu','We','Th','Fr','Sa'],months:['January','February','March','April','May','June','July','August','September','October','November','December'],monthsShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],itemTag:'li',mutedClass:'muted',pickedClass:'picked',disabledClass:'disabled',highlightedClass:'highlighted',template:('<div class="datepicker-container">'+
'<div class="datepicker-panel" data-view="years picker">'+
'<ul>'+
'<li data-view="years prev">&lsaquo;</li>'+
'<li data-view="years current"></li>'+
'<li data-view="years next">&rsaquo;</li>'+
'</ul>'+
'<ul data-view="years"></ul>'+
'</div>'+
'<div class="datepicker-panel" data-view="months picker">'+
'<ul>'+
'<li data-view="year prev">&lsaquo;</li>'+
'<li data-view="year current"></li>'+
'<li data-view="year next">&rsaquo;</li>'+
'</ul>'+
'<ul data-view="months"></ul>'+
'</div>'+
'<div class="datepicker-panel" data-view="days picker">'+
'<ul>'+
'<li data-view="month prev">&lsaquo;</li>'+
'<li data-view="month current"></li>'+
'<li data-view="month next">&rsaquo;</li>'+
'</ul>'+
'<ul data-view="week"></ul>'+
'<ul data-view="days"></ul>'+
'</div>'+
'</div>'),offset:10,zIndex:1000,filter:null,show:null,hide:null,pick:null};Datepicker.setDefaults=function(options){options=$.isPlainObject(options)?options:{};if(options.language){options=$.extend({},Datepicker.LANGUAGES[options.language],options);}
$.extend(Datepicker.DEFAULTS,options);};Datepicker.other=$.fn.datePickerModule;$.fn.datePickerModule=function(option){var args=toArray(arguments,1);var result;this.each(function(){var $this=$(this);var data=$this.data(NAMESPACE);var options;var fn;if(!data){if(/destroy/.test(option)){return;}
options=$.extend({},$this.data(),$.isPlainObject(option)&&option);$this.data(NAMESPACE,(data=new Datepicker(this,options)));}
if(isString(option)&&$.isFunction(fn=data[option])){result=fn.apply(data,args);}});return isUndefined(result)?this:result;};$.fn.datePickerModule.Constructor=Datepicker;$.fn.datePickerModule.languages=Datepicker.LANGUAGES;$.fn.datePickerModule.setDefaults=Datepicker.setDefaults;$.fn.datePickerModule.noConflict=function(){$.fn.datePickerModule=Datepicker.other;return this;};});;Mv.searchFormDatePicker=function(els,selCallback,optsArg){var oneWayCashDates;var roundTripCashDates;var cashDatesType;var currentCashDates={};var rtHashMapDates={};var percentiles={};var currentInput;var datePickerController;var datePickerMouseDown;var disableCashDates;var focusFromBlur;var originalAirportVals;var opts;var mode;var MODES;var today;var isInstantCalendar=false;var isPricedCalendar=false;MODES={ROUND_TRIP:1,ONE_WAY:2,MULTI_CITY:3};if(els===void 0){return{MODES:MODES};}
disableCashDates=false;mode=MODES.ROUND_TRIP;opts={format:"yyyy-mm-dd",cashDatesEnabled:true,startDate:new Date(),template:"<div class=\"ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all ui-datepicker-multi  n-date-picker\">\n\n        <div class=\"ui-datepicker-group ui-datepicker-group-first\" data-view=\"days picker\">\n\n        <div class=\"ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-left\">\n\n                        <a class=\"ui-datepicker-prev ui-corner-all\" title=\"Prev\">\n                <span class=\"ui-icon ui-icon-circle-triangle-w\" data-view=\"month prev\">Previous<\/span>\n                <\/a>\n\n                        <div class=\"ui-datepicker-title\" data-view=\"month current\"><\/div>\n\n            <\/div>\n\n                <table class=\"ui-datepicker-calendar\">\n            <thead><tr data-view=\"week\"><\/tr><\/thead>\n            <tbody data-view=\"days\"><\/tbody>\n        <\/table>\n\n    <\/div>\n\n        <div class=\"ui-datepicker-group ui-datepicker-group-last\" data-view=\"days picker\">\n\n        <div class=\"ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-right\">\n\n                        <a class=\"ui-datepicker-next ui-corner-all\" title=\"Next\">\n                <span class=\"ui-icon ui-icon-circle-triangle-e\" data-view=\"month next\">Next<\/span>\n                <\/a>\n\n                        <div class=\"ui-datepicker-title\" data-view=\"next month\"><\/div>\n\n            <\/div>\n\n                <table class=\"ui-datepicker-calendar\">\n            <thead><tr data-view=\"week\"><\/tr><\/thead>\n            <tbody data-view=\"next days\"><\/tbody>\n        <\/table>\n\n    <\/div>\n\n<\/div>\n"};originalAirportVals={seg0_from:$("[name='seg0_from']").next().val(),seg0_to:$("[name='seg0_to']").next().val()};oneWayCashDates=null;roundTripCashDates=null;$.extend(true,opts,(optsArg||{}));datePickerController=window.datePickerController=$($(document.createElement("div")).attr("id","date-picker-controller")).datePickerModule(opts);$(els).on("focus",handleFocus);$(els).on("blur",handleBlur);$('*').click(function(){});datePickerController.on("date-picker-mousedown",handleDatePickerMouseDown);datePickerController.on("date-picker-selection",handleDatePickerSelection);function handleFocus(e){var inputId;var prevInput=null;var nextInput=null;if(focusFromBlur){focusFromBlur=false;return;}
currentInput=$(this);inputId=parseInt(currentInput.attr("data-id"));switch(mode){case MODES.ONE_WAY:updateModuleStartDate(today);updateModuleNextDate(null);break;case MODES.ROUND_TRIP:if(inputId===2){prevInput=els.filter("[data-id='"+(inputId-1)+"']");}else if(inputId===1){nextInput=els.filter("[data-id='"+(inputId+1)+"']");}
break;case MODES.MULTI_CITY:if(inputId>1){prevInput=inputId===3?els.filter("[data-id='1']"):els.filter("[data-id='"+(inputId-1)+"']");nextInput=els.filter("[data-id='"+(inputId+1)+"']");}else if(inputId===1){nextInput=els.filter("[data-id='"+(inputId+2)+"']");}
break;default:}
if(currentInput[0].id==="esim-return-date"){var startDate=$("#esim-departure-date").val();var endDate=new Date(startDate);var daysLimit=60;endDate.setDate(endDate.getDate()+daysLimit);updateModuleStartDate(startDate);updateModuleEndDate(endDate);}else{if(prevInput&&prevInput.val()){updateModuleStartDate(prevInput.val());updateModulePreviousDate(prevInput.val());}else{updateModuleStartDate(new Date());}
if(nextInput&&nextInput.val()!==''){updateModuleNextDate(nextInput.val());}else{updateModuleNextDate(null);}}
if(currentInput.val()){updateModuleSelectedDate(currentInput.val());}else{resetModuleSelectedDate();if(prevInput&&prevInput.val()){updateModuleViewDate(prevInput.val());}}
populateSavedCashDates();datePickerController.datePickerModule("changeElem",currentInput).datePickerModule("show");}
function handleBlur(e){if(datePickerMouseDown){datePickerMouseDown=false;focusFromBlur=true;setTimeout(function(){$(this).focus();}.bind(this),0);return;}
datePickerController.datePickerModule("hide");}
function handleDatePickerSelection(e,date){var currentId;var currentDate;var nextElem;var nextId;currentInput.val(date).trigger('change');currentId=parseInt(currentInput.attr("data-id"));nextId=(mode===MODES.MULTI_CITY&&currentId===1)?currentId+2:currentId+1;currentDate=new Date(date.replace(/-/g,'\/'));if(mode===MODES.MULTI_CITY){while((nextElem=els.filter("[data-id='"+(nextId++)+"']").filter(":visible")).length){replaceWithMoreRecent(nextElem,currentDate,date);}}else{if((nextElem=els.filter("[data-id='"+nextId+"']").filter(":visible")).length&&nextElem.val()){replaceWithMoreRecent(nextElem,currentDate,date);}}
selCallback(currentInput,date);}
function handleDatePickerMouseDown(e){datePickerMouseDown=true;}
function populateSavedCashDates(callback){var i;var getDeparture,callbackArg=callback||function(){};if(disableCashDates){updateModuleCashDates({});updateModulePercentiles({});return;}
if(isPricedCalendar){currentCashDates=rtHashMapDates;}else if(mode===MODES.ROUND_TRIP&&cashDatesType===MODES.ROUND_TRIP){if(roundTripCashDates===null){return callbackArg.apply(this);}
currentCashDates={};getDeparture=currentInput&&(currentInput.data("id")===1);if(getDeparture){if(isInstantCalendar){updateModuleCashDates(rtHashMapDates);updateModulePercentiles(percentiles);return callbackArg.apply(this);}
var selectedReturn;selectedReturn=els.filter("[data-id='"+2+"']").val();if(!selectedReturn){return callbackArg.apply(this);}
for(i in roundTripCashDates){if(!(selectedReturn in roundTripCashDates[i])){updateModuleCashDates(currentCashDates);return callbackArg.apply(this);}
currentCashDates[i]=roundTripCashDates[i][selectedReturn];}}else{var selectedDeparture;selectedDeparture=els.filter("[data-id='"+1+"']").val();if(isInstantCalendar){updateModuleCashDates(roundTripCashDates.hasOwnProperty(selectedDeparture)?roundTripCashDates[selectedDeparture]:currentCashDates);updateModulePercentiles(percentiles.hasOwnProperty(selectedDeparture)?percentiles[selectedDeparture]:percentiles);return callbackArg.apply(this);}
if(!selectedDeparture||!(selectedDeparture in roundTripCashDates)){updateModuleCashDates(currentCashDates);return callbackArg.apply(this);}
for(i in roundTripCashDates[selectedDeparture]){currentCashDates[i]=roundTripCashDates[selectedDeparture][i];}}}else if(mode===MODES.ONE_WAY&&cashDatesType===MODES.ONE_WAY){if(oneWayCashDates===null){return;}
currentCashDates=oneWayCashDates;}else{currentCashDates={};}
updateModuleCashDates(currentCashDates);return callbackArg.apply(this);}
function trackResponseData(){try{if(!originalAirportVals.seg0_from||!originalAirportVals.seg0_to||typeof window._gaTracker=='undefined'){return;}
_gaTracker('send',{"hitType":"event","eventCategory":"InstantSearchCalendar","eventAction":"Api Response Received","eventLabel":'Itinerary: '+([originalAirportVals.seg0_from,originalAirportVals.seg0_to].join('/')),"origin":originalAirportVals.seg0_from,"destination":originalAirportVals.seg0_to,"hasResults":Object.keys(percentiles).length?'yes':'no'});}catch(e){}}
$(document).on("flex-date-calendar-matrix",function(e,data,type){try{var builtData={};isInstantCalendar=true;cashDatesType=(type=="oneway")?MODES.ONE_WAY:MODES.ROUND_TRIP;mode=cashDatesType;percentiles={};disableCashDates=false;datePickerController.datePickerModule("setIsInstantSearchCalendar",true);Object.keys(data.prices).map(function(key,index){var _element=data.prices[key],buildCurrentPrice=Math.floor(_element.total),replaceElement=_element;builtData[_element.departure_date]=builtData[_element.departure_date]||{};percentiles[_element.departure_date]=percentiles[_element.departure_date]||{};if(cashDatesType==MODES.ROUND_TRIP){replaceElement=(typeof builtData[_element.departure_date][_element.arrival_date]!=='undefined'&&buildCurrentPrice>builtData[_element.departure_date][_element.arrival_date])?null:_element;if(replaceElement){builtData[_element.departure_date][_element.arrival_date]=buildCurrentPrice;percentiles[_element.departure_date][_element.arrival_date]=_element.percentile;}}else{builtData[_element.departure_date]=Math.floor(_element.total);percentiles[_element.departure_date]=_element.percentile;}}.bind(this));if(!$.isEmptyObject(data.matrix)){updateModulePercentilesMatrix(data.matrix);}
if(cashDatesType==MODES.ROUND_TRIP){roundTripCashDates=builtData;Object.keys(builtData).map(function(key,index){rtHashMapDates[key]=Math.min.apply(null,Object.values(builtData[key]))}.bind(this));}else{oneWayCashDates=builtData;}
populateSavedCashDates();$(window).trigger('reload.datepicker');trackResponseData();datePickerController.datePickerModule("doneLoading");}catch(e){}}.bind(this));$(document).on('flex-date-calendar-prices',function(e,data,type){try{disableCashDates=false;isPricedCalendar=true;var tripType=type==="oneway"?'one-way':'round-trip';updateModuleCashDates(data.prices);rtHashMapDates=data.prices;updateModulePercentiles(data.percentiles);percentiles=data.percentiles;updateModulePercentilesMatrix(data.matrix);datePickerController.datePickerModule("setIsPricedCalendar",isPricedCalendar);datePickerController.datePickerModule("setLegendTripType",tripType);datePickerController.datePickerModule("setLegendCurrency",data.currency)
datePickerController.datePickerModule("setIsPricedCalendarV2",data.version&&data.version==2);datePickerController.datePickerModule("setIsPricedCalendarV3",data.version&&data.version==3);$(window).trigger('reload.datepicker');datePickerController.datePickerModule("doneLoading");}catch(e){}}.bind(this));$(document).on("flex-date-search-matrix",function(e,data,type){var i,j;var loopedDeparture,loopedReturn,loopedPrice;switch(type){case "oneway":cashDatesType=MODES.ONE_WAY;oneWayCashDates={};for(i in data){for(j in data[i]){loopedDeparture=data[i][j]["departure_day"];loopedPrice=data[i][j]["price"];if(typeof loopedPrice!=="number"){continue;}
oneWayCashDates[loopedDeparture]=Math.floor(loopedPrice);break;}}
break;case "roundtrip":cashDatesType=MODES.ROUND_TRIP;roundTripCashDates={};for(i in data){for(j in data[i]){loopedDeparture=data[i][j]["departure_day"];loopedReturn=data[i][j]["return_day"];if(!(loopedDeparture in roundTripCashDates)){roundTripCashDates[loopedDeparture]={};}
roundTripCashDates[loopedDeparture][loopedReturn]=Math.floor(data[i][j]["price"]);}}
break;}});$(document).on("search-mode-change",function(e,newMode){mode=newMode;});window.__calendarChangeIntervalRequest=null;$(window).on("airport-selection-changed",function(e,code){if(!isInstantCalendar){return;}
var hasChange=false;for(var name in originalAirportVals){var loopedInput=$("[name='"+name+"']");if(loopedInput.next().val()!==originalAirportVals[name]){originalAirportVals[name]=loopedInput.next().val();hasChange=true;}}
if(!hasChange){return;}
try{updateModuleCashDates({});updateModulePercentiles({});disableCashDates=true;datePickerController.datePickerModule("loading");window.clearInterval(window.__calendarChangeIntervalRequest);window.__calendarChangeIntervalRequest=window.setInterval(function(){if($('#airports-auto-complete-menu').is(':visible')){return;}
window.clearInterval(window.__calendarChangeIntervalRequest);window.displayFlexDateCalendarPricing($.extend(originalAirportVals,((mode===MODES.ROUND_TRIP)?{'seg1_from':originalAirportVals.seg0_to,'seg1_to':originalAirportVals.seg0_from}:{})));}.bind(this),1000);}catch(e){console.log(e);}}.bind(this));$(window).on("force-refresh-datepicker",function(){updateModuleCashDates({});updateModulePercentiles({});disableCashDates=true;isPricedCalendar=false;datePickerController.datePickerModule("setIsPricedCalendar",false);}.bind(this));$(window).on("clear-datepicker",function(){datePickerController.datePickerModule("fillDays");}.bind(this));$(window).on('clear-datepicker-selection',function(){$(els).val(null).trigger('change');resetModuleSelectedDate();updateModulePreviousDate(null);updateModuleNextDate(null);}.bind(this));$(document).on("airport-selection-changed",function(e){if(isPricedCalendar){return;}
for(var name in originalAirportVals){var loopedInput=$("[name='"+name+"']");if(loopedInput.next().val()!==originalAirportVals[name]){disableCashDates=true;return;}}
disableCashDates=false;});function updateModulePercentiles(percentiles){datePickerController.datePickerModule("setPercentiles",percentiles);return this;}
function updateModulePercentilesMatrix(matrix){datePickerController.datePickerModule("setMatrix",matrix);return this;}
function updateModuleCashDates(newCashDates){datePickerController.datePickerModule("setCashDates",newCashDates);return this;}
function updateModuleStartDate(newStartDate){datePickerController.datePickerModule("setStartDate",newStartDate);}
function updateModuleEndDate(newEndDate){datePickerController.datePickerModule("setEndDate",newEndDate);}
function updateModulePreviousDate(previousDate){datePickerController.datePickerModule("setPreviousDate",previousDate);}
function updateModuleNextDate(nextDate){datePickerController.datePickerModule("setNextDate",nextDate);}
function updateModuleSelectedDate(selectedDate){datePickerController.datePickerModule("setDate",selectedDate);}
function resetModuleSelectedDate(){datePickerController.datePickerModule("resetDate");}
function updateModuleViewDate(newViewDate){datePickerController.datePickerModule("setViewDate",newViewDate);}
function replaceWithMoreRecent(el2,el1Date,el1DateString){var el2Date=new Date(el2.val().replace(/-/g,'\/'));if(el2.val()&&el1Date.getTime()>el2Date.getTime()){el2.val(el1DateString).trigger('change');}}};;Mv.airfareAlertSub=function(triggers,gTriggersData,optsArg){var opts;var curMode;var curProcessingId;var curSource;var curTri;var modal;var modalCtl;var KEY_CODES;var MODES;if(triggers===void 0||!(triggers.length)){return;}
opts={endpoints:{packages:"/flight/flight-create-alert/",search:"/flight/create-alert-from-params/",confirm:"/flight/confirm-fare-alert/"},currency:Mv.env.app.currency,template:"<div id=\"fare-alert-modal\" style=\"display: none;\">\n\n        <div class=\"site-overlay\" data-close style=\"display: block;\"><\/div>\n\n        <div class=\"site-modal price-alert-modal\" style=\"display: block;\">\n\n                <div class=\"close-modal-btn\" data-close><\/div>\n\n        <div class=\"modal-inner\">\n\n            <div class=\"loading-logo-heading\">\n                <div class=\"site-logo white\"><\/div>\n            <\/div>\n\n                        <div class=\"loading-modal-search-information\">\n                <div class=\"modal-city-pair\">\n                    <div class=\"display-table\">\n                        <div class=\"column from\">\n                            <div class=\"city\">\n                                <i class=\"fa fa-map-marker\"><\/i>\n                                <div id=\"fare-alert-from\" class=\"city-label\"><\/div>\n                            <\/div>\n                        <\/div>\n                        <div class=\"column icon\"><i class=\"fa fa-arrow-right\"><\/i><\/div>\n                        <div class=\"column to\">\n                            <div class=\"city\">\n                                <i class=\"fa fa-map-marker\"><\/i>\n                                <div id=\"fare-alert-to\" class=\"city-label\"><\/div>\n                            <\/div>\n                        <\/div>\n                    <\/div>\n\n                    <div class=\"date-wrap\">\n                        <div class=\"date\">\n                            <span class=\"jf-icon jf-calendar\"><\/span>\n                            <span id=\"fare-alert-date\"><\/span>\n                        <\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n\n            <div class=\"site-modal-loading-title\">\n                <div class=\"title\">Cheap airfare alerts!<\/div>\n                <div class=\"subtitle\">Be the first to know when fares for this flight drop<\/div>\n            <\/div>\n\n            <div class=\"form-wrap subscribe-form\">\n\n                                <div id=\"fare-alert-loader\" class=\"subscribe-loader\">\n                    <div class=\"spinner\"><\/div>\n                <\/div>\n\n                                <ul id=\"fare-alert-inputs\" class=\"input-list\" data-flight-fare-alert-inputs-wrapper=\"\">\n                    <li class=\"input-item error-wrap\">\n                        <input id=\"fare-alert-input\" type=\"email\" name=\"newsletter-email\" placeholder=\"Enter your email\" data-flight-fare-alert-email=\"\" value=\"\" attr-c-email-prefill>\n                        <div id=\"fare-alert-error-tooltip\" class=\"newsletter-error\" style=\"display:none\">Please provide a valid email<\/div>\n                    <\/li>\n                    <li class=\"input-item\">\n                        <a id=\"fare-alert-submit-button\" class=\"submit-button\" data-flight-fare-alert-submit=\"\">Get me Deals<\/a>\n                    <\/li>\n                <\/ul>\n\n                                <div id=\"fare-alert-success\" class=\"modal-success modal-success-msg\" style=\"display:none;\">\n                    <div class=\"msg\">Your alert was successfully created<\/div>\n                <\/div>\n\n                                <div class=\"modal-error-msg\" style=\"display: none;\">\n                    <div id=\"fare-alert-error-msg\" class=\"msg\"><\/div>\n                <\/div>\n\n            <\/div>\n\n            <div class=\"site-modal-footer\">\n                <ul>\n                    <li><a href=\"\/privacy-policy\" target=\"_blank\">Privacy policy<\/a><\/li>\n                    <li><a class=\"modal-continue-btn\" data-close>Continue<\/a><\/li>\n                <\/ul>\n            <\/div>\n        <\/div>\n    <\/div>\n\n<\/div>\n",modalCloseTime:2500,successFadeTime:500,triggerState:{error:{classes:"pa-error",innerClasses:"",icon:'<i class="fa fa-times"></i>'},processing:{classes:"pa-processing",innerClasses:"",text:"Setting price alert...",icon:'<div class="bars-loader"><div class="loading-bar"></div><div class="loading-bar"></div><div class="loading-bar"></div></div>'},success:{classes:"pa-success",innerClasses:"",text:"A price alert has been set for this flight",icon:'<i class="jf-icon jf-notification-active"></i>',checkmark:'<i class="fa fa-check"></i>'},vanilla:{icon:'<i class="jf-icon jf-notification"></i>'}},modalWrapperQuery:".price-alert-wrap",outerWrapperQuery:".package-set-price-alert",wrapperQuery:".pa-trigger-wrap",triggerQuery:".pa-trigger",inputErrTimeout:2000,errorCallback:null,successCallback:null,loadingCallback:null};$.extend(true,opts,(optsArg||{}));KEY_CODES={ENTER:13};MODES={SEARCH:1,PACKAGE:2};function successCallback(activeTrigger,opts){activeTrigger.parents(opts.outerWrapperQuery).addClass(opts.triggerState.success.classes).removeClass(opts.triggerState.processing.classes);activeTrigger.html($(document.createElement("span")).html(opts.triggerState.success.icon+opts.triggerState.success.text).addClass(opts.triggerState.success.innerClasses).removeClass(opts.triggerState.processing.innerClasses)).removeClass(opts.triggerState.processing.classes);}
function errorCallback(activeTrigger,opts,data){activeTrigger.removeClass(opts.triggerState.processing.classes).addClass(opts.triggerState.error.classes).removeClass(opts.triggerState.processing.innerClasses).addClass(opts.triggerState.error.innerClasses).html(data.error_message);}
function loadingCallback(activeTrigger,opts){activeTrigger.parents(opts.outerWrapperQuery).addClass(opts.triggerState.processing.classes).removeClass(opts.triggerState.error.classes);activeTrigger.removeAttr("href").addClass(opts.triggerState.processing.innerClasses).removeClass(opts.triggerState.error.innerClasses).html(opts.triggerState.processing.icon+opts.triggerState.processing.text)}
successCallback=opts.successCallback||successCallback;errorCallback=opts.errorCallback||errorCallback;loadingCallback=opts.loadingCallback||loadingCallback;(function initModal(){var modalId=$(opts.template).attr("id");$("body").append(opts.template);modal=$('#'+modalId);modal.find("[data-close='']").on("click",closeModal);modalCtl={from:modal.find("#fare-alert-from"),to:modal.find("#fare-alert-to"),date:modal.find("#fare-alert-date"),input:modal.find("#fare-alert-input"),errorTooltip:modal.find("#fare-alert-error-tooltip"),successMsg:modal.find("#fare-alert-success"),errorMsg:modal.find("#fare-alert-error-msg"),submitBtn:modal.find("#fare-alert-submit-button"),loader:modal.find("#fare-alert-loader"),inputsList:modal.find("#fare-alert-inputs"),timeoutId:null};modalCtl.submitBtn.on("click",submitEmail);modalCtl.input.on("keydown",function(e){modalCtl.errorTooltip.hide();if(e.keyCode===KEY_CODES.ENTER){submitEmail();}});modalCtl.input.on("blur",function(e){modalCtl.errorTooltip.hide();});})();triggers.on("click",handleTriggerClick);$("body").on({"faresReloaded":rebind,"filter-action-success":rebind,"fareLoaderShowPackages":rebind,"packagesRefreshed":rebind});function handleTriggerClick(e){var processingId,mode,source,from,to,travelDate;e.preventDefault();curTri=$(this).closest(opts.wrapperQuery);if(curTri.attr("data-processing")){return;}
curProcessingId=processingId=$(this).attr("data-package-id");if(processingId){curMode=mode=MODES.PACKAGE;}else{curProcessingId=processingId=$(this).attr("data-search-id")||gTriggersData.searchId;curMode=mode=MODES.SEARCH;}
curSource=source=$(this).attr("data-source")||gTriggersData.source;from=$(this).attr("data-from")||gTriggersData.from;to=$(this).attr("data-to")||gTriggersData.to;travelDate=$(this).attr("data-date")||gTriggersData.date;if("priceAlertEmail"in Mv.env.user&&Mv.env.user.priceAlertEmail){sendReq(Mv.env.user.priceAlertEmail,processingId,source,mode);return;}
openModal(from,to,travelDate);}
function openModal(from,to,travelDate){modal.find('.site-overlay').show();modal.find('.site-modal').show();modal.show();modalCtl.from.text(from);modalCtl.to.text(to);modalCtl.date.text(travelDate);if(Mv.env.user.preFilledPriceAlertEmail){modalCtl.input.val(Mv.env.user.preFilledPriceAlertEmail);}
if(Mv.env.user.prefillEmail){modalCtl.input.val(Mv.env.user.prefillEmail);}
modalCtl.input.focus();}
function closeModal(){modal.hide();modalCtl.errorTooltip.hide();modalCtl.loader.hide();modalCtl.successMsg.hide();modalCtl.input.val("");}
function submitEmail(){var email;email=modalCtl.input.val();if(!validateFareAlertEmail(email)){modalCtl.input.focus();window.clearTimeout(modalCtl.timeoutId);modalCtl.errorTooltip.show();modalCtl.timeoutId=window.setTimeout(function(){modalCtl.errorTooltip.hide();},opts.inputErrTimeout);return;}
modalCtl.loader.show();sendReq(email,curProcessingId,curSource,curMode);}
function sendReq(email,processId,source,mode){var activeTrigger=curTri;var curEndpoint;var sentObj={source:source,currency:opts.currency,email:email};if(activeTrigger.parents(opts.modalWrapperQuery).attr("data-query-json")){sentObj.params=JSON.parse(activeTrigger.parents(opts.modalWrapperQuery).attr("data-query-json"));}
if(mode===MODES.PACKAGE){curEndpoint=opts.endpoints.packages+gTriggersData.searchId+'/'+processId+'/'+email;}else if(mode===MODES.SEARCH){curEndpoint=opts.endpoints.search;}
modalCtl.errorMsg.empty().parent().hide();activeTrigger.parents(opts.modalWrapperQuery).attr("data-processing",1);if(!isModalActive()){loadingCallback(activeTrigger,opts);}
$.ajax({"url":curEndpoint,"dataType":"json","data":sentObj,"success":function(data){modalCtl.loader.hide();if(data.success){modalCtl.inputsList.hide();modalCtl.successMsg.fadeIn(opts.successFadeTime);setTimeout(function(){closeModal();},opts.modalCloseTime);_gaq.push(["_trackEvent",'Interaction','Fare Alerts: Standard','Subscribed',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Interaction","eventAction":"Fare Alerts: Standard","eventLabel":"Subscribed","nonInteraction":1});if(data.fare_alert_hash){var confObj;if(curMode===MODES.PACKAGE){confObj={search_id:gTriggersData.searchId,fare_alert_hash:data.fare_alert_hash,fare_alert_is_new:data.fareAlertIsNew,fare_alert_flight_package_hash:data.flight_package_fare_alert_hash}}else{confObj={search_id:processId,fare_alert_hash:data.fare_alert_hash,fare_alert_is_new:true}}
$.getJSON(opts.endpoints.confirm,confObj);}
activeTrigger.parents(opts.modalWrapperQuery).removeAttr("data-processing");successCallback(activeTrigger,opts,data);Mv.env.user.priceAlertEmail=email;}else{activeTrigger.parents(opts.modalWrapperQuery).removeAttr("data-processing");if(isModalActive()){modalCtl.errorMsg.html(data.error_message).parent().show();}else{errorCallback(activeTrigger,opts,data);}
_gaq.push(["_trackEvent",'Errors: Site','Already Subscribed','Fare Alert: Search Results',,1]);_gaTracker('send',{"hitType":"event","eventCategory":"Errors: Site","eventAction":"Already Subscribed","eventLabel":"Fare Alert: Search Results","nonInteraction":1});}}});}
function rebind(){triggers=$(opts.triggerQuery);triggers.on("click",handleTriggerClick);}
function validateFareAlertEmail(email){var emailValidation=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return emailValidation.test(email);}
function isModalActive(){return!("priceAlertEmail"in Mv.env.user&&Mv.env.user.priceAlertEmail);}};;Mv.googleApiHelper=function(optsArg){var opts={externalScriptSrc:"https://apis.google.com/js/api.js",apiInitConfig:{apiKey:"AIzaSyDaGvfZ_U38fwYgB3mV5cNRrjgSGhM1MSw",clientId:"91637476207-jm4o488rsb0l2mpd1tg6i8j4e38i596a.apps.googleusercontent.com",discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"email profile"},events:{apiError:"google-api-error",apiLoaded:"google-api-loaded",apiReady:"google-api-ready"}};opts=$.extend(true,opts,optsArg);function handleClientLoad(){gapi.load("client:auth2",{callback:function success(){$(document).trigger(opts.events.apiLoaded);initClient();},onerror:function failure(){$(document).trigger(opts.events.apiError);}});function initClient(){gapi.client.init(opts.apiInitConfig).then(function success(){$(document).trigger(opts.events.apiReady);},function failure(){$(document).trigger(opts.events.apiError);});}}
function on(event,cb){$(document).on(event,cb);return publicApi;}
function onReady(cb){return on(opts.events.apiReady,cb);}
function onLoad(cb){return on(opts.events.apiLoaded,cb);}
function onError(cb){return on(opts.events.apiError,cb);}
function isGoogleApiLoaded(){return typeof gapi==="object";}
function isGoogleApiInitialized(){return "auth2"in gapi;}
function loadGoogleApiScript(){if(isGoogleApiLoaded()){$(document).trigger(opts.events.apiLoaded);if(!isGoogleApiInitialized()){handleClientLoad();}
$(document).trigger(opts.events.apiReady);return;}
var script=document.createElement("script");script.type="text/javascript";script.async=true;script.onload=function(){handleClientLoad();};script.src=opts.externalScriptSrc;document.getElementsByTagName("head")[0].appendChild(script);return publicApi;}
var publicApi={load:loadGoogleApiScript,onReady:onReady,onLoad:onLoad,onError:onError};return publicApi;};;Mv.facebookApiHelper=function(optsArg){var opts={ieScriptSrc:"https://www.justfly.com/js/promise.js",apiInitConfig:{appId:"112196812761905",cookie:true,xfbml:true,version:"v2.8"},events:{apiReady:"facebook-api-ready"}};opts=$.extend(true,opts,optsArg);function loadFacebookApiScript(){function loadFbScript(){window.fbAsyncInit=function(){FB.init(opts.apiInitConfig);$(document).trigger(opts.events.apiReady);};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10";fjs.parentNode.insertBefore(js,fjs);}(document,"script","facebook-jssdk"));}
if(Mv.env.user.isIE){(function loadIePromisesScript(){var script=document.createElement("script");script.type="text/javascript";script.async=true;script.onload=function(){loadFbScript();};script.src=opts.ieScriptSrc;document.getElementsByTagName("head")[0].appendChild(script);})();}else{loadFbScript();}
return publicApi;}
function on(event,cb){$(document).on(event,cb);return publicApi;}
function onReady(cb){return on(opts.events.apiReady,cb);}
var publicApi={load:loadFacebookApiScript,onReady:onReady,};return publicApi;};;/*!
* The Final Countdown for jQuery v2.2.0 (http://hilios.github.io/jQuery.countdown/)
* Copyright (c) 2016 Edson Hilios
*
* Permission is hereby granted, free of charge, to any person obtaining a copy of
* this software and associated documentation files (the "Software"), to deal in
* the Software without restriction, including without limitation the rights to
* use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
* the Software, and to permit persons to whom the Software is furnished to do so,
* subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(a){if(a instanceof Date)return a;if(String(a).match(g))return String(a).match(/^[0-9]*$/)&&(a=Number(a)),String(a).match(/\-/)&&(a=String(a).replace(/\-/g,"/")),new Date(a);throw new Error("Couldn't cast `"+a+"` to a date object.")}function c(a){var b=a.toString().replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return new RegExp(b)}function d(a){return function(b){var d=b.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);if(d)for(var f=0,g=d.length;f<g;++f){var h=d[f].match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/),j=c(h[0]),k=h[1]||"",l=h[3]||"",m=null;h=h[2],i.hasOwnProperty(h)&&(m=i[h],m=Number(a[m])),null!==m&&("!"===k&&(m=e(l,m)),""===k&&m<10&&(m="0"+m.toString()),b=b.replace(j,m.toString()))}return b=b.replace(/%%/,"%")}}function e(a,b){var c="s",d="";return a&&(a=a.replace(/(:|;|\s)/gi,"").split(/\,/),1===a.length?c=a[0]:(d=a[0],c=a[1])),Math.abs(b)>1?c:d}var f=[],g=[],h={precision:100,elapse:!1,defer:!1};g.push(/^[0-9]*$/.source),g.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),g.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),g=new RegExp(g.join("|"));var i={Y:"years",m:"months",n:"daysToMonth",d:"daysToWeek",w:"weeks",W:"weeksToMonth",H:"hours",M:"minutes",S:"seconds",D:"totalDays",I:"totalHours",N:"totalMinutes",T:"totalSeconds"},j=function(b,c,d){this.el=b,this.$el=a(b),this.interval=null,this.offset={},this.options=a.extend({},h),this.instanceNumber=f.length,f.push(this),this.$el.data("countdown-instance",this.instanceNumber),d&&("function"==typeof d?(this.$el.on("update.countdown",d),this.$el.on("stoped.countdown",d),this.$el.on("finish.countdown",d)):this.options=a.extend({},h,d)),this.setFinalDate(c),this.options.defer===!1&&this.start()};a.extend(j.prototype,{start:function(){null!==this.interval&&clearInterval(this.interval);var a=this;this.update(),this.interval=setInterval(function(){a.update.call(a)},this.options.precision)},stop:function(){clearInterval(this.interval),this.interval=null,this.dispatchEvent("stoped")},toggle:function(){this.interval?this.stop():this.start()},pause:function(){this.stop()},resume:function(){this.start()},remove:function(){this.stop.call(this),f[this.instanceNumber]=null,delete this.$el.data().countdownInstance},setFinalDate:function(a){this.finalDate=b(a)},update:function(){if(0===this.$el.closest("html").length)return void this.remove();var b,c=void 0!==a._data(this.el,"events"),d=new Date;b=this.finalDate.getTime()-d.getTime(),b=Math.ceil(b/1e3),b=!this.options.elapse&&b<0?0:Math.abs(b),this.totalSecsLeft!==b&&c&&(this.totalSecsLeft=b,this.elapsed=d>=this.finalDate,this.offset={seconds:this.totalSecsLeft%60,minutes:Math.floor(this.totalSecsLeft/60)%60,hours:Math.floor(this.totalSecsLeft/60/60)%24,days:Math.floor(this.totalSecsLeft/60/60/24)%7,daysToWeek:Math.floor(this.totalSecsLeft/60/60/24)%7,daysToMonth:Math.floor(this.totalSecsLeft/60/60/24%30.4368),weeks:Math.floor(this.totalSecsLeft/60/60/24/7),weeksToMonth:Math.floor(this.totalSecsLeft/60/60/24/7)%4,months:Math.floor(this.totalSecsLeft/60/60/24/30.4368),years:Math.abs(this.finalDate.getFullYear()-d.getFullYear()),totalDays:Math.floor(this.totalSecsLeft/60/60/24),totalHours:Math.floor(this.totalSecsLeft/60/60),totalMinutes:Math.floor(this.totalSecsLeft/60),totalSeconds:this.totalSecsLeft},this.options.elapse||0!==this.totalSecsLeft?this.dispatchEvent("update"):(this.stop(),this.dispatchEvent("finish")))},dispatchEvent:function(b){var c=a.Event(b+".countdown");c.finalDate=this.finalDate,c.elapsed=this.elapsed,c.offset=a.extend({},this.offset),c.strftime=d(this.offset),this.$el.trigger(c)}}),a.fn.countdown=function(){var b=Array.prototype.slice.call(arguments,0);return this.each(function(){var c=a(this).data("countdown-instance");if(void 0!==c){var d=f[c],e=b[0];j.prototype.hasOwnProperty(e)?d[e].apply(d,b.slice(1)):null===String(e).match(/^[$A-Z_][0-9A-Z_$]*$/i)?(d.setFinalDate.call(d,e),d.start()):a.error("Method %s does not exist on jQuery.countdown".replace(/\%s/gi,e))}else new j(this,b[0],b[1])})}});;$(document).ready(function(){var baggageInfoModalOpenContent=function(content){Modal.open({html:content,width:630,height:410,unclosable:false,additionalClasses:'baggage-information-modal-box'});};$('[data-baggage-info-trigger]').on('click',function(event){event.preventDefault();var content=$(this).siblings('[data-baggage-info-content]');Modal.open({html:content.html(),width:630,height:410,unclosable:false,additionalClasses:'baggage-information-modal-box'});if(content.find('[data-avl-container]').length&&Mv.AsyncViewLoader){setTimeout(function(){Mv.AsyncViewLoader.loadView($('#modal_box').find('[data-avl-container]'));},0);}
return;if($(this).attr('data-baggage-info-trigger')){$.ajax({url:$(this).attr('data-baggage-info-trigger'),dataType:'json',success:function(data){if(data.html){baggageInfoModalOpenContent(data.html);}},});}else{baggageInfoModalOpenContent($(this).siblings('[data-baggage-info-content]').html());}});});;(function($,window,document){'use strict';var Baggage=function(base_url,search_id,hash_key){this.base_url=base_url;this.search_id=search_id;this.hash_key=hash_key;this.current_segment=null;};Baggage.prototype={init:function(){this.setUIElements();this.setCurrentSegment(this.baggage_segment.first());this.displayCurrentSegment();this.setUIElementsHandler();},setUIElements:function(){this.baggage_container=$('.baggage-container');this.baggage_segment_container=$('.segment-baggages');this.baggage_segment=$('.baggage-segment');this.current_segment=this.getActiveSegment();this.baggage_selection_wrapper=$('.baggage-selection-wrapper');this.baggage_selection_input=$('.baggage-selection-input');this.confirm_selection_button=$('.confirm-baggage-selection');this.baggage_confirmed=$('.baggage-confirmed');this.review_selections=$('.review-baggage-selection');this.clear_all_selection=$('.clear-bags-button');this.clear_baggage_selections_class='clear-baggage-selections';this.passenger_baggage_selection=$('.passenger-baggage-selection');this.baggage_item=$('.baggage-item');this.baggage_quick_selection_input=$('.baggage-quick-selection-input');this.baggages_fee_container=$('#baggages-fee');this.baggages_fee=$('.baggage-fees');this.segment_dropdown=$('.segment-dropdown');this.baggage_segment_list=$('.baggage-segments-list');this.baggage_dropdown_content=$('#baggage-dropdown-content');this.passenger_baggage_selection.not('[data-segment=0]').filter('[data-passenger=1]').css({borderTop:'0 none'});},getActiveSegment:function(){return this.baggage_segment.filter('.active');},setCurrentSegment:function(segment){this.current_segment=segment;},displayCurrentSegment:function(){var segment_key=this.current_segment.data('segment');this.baggage_segment.removeClass('active');this.current_segment.addClass('active');this.baggage_segment_container.hide();this.baggage_segment_container.filter('[data-segment='+segment_key+']').fadeIn(400);this.toggleShowQuickSelection(segment_key);this.updateBaggageOptions();},toggleShowQuickSelection:function(current_segment){if(current_segment==0){var quick_selection_title=this.baggage_segment.filter('.quick-selection').html();this.baggage_dropdown_content.html(quick_selection_title);this.baggage_item.filter('.quick-selection').show();this.passenger_baggage_selection.filter('[data-passenger]').hide();}else{this.baggage_item.filter('.quick-selection').hide();}
this.passenger_baggage_selection.filter('[data-segment='+current_segment+']').show();},enableConfirmButton:function(){var checked_baggage_selection_input=this.baggage_selection_input.filter(':checked:not(:disabled)'),checked_baggage_selection_input_length=checked_baggage_selection_input.length;if(checked_baggage_selection_input_length>0){this.confirm_selection_button.removeClass('disabled');}else{this.confirm_selection_button.addClass('disabled');}},toggleFeedbackMessage:function(state){if(!state){return false;}
if(state=='show'){this.baggage_container.find('.success-wrap').slideUp(400);this.baggage_container.find('.summary-thank-you').slideDown(400);this.review_selections.fadeIn(200);}else if(state=='hide'){this.review_selections.fadeOut(200);this.baggage_container.find('.success-wrap').slideDown(400);this.baggage_container.find('.summary-thank-you').fadeOut(400);}},getBaggageSelectionsData:function(){var data=[],active_baggage_selection_input=this.baggage_selection_input.filter(':not(:disabled)');active_baggage_selection_input.each(function(){data.push({'name':this.name,'value':$(this).is(':checked')?this.value:''});});data.push({'name':'search_id','value':this.search_id},{'name':'hash_key','value':this.hash_key});return data;},getBaggageSelectionDataAsArray:function(){var data=[],baggage_selections_data=this.getBaggageSelectionsData(),i,baggage_selections_data_length=baggage_selections_data.length;for(i=0;i<baggage_selections_data_length;i++){data[baggage_selections_data[i]['name']]=baggage_selections_data[i]['value'];}
return data;},updatePricing:function(){var self=this,data=self.getBaggageSelectionsData(),breakdown_spinner=self.baggages_fee.find('.price-spinner-wrap'),breakdown_spinner_length=breakdown_spinner.length;if(breakdown_spinner_length){breakdown_spinner.show();}
$.post(self.base_url+'baggage/update-price',data,function(result){self.baggages_fee_container.html(result.html);if(breakdown_spinner_length){breakdown_spinner.hide();}});},updateBreakdownPrice:function(extra_params){if(!window.updatePriceBreakdown){return;}
window.updatePriceBreakdown(extra_params,'flight',this.search_id,this.hash_key);},updateBaggageOptions:function(){$('.baggage-quick-selection-input, .baggage-selection-input').each(function(){if($(this).is(':checked')){$(this).parents('.baggage-item').next().show().find('input').removeProp('disabled');}else{$(this).parents('.baggage-item').next().hide().find('input').prop('disabled','disabled').removeProp('checked');}});$('.baggage-item.not-chargeable').find('input').prop('checked','checked').prop('disabled','disabled');$('.baggage-item.not-chargeable').next().show().find('input').removeProp('disabled');},setUIElementsHandler:function(){var baggage=this;this.baggage_segment.on('click',function(e){e.preventDefault();var self=$(this),current_segment=self.data('segment'),segment_baggages=baggage.baggage_segment_container,title=self.html();if(self.hasClass('active')){return;}else{baggage.baggage_segment.removeClass('active');self.addClass('active');}
segment_baggages.hide();baggage.toggleShowQuickSelection(current_segment);baggage.updateBaggageOptions();segment_baggages.filter('[data-segment='+current_segment+']').fadeIn(400);baggage.passenger_baggage_selection.hide();baggage.passenger_baggage_selection.filter('[data-segment='+current_segment+']').show();baggage.baggage_dropdown_content.html(title);baggage.baggage_segment_list.hide();});this.baggage_selection_input.on('change',function(){var ssr_code=$(this).parents('.baggage-item').data('baggage-ssr-code'),passenger=$(this).parents('.baggage-item').data('passenger');if(!$(this).is(':checked')&&ssr_code!=undefined){baggage.baggage_quick_selection_input.filter('[value="'+ssr_code+'"]').filter('[data-passenger="'+passenger+'"]').removeProp('checked');}
baggage.updateBaggageOptions();baggage.updatePricing();});this.review_selections.on('click',function(e){e.preventDefault();baggage.toggleFeedbackMessage('hide');});this.clear_all_selection.on('click',function(e){e.preventDefault();baggage.baggage_selection_wrapper.find('.baggage-selection-input:enabled').removeAttr('checked');baggage.baggage_quick_selection_input.removeProp('checked');window.setTimeout(function(){baggage.updateBaggageOptions();},1);baggage.updatePricing();var baggage_params={'baggage':null,'baggage_confirmed':0};$('[name=baggage_confirmed]').val(0);baggage.updateBreakdownPrice(baggage_params);});this.confirm_selection_button.on('click',function(e){e.preventDefault();var self=$(this),baggage_params;if(self.hasClass('disabled')){return false;}
baggage.updatePricing();baggage.toggleFeedbackMessage('show');baggage_params=baggage.getBaggageSelectionDataAsArray();baggage_params['baggage_confirmed']=1;$('[name=baggage_confirmed]').val(1);if($.isEmptyObject(baggage_params)){baggage_params={'baggage':null,'baggage_confirmed':0};$('[name=baggage_confirmed]').val(0);}
baggage.updateBreakdownPrice(baggage_params);});this.segment_dropdown.on('click',function(){$(this).closest('.baggage-segments').find('.baggage-segments-list').show();});$('body').on('click','.'+baggage.clear_baggage_selections_class,function(e){e.preventDefault();baggage.current_segment=baggage.baggage_segment.first();baggage.displayCurrentSegment();baggage.review_selections.trigger('click');baggage.clear_all_selection.trigger('click');});$(document).on('mouseup touchstart',function(e){var container=baggage.baggage_segment_list,target=e.target;if(!container.is(target)&&container.has(target).length===0){baggage.baggage_segment_list.stop(false,false).hide();}});this.baggage_quick_selection_input.on('click',function(){var is_checked=$(this).is(':checked');$('.baggage-item').filter('[data-baggage-ssr-code="'+this.value+'"]').filter('[data-passenger="'+$(this).data('passenger')+'"]').find('.baggage-selection-input').each(function(){if(is_checked){$(this).prop('checked','checked');}else{$(this).removeProp('checked');}});baggage.updateBaggageOptions();baggage.updatePricing();});}};window.Baggage=Baggage;})(jQuery,window,document);var CheckoutData=function(){var searchId=null;var orderId=null;var total=null;var currency=null;var savings=null;var totalListeners=[];var flightInfo={};this.setSearchId=function(newSearchId){searchId=newSearchId;};this.getSearchId=function(){return searchId;};this.setOrderId=function(newOrderId){orderId=newOrderId;};this.getOrderId=function(){return orderId;};this.setCurrency=function(newCurrency){currency=newCurrency;};this.getCurrency=function(){return currency;};this.setFlightInfo=function(updateFlightInfo){for(var i in updateFlightInfo){flightInfo[i]=updateFlightInfo[i];}};this.getFlightInfo=function(){return flightInfo;};this.updateTotal=function(newTotal,newSavingsTotal){if(newTotal){total=parseFloat(newTotal.toFixed(2));}
if(newSavingsTotal){savings=parseFloat(newSavingsTotal.toFixed(2));}
this.triggerTotalListener();};this.getTotal=function(){return total;};this.getTotalInCents=function(){return(this.getTotal()*100).toFixed(0);};this.getSavings=function(){return savings;};this.getSavingsInCents=function(){return(this.getSavings()*100).toFixed(0);};this.registerTotalListener=function(newListener){newListener(this);totalListeners.push(newListener);};this.triggerTotalListener=function(){for(var i in totalListeners){totalListeners[i](this);}};};Mv.CheckoutData=new CheckoutData();var TrackSearchLaunch=function(){this.track=function(data){gtag("event","search_launch",data);}}
Mv.TrackSearchLaunch=new TrackSearchLaunch();var AlternatePaymentMethodsManager=function(){var registeredChoices={};var bookButtonElement=null;var originalBookButtonSetText=null;var choiceCheckboxClickedCallback=function(event){var clickedCheckbox=this;for(var i in registeredChoices){var registeredChoice=registeredChoices[i];if($(registeredChoice.choiceElement).is(clickedCheckbox)){registeredChoice.isSelected=true;}else{registeredChoice.isSelected=false;}}
updateChoiceUI();};var updateChoiceUI=function(){var chosenChoice=null;for(var i in registeredChoices){var registeredChoice=registeredChoices[i];if(registeredChoice.isSelected){chosenChoice=registeredChoice;}else{registeredChoice.deselectChoice();}}
if(chosenChoice){chosenChoice.selectChoice();}};this.registerPaymentMethod=function(paymentMethodName,paymentMethodInstance){if(!paymentMethodName||!paymentMethodInstance.valid||!paymentMethodInstance.choiceElement||!paymentMethodInstance.selectChoice||!paymentMethodInstance.deselectChoice){console.error("Invalid PaymentMethod registration - Missing options",[this,paymentMethodName,paymentMethodInstance]);return;}
if(!paymentMethodInstance.processPayment){paymentMethodInstance.processPayment=function(submitData,endProcessCallback){endProcessCallback({status:true,submitData:submitData})};}
paymentMethodInstance.name=paymentMethodName;paymentMethodInstance.isSelected=false;registeredChoices[paymentMethodName]=paymentMethodInstance;$(paymentMethodInstance.choiceElement).on("click",choiceCheckboxClickedCallback);updateChoiceUI();};this.registerChoice=function(choiceName,choiceProperties){if(!choiceName||!choiceProperties['choiceElement']||!choiceProperties['selectChoice']||!choiceProperties['deselectChoice']){return;}
if(!choiceProperties['processPayment']){choiceProperties['processPayment']=function(submitData,endProcessCallback){endProcessCallback({status:true,submitData:submitData})};}
choiceProperties['name']=choiceName;choiceProperties['isSelected']=false;registeredChoices[choiceName]=choiceProperties;$(choiceProperties['choiceElement']).on("click",choiceCheckboxClickedCallback);updateChoiceUI();return registeredChoices[choiceName];};this.hasRegisteredChoices=function(){return Object.keys(registeredChoices).length>0;};this.selectChoice=function(choiceName){$(registeredChoices[choiceName].choiceElement).click();};this.getChoice=function(choiceName){return registeredChoices[choiceName];};this.getSelectedChoice=function(){for(var name in registeredChoices){if(registeredChoices[name].isSelected){return registeredChoices[name];}}
return null;};this.isChoiceSelected=function(choiceName){for(var name in registeredChoices){if(registeredChoices[name].isSelected){return choiceName==name;}}
return false;};this.processSelectedChoice=function(submitData,endProcessCallback){var selectedChoice=this.getSelectedChoice();if(!selectedChoice){endProcessCallback({status:true,submitData:submitData});}
selectedChoice.processPayment(submitData,endProcessCallback);};this.setBookButton=function(bookButtonElementArg){bookButtonElement=bookButtonElementArg;originalBookButtonSetText=$(bookButtonElement).html();};this.changeBookButtonText=function(newText){$(bookButtonElement).html(newText.toUpperCase())};this.resetBookButtonText=function(){$(bookButtonElement).html(originalBookButtonSetText.toUpperCase())};this.trackEventTypes={ELIGIBLE:'Eligible',DISPLAYED:'Displayed',BUTTON_CLICKED:'Button Clicked',PAY_ATTEMPT:'Payment Attempt',PAY_SUCCESS:'Payment Success',PAY_FAILURE:'Payment Failure',};this.trackEvent=function(paymentType,actionType){_gaTracker('send',{"hitType":"event","eventCategory":"Payment Options","eventAction":paymentType,"eventLabel":actionType,"nonInteraction":true});};};Mv.AlternatePaymentMethods={Manager:new AlternatePaymentMethodsManager(),};(function($,window,document){$(document).ready(function(){Mv.AlternatePaymentMethods.Manager.setBookButton($("#submit_booking")[0])});})(jQuery,window,document);Mv.AlternatePaymentMethods.RegularPaymentMethod=function(options){Object.assign(this,options);this.valid=false;if(!this.choiceElement||!this.selectChoice||!this.deselectChoice){console.error("Invalid PaymentMethod initialisation - Missing options",this);return;}
this.valid=true;};Mv.AlternatePaymentMethods.AffirmPaymentMethod=function(options){Object.assign(this,options);this.valid=false;if(!this.choiceElement||!this.selectChoice||!this.deselectChoice||!this.affirmAsLowAsElement||!this.merchantName||typeof affirm=='undefined'||typeof affirm.checkout=='undefined'){console.error("Invalid PaymentMethod initialisation - Missing options",this);return;}
Mv.AlternatePaymentMethods.Manager.trackEvent('Affirm',Mv.AlternatePaymentMethods.Manager.trackEventTypes.DISPLAYED);Mv.CheckoutData.registerTotalListener(function(checkoutData){if(this.affirmAsLowAsElement.attr!==undefined){this.affirmAsLowAsElement.attr('data-amount',checkoutData.getTotalInCents());}else{this.affirmAsLowAsElement.setAttribute('data-amount',checkoutData.getTotalInCents());}
affirm&&affirm.ui&&affirm.ui.refresh&&affirm.ui.refresh();}.bind(this));this.processPayment=function(submitData,endProcessCallback){Mv.AlternatePaymentMethods.Manager.trackEvent('Affirm',Mv.AlternatePaymentMethods.Manager.trackEventTypes.PAY_ATTEMPT);var checkoutTotalInCents=Mv.CheckoutData.getTotalInCents();var savingsTotalInCents=Mv.CheckoutData.getSavingsInCents();var discounts={};if(savingsTotalInCents>0){discounts={"SPECIAL":{"discount_amount":savingsTotalInCents,"discount_display_name":"Special"}}}
var checkoutFlightInfo=Mv.CheckoutData.getFlightInfo();var billingInfo={"name":{"full":submitData.p1_first_name+" "+submitData.p1_last_name},"address":{"line1":submitData.cc_billing_address_line1,"line2":submitData.cc_billing_address_line2,"city":submitData.cc_city,"region1_code":submitData.cc_region_code,"postal_code":submitData.cc_zip,"country":submitData.cc_country_code}};var checkoutData={"merchant":{"name":this.merchantName},"billing":billingInfo,"items":[{"display_name":"Flight Booking","sku":"","unit_price":checkoutTotalInCents,"qty":1,"item_image_url":"","item_url":""}],"discounts":discounts,"metadata":{"mode":"modal","itinerary":{'type':'flight','sku':checkoutFlightInfo.flightNumbers,'display_name':checkoutFlightInfo.display_name,'origin':checkoutFlightInfo.origin,'destination':checkoutFlightInfo.destination,'date':checkoutFlightInfo.departureTime,'qty':checkoutFlightInfo.numPassengers,}},"order_id":Mv.CheckoutData.getOrderId(),"shipping_amount":0,"tax_amount":0,"total":checkoutTotalInCents,"currency":(Mv.CheckoutData.getCurrency()).toUpperCase(),};affirm.checkout.open_vcn({success:function(card_details){Mv.AlternatePaymentMethods.Manager.trackEvent('Affirm',Mv.AlternatePaymentMethods.Manager.trackEventTypes.PAY_SUCCESS);var getCardType=function(cardNumber){cardNumber=cardNumber.toString();if(cardNumber[0]=='4'){return 'VI';}
return 'CA';};submitData.cc_number=card_details.number;submitData.cc_cvv=card_details.cvv;submitData.cc_expiry_month=card_details.expiration.substring(0,2);submitData.cc_expiry_year="20"+card_details.expiration.substring(2,4);submitData.cc_type=getCardType(card_details.number);submitData.affirm_checkout_token=card_details.checkout_token;submitData.affirm_checkout_amount=Mv.CheckoutData.getTotalInCents();var fullnameSplit=card_details.cardholder_name.split(" ");submitData.cc_first_name=fullnameSplit.shift();submitData.cc_last_name=fullnameSplit.join(" ");endProcessCallback({status:true,submitData:submitData});},error:function(error_response){Mv.AlternatePaymentMethods.Manager.trackEvent('Affirm',Mv.AlternatePaymentMethods.Manager.trackEventTypes.PAY_FAILURE);endProcessCallback({status:false,errorData:error_response});},checkout_data:checkoutData});};this.valid=true;};Mv.DisplayedItemsTracking=Mv.DisplayedItemsTracking||{data:{},isSent:false,trackingUri:'https://www.justfly.com/checkout/displayed-data-tracking/',trackingKey:'prc_dsp_trk',collect:function(){try{this.data={};window.$('[data-'+this.trackingKey+']').each(function(i,element){var trkElement=window.$(element);this.data[trkElement.data(this.trackingKey).toString()]=trkElement.text().toString().trim().replace(/[^0-9\.]/g,'');}.bind(this));}catch(e){}
return this;},send:function(bookingId){try{if(this.isSent||typeof bookingId==='undefined'||Object.keys(this.data).length===0){return this;}
this.isSent=true;$.ajax({url:this.trackingUri+bookingId,data:{data:this.data},type:'post',dataType:'json',success:function(data){},error:function(jqXHR,textStatus,errorThrown){}});}catch(e){}
return this;}};(function(){function createDiv(){return $('<div></div>');}
function createFixedModal(){var overlay=createDiv().addClass('fixed-modal-overlay');var wrapper=createDiv().addClass('fixed-modal-wrapper');var container=createDiv().addClass('fixed-modal-container');var closeBtn=createDiv().addClass('fixed-modal-close-btn');overlay.append(wrapper);wrapper.append(container);container.append(closeBtn);closeableElements=closeBtn.add(overlay);closeableElements.on('click',(function(closeableElements){return function(event){if(closeableElements.is(event.target)){overlay.toggleClass('show',false);}}})(closeableElements));return overlay;}
function getParentOrSelf(element,selector){if($(element).is(selector)){return $(element);}
return $(element).parents(selector).first();}
Mv.FixedModal={open:function(element){var elementModalOverlay=getParentOrSelf(element,'.fixed-modal-overlay');if(elementModalOverlay.length==0){elementModalOverlay=createFixedModal();$(element).before(elementModalOverlay);if(!$(element).hasClass('fixed-modal-content')){$(element).addClass('fixed-modal-content');}
elementModalOverlay.find('.fixed-modal-container').append(element);element.show();}
elementModalOverlay.toggleClass('show',true);},};})();$(document).ready(function(){$('body').on('click','[data-flexticket-modal-trigger]',function(event){event.preventDefault();var packageId=$(this).attr('data-flexticket-modal-trigger');Modal.open({html:$('[data-flexticket-modal="'+packageId+'"]').html(),width:500,additionalClasses:'flight-info-modal',})});});(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
window.CustomEvent=CustomEvent;})();Mv.loginModalInitialized=false;Mv.loginModalEvents={userLogged:"modal-user-logged-in",trigger:"trigger-login-modal"};Mv.loginModal=function(els,optsArg,isFhubDesktop){var body=$("body");var modalRefs={};var modalId;var msgs;var processing=false;var logInType=null;var logged=false;var gApiStatus={};var fbApiStatus={};var userLoggedEvent;var currentMode;var titles={};var mouseDownId;var mouseUpId;var extParams={postLoginRedirectUrl:null,postLoginCb:null,queryParameters:null};if(Mv.loginModalInitialized){return;}
var GOOGLE_FAILED={ACCESS_DENIED:"access_denied",POPUP_CLOSED:"popup_closed_by_user"};var STATUSES={ERROR:0,SUCCESS:1};var MODES={INITIAL:0,AUTH_USER:1,REGISTER_USER:2,SEARCH_BOOKING:3,AUTH_USER_TOTP:4,SEARCH_BOOKING_TOTP:5};var LOG_IN_TYPE={NON_SOCIAL:'nonSocial',FACEBOOK:'facebook',GOOGLE:'google',};var INVALID_LOGIN_INFO={MISSING_BOOKING_ID:'missing_booking_id',MISSING_LAST_NAME:'missing_last_name',BOOKING_NOT_MATCHED:'booking_not_matched',BOOKING_VERIFICATION_FAILED:'booking_verification_failed',TOTP_VERIFICATION_FAILED:'totp_verification_failed'}
gApiStatus={loaded:isGoogleApiUsable(),loading:false,tries:0,maxTries:5};fbApiStatus={loaded:typeof FB!=="undefined",loading:false};opts={modalTemplate:"<div id=\"login-modal\" class=\"login-modal-overlay\" style=\"display: none;\">\n    <div class=\"inner-wrap site-login-modal\">\n        <a href=\"#\" id=\"top-right-modal-close\" class=\"close-modal-btn login-modal-close\"><\/a>\n\n        <!-- Initial page ----------------------------------------------------------->\n        <div id=\"page-initial\" class=\"coupon-step modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Sign in or Register!<\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <!-- Social sign-up -->\n            <div class=\"social-login-wrap\">\n                <div class=\"login-modal-subtitle\">Use your social media information to connect with us<\/div>\n\n                <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                    <div class=\"spinner\"><\/div>\n                <\/div>\n\n                <ul class=\"login-modal-social\">\n                    <li class=\"item\">\n                        <button id=\"login-modal-fb\" class=\"login-btn disabled fb\" tabindex=\"0\">\n                            <span class=\"icon fa fa-facebook\"><\/span>\n                            <span>Facebook<\/span>\n                        <\/button>\n                    <\/li>\n                    <li class=\"item\">\n                        <button id=\"login-modal-g\" class=\"login-btn disabled gp\" tabindex=\"0\">\n                            <span class=\"icon jf-icon jf-google\"><\/span>\n                            <span>Google<\/span>\n                        <\/button>\n                    <\/li>\n                <\/ul>\n                <div class=\"regular-login-loading-overlay\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <hr class=\"hr-text\" data-content=\"Or use your email address\">\n\n            <!-- Regular sign-in -->\n            <div class=\"is-login-form\">\n                <form id=\"login-modal-form\" class=\"log-in-modal-form\">\n                    <ul class=\"login-input-items\">\n                        <li class=\"item\">\n                            <label>Email<\/label>\n                            <div class=\"login-modal-input email\">\n                                <input id=\"login-modal-account-login-email\" type=\"email\" name=\"email\" placeholder=\"john.doe@myemail.com\" tabindex=\"0\" value=\"\" attr-c-email-prefill \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <button class=\"login-modal-submit-btn is-main-button regular\" tabindex=\"0\">Continue<\/button>\n                        <\/li>\n                    <\/ul>\n                <\/form>\n                <div class=\"login-modal-processing social-login-loading-overlay\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <hr class=\"hr-text\" data-content=\"Or use your reference number\">\n\n            <!-- Search by reference # link -->\n            <div class=\"search-by-ref-number\">\n                <a id=\"ref-page-trigger\" href=\"#\" class=\"ref-search-btn\">Find my booking as guest<\/a>\n            <\/div>\n        <\/div>\n\n\n        <!-- Auth page -------------------------------------------------------------->\n        <div id=\"page-auth\" class=\"coupon-step modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Sign in or Register!<\/div>\n\n            <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                <div class=\"spinner\"><\/div>\n            <\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <a href=\"#\" class=\"login-modal-back-button\">\n                <span class=\"fa fa-arrow-left\"><\/span>\n            <\/a>\n\n            <div class=\"is-login-form\">\n                <form id=\"login-auth-form\" class=\"log-in-modal-form\">\n                    <ul class=\"login-input-items\">\n                        <li class=\"item\">\n                            <label>Email<\/label>\n                            <div class=\"login-modal-input email\">\n                                <input class=\"login-modal-checked-email email-auth\" type=\"email\" name=\"email\" data-lpignore=\"true\" placeholder=\"Your Email Address\" disabled=\"disabled\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Password<\/label>\n                            <div class=\"login-modal-input password\">\n                                <input id=\"login-modal-account-login-password\" type=\"password\" name=\"password\" placeholder=\"******\"\/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item button\">\n                            <button class=\"login-modal-submit-btn is-main-button regular\">Sign in<\/button>\n                        <\/li>\n                    <\/ul>\n                <\/form>\n\n                <div class=\"login-modal-processing social-login-loading-overlay\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <!-- Forgot password -->\n            <div class=\"coupon-forgot-password-button\">\n                <button id=\"login-modal-forgot\">Forgot password?<\/button>\n            <\/div>\n        <\/div>\n\n\n        <!-- Register page ---------------------------------------------------------->\n        <div id=\"page-register\" class=\"coupon-step modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Sign in or Register!<\/div>\n\n            <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                <div class=\"spinner\"><\/div>\n            <\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <a href=\"#\" class=\"login-modal-back-button\">\n                <span class=\"fa fa-arrow-left\"><\/span>\n            <\/a>\n\n            <div class=\"is-login-form\">\n                <form id=\"login-registration-form\" class=\"log-in-modal-form\">\n                    <ul class=\"login-input-items\">\n                        <li class=\"item\">\n                            <label>Email<\/label>\n                            <div class=\"login-modal-input email\">\n                                <input class=\"login-modal-checked-email\" type=\"email\" name=\"email\" placeholder=\"john.doe@myemail.com\" disabled=\"disabled\" value=\"\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>First Name<\/label>\n                            <div class=\"login-modal-input name\">\n                                <input id=\"login-modal-first-name\" type=\"text\" name=\"firstName\" placeholder=\"John\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Last Name<\/label>\n                            <div class=\"login-modal-input name\">\n                                <input id=\"login-modal-last-name\" type=\"text\" name=\"lastName\" placeholder=\"Doe\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Password<\/label>\n                            <div class=\"login-modal-input password\">\n                                <input data-main-pass=\"modal-signup\" id=\"login-modal-account-register-password\" type=\"password\" name=\"password\" placeholder=\"******\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Confirm password<\/label>\n                            <div class=\"login-modal-input password\">\n                                <input data-main-pass-confirm=\"modal-signup\" type=\"password\" name=\"confirm-password\" placeholder=\"******\" \/>\n                            <\/div>\n                            <div data-main-pass-error=\"modal-signup\" id=\"confirm-error\">\n                                <span class=\"fa fa-warning red\"><\/span>  b2b-confirmpass-error                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <button data-main-pass-submit=\"modal-signup\" class=\"login-modal-submit-btn is-main-button regular\">Sign up<\/button>\n                        <\/li>\n                    <\/ul>\n                <\/form>\n\n                <div class=\"login-modal-processing social-login-loading-overlay\" style=\"display:none;\"><\/div>\n            <\/div>\n        <\/div>\n\n        <!-- Booking reference # search page ---------------------------------------------------------->\n        <div id=\"page-ref-search\" class=\"modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Find with Booking Reference Number<\/div>\n\n            <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                <div class=\"spinner\"><\/div>\n            <\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <a href=\"#\" class=\"login-modal-back-button\">\n                <span class=\"fa fa-arrow-left\"><\/span>\n            <\/a>\n\n            <form id=\"ref-search-form\" class=\"log-in-modal-form\">\n                <ul class=\"login-input-items\">\n                    <li class=\"item\">\n                        <label>Reference Number<\/label>\n                        <div class=\"login-modal-input email\">\n                            <input id=\"login-modal-ref-number-input\" type=\"text\" name=\"refNumber\" placeholder=\"123-456-789\" autocomplete=\"off\" \/>\n                        <\/div>\n                    <\/li>\n                    <li class=\"item\">\n                        <label>Last Name<\/label>\n                        <div class=\"login-modal-input password\">\n                            <input id=\"login-modal-last-name-input\" type=\"text\" name=\"lastName\" placeholder=\"Last Name\" autocomplete=\"off\" \/>\n                        <\/div>\n                    <\/li>\n                    <li class=\"item button\">\n                        <button id=\"login-modal-ref-search-btn\" class=\"login-modal-ref-search-btn is-main-button regular\">Search<\/button>\n                    <\/li>\n                <\/ul>\n            <\/form>\n        <\/div>\n\n        <!-- Auth page with TOTP -------------------------------------------------->\n        <div id=\"page-auth-totp\" class=\"coupon-step modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Sign in or Register!<\/div>\n\n            <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                <div class=\"spinner\"><\/div>\n            <\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <a href=\"#\" class=\"login-modal-back-button\">\n                <span class=\"fa fa-arrow-left\"><\/span>\n            <\/a>\n\n            <div class=\"is-login-form\">\n                <form id=\"login-totp-auth-form\" class=\"log-in-modal-form\">\n                    <div class=\"login-modal-subtitle\" style=\"margin-bottom: 10px;\">\n                        To keep your account secure, we verify your identity. Enter the code sent to the email address we have on file.                    <\/div>\n\n                    <ul class=\"login-input-items\">\n                        <li class=\"item\">\n                            <label>Email<\/label>\n                            <div class=\"login-modal-input email\">\n                                <input id=\"login-modal-account-totp-login-email\" class=\"login-modal-checked-email\" type=\"email\" name=\"email\" placeholder=\"Your Email Address\" disabled=\"disabled\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Password<\/label>\n                            <div class=\"login-modal-input password\">\n                                <input id=\"login-modal-account-totp-login-password\" type=\"password\" name=\"password\" placeholder=\"******\" disabled=\"disabled\" \/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item\">\n                            <label>Verification Code<\/label>\n                            <div class=\"login-modal-input totp\">\n                                <input id=\"login-modal-account-login-totp\" type=\"text\" name=\"totp\" placeholder=\"123456\"\/>\n                            <\/div>\n                        <\/li>\n                        <li class=\"item button\">\n                            <button class=\"login-modal-submit-btn is-main-button regular\">Sign in<\/button>\n                        <\/li>\n                    <\/ul>\n                <\/form>\n\n                <div class=\"login-modal-processing social-login-loading-overlay\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <!-- Did not receive code -->\n            <div class=\"coupon-forgot-password-button\">\n                <button class=\"login-modal-resend-totp\">Didn't receive code, please resend.<\/button>\n            <\/div>\n        <\/div>\n\n        <!-- Booking reference # search page with TOTP ------------------------------------------------>\n        <div id=\"page-ref-search-totp\" class=\"modal-page\">\n\n            <div id=\"login-modal-title\" class=\"legend\" tabindex=\"0\">Find with Booking Reference Number<\/div>\n\n            <div class=\"login-modal-processing subscribe-loader\" style=\"display:none;\">\n                <div class=\"spinner\"><\/div>\n            <\/div>\n\n            <div class=\"modal-error-login-wrap\">\n                <div class=\"login-modal-login-feedback-message\" style=\"display:none;\"><\/div>\n            <\/div>\n\n            <a href=\"#\" class=\"login-modal-back-button\">\n                <span class=\"fa fa-arrow-left\"><\/span>\n            <\/a>\n\n            <form id=\"ref-search-form-totp\" class=\"log-in-modal-form\">\n                <div class=\"login-modal-subtitle\" style=\"margin-bottom: 10px;\">\n                    To keep your account secure, we verify your identity. Enter the code sent to the email address we have on file.                <\/div>\n\n                <ul class=\"login-input-items\">\n                    <li class=\"item\">\n                        <label>Reference Number<\/label>\n                        <div class=\"login-modal-input email\">\n                            <input id=\"login-modal-ref-number-totp-input\" type=\"text\" name=\"refNumber\" placeholder=\"123-456-789\" autocomplete=\"off\" disabled=\"disabled\" \/>\n                        <\/div>\n                    <\/li>\n                    <li class=\"item\">\n                        <label>Last Name<\/label>\n                        <div class=\"login-modal-input password\">\n                            <input id=\"login-modal-last-name-totp-input\" type=\"text\" name=\"lastName\" placeholder=\"Last Name\" autocomplete=\"off\" disabled=\"disabled\" \/>\n                        <\/div>\n                    <\/li>\n                    <li class=\"item\">\n                        <label>Verification Code<\/label>\n                        <div class=\"login-modal-input totp\">\n                            <input id=\"login-modal-ref-totp-input\" type=\"text\" name=\"totp\" placeholder=\"123456\"\/>\n                        <\/div>\n                    <\/li>\n                    <li class=\"item button\">\n                        <button id=\"login-modal-ref-search-totp-btn\" class=\"login-modal-ref-search-btn is-main-button regular\">Sign in<\/button>\n                    <\/li>\n                <\/ul>\n            <\/form>\n\n            <!-- Did not receive code -->\n            <div class=\"coupon-forgot-password-button\">\n                <button class=\"login-modal-resend-totp\">Didn't receive code, please resend.<\/button>\n            <\/div>\n        <\/div>\n\n    <\/div>\n<\/div>\n <style>\n    button[data-main-pass-submit].disabled {\n        background-color: #f4f4f4;\n        color: #c9c9c9;\n        background-image: none;\n        cursor: default;\n    }\n\n    button[data-main-pass-submit].disabled:hover {\n        background-color: #f4f4f4;\n    }\n\n    #confirm-error {\n        margin: 0 0 10px;\n        display: none;\n        clear: both;\n        overflow: hidden;\n        color: #ff0000;\n    }\n    .str-container{\n        display: flex;\n        align-items: center;\n        gap: 5px;\n    }\n    .str-container>div{\n        width: 15%;\n        height: 5px;\n        background-color: lightgrey;\n    }\n    [data-pass-strength='partner-signup']{\n        margin-bottom: 15px;\n    }\n<\/style>\n\n\n<script>\n    const regExp = {\n        specialChar : \/[*@!#%&()^~{}\\[\\]|<>,.\\\/?_+\\-=\\\\$:;]+\/g,\n        oneDigit    : \/[0-9]+\/g,\n        oneLower    : \/[a-z]+\/g,\n        oneUpper    : \/[A-Z]+\/g,\n    }\n    const charLimit = {min : 8, max : 32};\n    var typingTimer;\n    var doneTypingInterval = 600;\n\n    $(document).ready(function() {\n        let passMatches = false;\n        let weakPass    = true;\n        let grey        = '#f4f4f4',\n        red             = '#D1463B',\n        yellow          = '#f8ca33',\n        blue            = '#2cb8e2',\n        green           = '#2BD78F';\n        let score       = {value: 0}\n\n        function showStrRequirements() {\n            $('[data-pass-strength]').show(400)\n        }\n        function hideStrRequirements() {\n            if($('[data-pass-strength]').val()!==0 && !weakPass){\n                $('[data-pass-strength]').hide(400)\n            }\n        }\n\n        function matchPassword (mainPass, confirmPass)\n        {\n            let formSubmit = $('[data-main-pass-submit=' + mainPass.attr(\"data-main-pass\") + ']')\n            let confirmError = $('[data-main-pass-error=' + mainPass.attr(\"data-main-pass\") + ']')\n\n            if (mainPass.val() === confirmPass.val()) {\n                passMatches = true\n                updateSubmitButton(formSubmit)\n                confirmError.hide(400)\n            } else {\n                passMatches = false\n                updateSubmitButton(formSubmit)\n                confirmError.show(400)\n\n            }\n\n        }\n\n        function handleScore(submitBtn) {\n            weakPass = score.value < 5\n            updateSubmitButton(submitBtn)\n        }\n\n        function checkStrength()\n        {\n            score.value = 0;\n            let currentForm  = $(this).attr(\"data-main-pass\");\n            let submitBtn    = $('[data-main-pass-submit=' + currentForm + ']');\n\n            let password     = $(this).val(),\n            specialCharCheck = {\n                condition : password.match(regExp.specialChar),\n                child     : $('[data-special-char=' + currentForm + ']>span'),\n                parent    : $('[data-special-char=' + currentForm + ']')\n            },\n            oneDigitCheck    = {\n                condition : password.match(regExp.oneDigit),\n                child     : $('[data-digit=' + currentForm + ']>span'),\n                parent    : $('[data-digit=' + currentForm + ']')\n            },\n            oneLowerCheck    = {\n                condition : password.match(regExp.oneLower),\n                child     : $('[data-lowercase=' + currentForm + ']>span'),\n                parent    : $('[data-lowercase=' + currentForm + ']')\n            },\n            oneUpperCheck    = {\n                condition : password.match(regExp.oneUpper),\n                child     : $('[data-uppercase=' + currentForm + ']>span'),\n                parent    : $('[data-uppercase=' + currentForm + ']')\n            },\n            charLimitCheck   = {\n                condition : password.length >= charLimit.min && password.length <= charLimit.max,\n                child     : $('[data-characters-limit=' + currentForm + ']>span'),\n                parent    : $('[data-characters-limit=' + currentForm + ']')\n            };\n\n            updateScoreValue(specialCharCheck, currentForm)\n            updateScoreValue(oneDigitCheck, currentForm)\n            updateScoreValue(oneLowerCheck, currentForm)\n            updateScoreValue(oneUpperCheck, currentForm)\n            updateScoreValue(charLimitCheck, currentForm)\n\n            handleScore(submitBtn)\n        }\n\n        function updateSubmitButton(button)\n        {\n            if (weakPass || ! passMatches) {\n                button.addClass('disabled')\n                button.prop('disabled', true)\n            } else{\n                button.removeClass('disabled')\n                button.prop('disabled', false)\n            }\n        }\n\n        function changeColor(amount, color, elements, changeAll = false)\n        {\n            if(changeAll){\n                for (let i = 0; i < amount; i++) {\n                    elements[i].css('background-color', color);\n                }\n            }else{\n                elements[amount-1].css('background-color', color);\n            }\n\n        }\n\n        function updateScoreBar(requirement, currentForm)\n        {\n            \/\/ debugger;\n            let elements = [\n                $('[data-strength-1=' + currentForm + ']'),\n                $('[data-strength-2=' + currentForm + ']'),\n                $('[data-strength-3=' + currentForm + ']'),\n                $('[data-strength-4=' + currentForm + ']')\n            ];\n\n            switch (score.value) {\n                case 0:\n                    changeColor(4, grey, elements, true);\n                    break;\n                case 1:\n                    changeColor(1, red, elements);\n                    break;\n                case 2:\n                    changeColor(2, yellow, elements);\n                    break;\n                case 3:\n                case 4:\n                    changeColor(3, blue, elements);\n                    break;\n                case 5:\n                    changeColor(4, green, elements);\n                    break;\n            }\n        }\n\n        function updateScoreValue(requirement, currentForm)\n        {\n            let add, remove;\n            if(requirement.condition){\n                score.value++;\n                add = 'fa-check green';\n                remove = 'fa-close red';\n            } else {\n                remove = 'fa-check green';\n                add = 'fa-close red';\n            }\n            requirement.child.removeClass(remove)\n            requirement.child.addClass(add)\n            updateScoreBar(requirement, currentForm);\n        }\n\n        $('[data-main-pass], [data-main-pass-confirm]').on(\"keyup\", function () {\n            let mainPass = $(this).attr('data-main-pass') ? $(this) : $('[data-main-pass=\"'+$(this).attr('data-main-pass-confirm')+'\"]');\n            let confirmPass = $(this).attr('data-main-pass-confirm') ? $(this) : $('[data-main-pass-confirm=\"'+$(this).attr('data-main-pass')+'\"]');\n            if(confirmPass.val().length !== 0){\n                clearTimeout(typingTimer);\n                typingTimer = setTimeout(function(){\n                    matchPassword(mainPass, confirmPass)\n                }, doneTypingInterval);\n            }\n        });\n\n\n\n        $('[data-main-pass]').on(\"keyup\", checkStrength);\n        $('[data-main-pass]').on(\"focusin\", showStrRequirements)\n        $('[data-main-pass]').on(\"focusout\", hideStrRequirements)\n\n        $(document).on(\"keydown\", \"form\", function(event) {\n            if(!passMatches || weakPass) {\n                return event.key !== \"Enter\";\n            }\n        })\n    })\n<\/script>\n",mainEndpoints:{},googleSignUpEndpoint:"/account/google-signup-process",facebookSignUpEndpoint:"/account/facebook-signup-process",forgotEndpoint:"/account/password-forgot-process",refSearchEndpoint:"/account/modal-2fa-ref-search-process",resendTotpEndpoint:"/account/resend-totp",modalCloseDelay:1500,inclHeaderFlag:"include_header=1",header:$(".jfly-header"),headerDropdownParentQuery:".jfly-header-user-profile",userNavItem:".user-profile-items .desktop-header-nav-item:first-child",fadeTime:300,classes:{inputParentFocus:"focus",headerDropdownUpdated:"header-dropdown-updated",feedback:{base:"login-modal-feedback",success:"feedback-success",error:"feedback-error"},socialBtnDisabled:"disabled"}};titles[MODES.INITIAL]="Sign in or Register!";titles[MODES.AUTH_USER]="Sign in or Register!";titles[MODES.REGISTER_USER]="Create your Justfly.com account";titles[MODES.AUTH_USER_TOTP]="Create your Justfly.com account";titles[MODES.SEARCH_BOOKING_TOTP]="Create your Justfly.com account";opts.mainEndpoints[MODES.INITIAL]="/account/modal-login-check-email";opts.mainEndpoints[MODES.AUTH_USER]="/account/modal-2fa-process";opts.mainEndpoints[MODES.REGISTER_USER]="/account/modal-login-register";opts.mainEndpoints[MODES.AUTH_USER_TOTP]="/account/modal-2fa-login-process";opts.mainEndpoints[MODES.SEARCH_BOOKING_TOTP]="/account/modal-2fa-ref-search-login-process";msgs={success:"Success",loginSuccess:"<div class='login-success-msg'><div class='icon-wrap is-round-icon'><span class='jf-icon jf-custom-check'></span></div>Welcome to Justfly!</div>",loginSuccessRefresh:"<div class='login-success-msg'><div class='icon-wrap is-round-icon'><span class='jf-icon jf-custom-check'></span></div>Welcome to Justfly!<br>Please wait while we redirect you.</div>",error:"Error, unable to reach the server. Please try again.",google:{accDenied:"Oops, you forgot to log in! Please try again.",popupClosed:"We were unable to complete your request. Please update your permission settings and try again.",errorLoading:"There was an error. Please try again later."},facebook:{accDenied:"Oops, you forgot to log in! Please try again.",popupClosed:"We were unable to complete your request. Please update your permission settings and try again.",missingPermission:"Your request wasn’t complete due to missing permissions. Please make sure the {} permission is checked."}};$.extend(true,opts,(optsArg||{}));modalId=$(opts.modalTemplate).attr("id");body.append(opts.modalTemplate);modalRefs={modal:$('#'+modalId),modalInnerWrap:$('#'+modalId+' .inner-wrap'),form:$(".log-in-modal-form"),emailInput:$("#login-modal-account-login-email"),checkedEmailInputs:$(".login-modal-checked-email"),passInput:$("#login-modal-account-login-password"),totpEmailInput:$("#login-modal-account-totp-login-email"),totpPassInput:$("#login-modal-account-totp-login-password"),totpInput:$("#login-modal-account-login-totp"),passForgot:$("#login-modal-forgot"),resendTotp:$(".login-modal-resend-totp"),totpAuthForm:$("#login-totp-auth-form"),feedback:$(".login-modal-login-feedback-message"),processing:$(".login-modal-processing"),submit:$(".login-modal-submit-btn"),closeEls:$(".login-modal-close"),google:$("#login-modal-g"),facebook:$("#login-modal-fb"),title:$("#login-modal-title"),allInputs:$('#'+modalId+" input").not(":submit").not(":disabled"),allDisabledInputs:$('#'+modalId+" input").not(":submit").not(":enabled"),backBtns:$(".login-modal-back-button"),registerFirstInput:$("#login-modal-first-name"),authModeEmailInput:$(".login-modal-checked-email.email-auth"),pageInitial:$("#page-initial"),pageAuth:$("#page-auth"),pageRegister:$("#page-register"),pageRefSearch:$("#page-ref-search"),pageAuthTotp:$("#page-auth-totp"),pageRefSearchTotp:$("#page-ref-search-totp"),modalPages:$(".modal-page"),totpRefSearchForm:$('#ref-search-form-totp'),refNumInput:$("#login-modal-ref-number-input"),lastNameInput:$("#login-modal-last-name-input"),refNumTotpInput:$("#login-modal-ref-number-totp-input"),lastNameTotpInput:$("#login-modal-last-name-totp-input"),refTotpInput:$("#login-modal-ref-totp-input"),refSearchPageTrigger:$("#ref-page-trigger"),mainPageTrigger:$("#main-page-trigger"),refSearchForm:$("#ref-search-form"),refSearchSubmitButton:$("#login-modal-ref-search-btn"),refSearchTotpSubmitButton:$("#login-modal-ref-search-totp-btn"),};$(els).click(handleTriggersClick);$(els).hover(handleTriggersHover);$(body).mousedown(handleMouseDown);$(body).mouseup(handleMouseUp);modalRefs.authModeEmailInput.on("input",(event)=>{$(event.target).val(modalRefs.emailInput.val());});$(document).on(Mv.loginModalEvents.trigger,function(e,params){if(params!==undefined&&typeof params==="object"){extParams=params;}
handleTriggersHover(e);handleTriggersClick(e);});modalRefs.modal.click(handleOverlayClick);modalRefs.form.submit(handleSubmit);modalRefs.passForgot.click(handleForgotClick);modalRefs.resendTotp.click(handleResendTotpClick);modalRefs.closeEls.click(handleCloseClick);modalRefs.backBtns.click(handleBackBtnsClick);modalRefs.google.click(handleGoogleClick);modalRefs.facebook.click(handleFacebookClick);modalRefs.allInputs.focus(handleInputsFocus);modalRefs.allInputs.blur(handleInputsBlur);modalRefs.refSearchPageTrigger.click(handleRefSearchPageTriggerClick);modalRefs.mainPageTrigger.click(handleMainPageTriggerClick);modalRefs.refSearchForm.submit(handleRefSearchFormSubmit);modalRefs.refSearchSubmitButton.click(handleRefSearchFormSubmit);modalRefs.refSearchTotpSubmitButton.click(handleRefSearchTotpFormSubmit);modalRefs.refNumInput.on("input propertychange",handleRefSearchInputChange);function applyBookingRefNumberMask(input){var sections=[];for(var i=0;i<3;i++){sections.push(input.substr(i*3,3));}
var output="";for(var j=0;j<2;j++){output+=sections[j];if(sections[j].length===3){output+="-";}}
return output+sections[2];}
function getCleanReferenceNumberInput(){return modalRefs.refNumInput.val().replace(/\D/g,'');}
function getErrorDisplayMessage(error){msgs={missingBookingId:"Please enter a reference number.",missingLastName:"Please enter last name.",bookingNotMatched:"We’re sorry, the reference number you have entered is invalid.",bookingVerificationFailed:"We’re sorry, booking verification failed. Please try again later.",defaultErrorMsg:"Error, unable to reach the server. Please try again."};let errorMsg=msgs.defaultErrorMsg;switch(error){case INVALID_LOGIN_INFO.MISSING_BOOKING_ID:errorMsg=msgs.missingBookingId;break;case INVALID_LOGIN_INFO.MISSING_LAST_NAME:errorMsg=msgs.missingLastName;break;case INVALID_LOGIN_INFO.BOOKING_NOT_MATCHED:errorMsg=msgs.bookingNotMatched;break;case INVALID_LOGIN_INFO.BOOKING_VERIFICATION_FAILED:errorMsg=msgs.bookingVerificationFailed;break;}
showFeedback(STATUSES.ERROR,errorMsg);}
function handleRefSearchInputChange(e){if(e.originalEvent.inputType==="deleteContentBackward"&&this.prevInput[this.prevInput.length-1]==='-'){modalRefs.refNumInput.val(modalRefs.refNumInput.val().slice(0,-1));}
var input=applyBookingRefNumberMask(getCleanReferenceNumberInput().substr(0,9));this.prevInput=input;modalRefs.refNumInput.val(input);}
function handleRefSearchFormSubmit(e){e.preventDefault();if(processing||logged){return;}
modalRefs.allDisabledInputs.removeAttr("disabled");modalRefs.allDisabledInputs.attr("disabled","disabled");startModalProcessing();$.ajax({url:opts.refSearchEndpoint,type:"POST",dataType:"json",data:JSON.stringify({bookingId:getCleanReferenceNumberInput(),lastName:modalRefs.lastNameInput.val()}),contentType:"application/json",success:function(response){stopModalProcessing();if(response.totp_required){modalRefs.refNumTotpInput.val(modalRefs.refNumInput.val());modalRefs.lastNameTotpInput.val(modalRefs.lastNameInput.val());modalRefs.refTotpInput.attr('disabled',false);changeModalMode(MODES.SEARCH_BOOKING_TOTP);}else{if(response.error){getErrorDisplayMessage(response.error);}else if(response.message){showFeedback(STATUSES.ERROR,response.message);}}},error:function(response){getErrorDisplayMessage(jQuery.parseJSON(response.responseText).error);}});}
function handleRefSearchTotpFormSubmit(e){e.preventDefault();if(processing||logged){return;}
modalRefs.allDisabledInputs.removeAttr("disabled");modalRefs.allDisabledInputs.attr("disabled","disabled");startModalProcessing();$.ajax({url:opts.mainEndpoints[currentMode],type:"POST",dataType:"json",data:JSON.stringify({bookingId:getCleanReferenceNumberInput(),lastName:modalRefs.lastNameInput.val(),totp:modalRefs.refTotpInput.val()}),contentType:"application/json",success:function(response){if(response.hashId){if(extParams.queryParameters&&typeof extParams.queryParameters==='object'){let queryString=Object.keys(extParams.queryParameters).map(function(key){return key+'='+extParams.queryParameters[key];}).join('&');window.location.href=window.location.href.split('?')[0]+'?'+queryString;}else if(extParams.postLoginCb&&typeof extParams.postLoginCb==='function'){extParams.postLoginCb(getCleanReferenceNumberInput(),response.hashId);}else{window.location.href='/service/portal/detail/'.concat(response.hashId);}}else{stopModalProcessing();showFeedback(STATUSES.ERROR,response.message);}},error:function(response){stopModalProcessing();showFeedback(STATUSES.ERROR,"Error, unable to reach the server. Please try again.");}});}
function handleMainPageTriggerClick(e){e.preventDefault();changeModalMode(MODES.INITIAL);}
function handleRefSearchPageTriggerClick(e){e.preventDefault();changeModalMode(MODES.SEARCH_BOOKING);}
function open(){changeModalMode(MODES.INITIAL);modalRefs.modal.fadeIn(opts.fadeTime,function(){modalRefs.title.focus();});modalRefs.emailInput.val(Mv.env.user.prefillEmail);$(".header-dropdown-wrap.my-account").hide();}
function close(cb){modalRefs.modal.fadeOut(opts.fadeTime,cb);hideFeedback();modalRefs.allInputs.val('');modalRefs.emailInput.val(Mv.env.user.prefillEmail);}
function isOpen(){return modalRefs.modal.is(":visible");}
function handleTriggersClick(e){e.preventDefault();open();}
function handleInputsFocus(e){$(this).parent().addClass(opts.classes.inputParentFocus);}
function handleInputsBlur(e){$(this).parent().removeClass(opts.classes.inputParentFocus);}
function handleTriggersHover(e){checkToLoadGoogleApi();checkToLoadFacebookApi();}
function handleOverlayClick(e){if($(e.target).attr("id")!==modalId||mouseUpId!==mouseDownId){return;}
close();}
function handleMouseDown(e){mouseDownId=$(e.target).attr("id")
return;}
function handleMouseUp(e){mouseUpId=$(e.target).attr("id")
return;}
function handleBackBtnsClick(e){e.preventDefault();changeModalMode(MODES.INITIAL);}
function handleCloseClick(e){e.preventDefault();close();}
function handleForgotClick(e){var sentData;if(processing||logged){return;}
sentData=modalRefs.emailInput.serialize();startModalProcessing();$.ajax({url:opts.forgotEndpoint,type:"POST",dataType:"JSON",data:sentData,success:function(response){showFeedback(response.result?STATUSES.SUCCESS:STATUSES.ERROR,response.feedback_message);},error:function(){showFeedback(STATUSES.ERROR);}});}
function handleResendTotpClick(e){e.preventDefault();if(processing||logged){return;}
modalRefs.allDisabledInputs.removeAttr("disabled");if(currentMode===MODES.AUTH_USER_TOTP){var serializedFormData=modalRefs.totpAuthForm.serialize();modalRefs.totpEmailInput.attr('disabled','disabled');modalRefs.totpPassInput.attr('disabled','disabled');}else{var serializedFormData={bookingId:getCleanReferenceNumberInput(),lastName:modalRefs.lastNameInput.val()};modalRefs.refNumTotpInput.attr('disabled','disabled');modalRefs.lastNameTotpInput.attr('disabled','disabled');}
startModalProcessing();$.ajax({url:opts.resendTotpEndpoint,type:"POST",dataType:"JSON",data:serializedFormData,success:function(response){showFeedback(response.result?STATUSES.SUCCESS:STATUSES.ERROR,response.feedback_message);},error:function(){showFeedback(STATUSES.ERROR);},complete:function(){modalRefs.totpInput.removeAttr('disabled');modalRefs.refTotpInput.removeAttr('disabled');}});}
function startModalProcessing(){processing=true;modalRefs.processing.show();modalRefs.allInputs.attr("disabled","disabled");hideFeedback();}
function stopModalProcessing(){processing=false;modalRefs.processing.hide();modalRefs.allInputs.removeAttr("disabled");}
function handleUserLogin(newHeader,email){var oldUserNavItem=opts.header.find(opts.userNavItem);var newUserNavItem;var refresh=shouldRefreshOnLogin();logged=true;modalRefs.allInputs.attr("disabled","disabled");if(!isFhubDesktop&&newHeader){newUserNavItem=$(newHeader)[0];newUserNavItem=$(newUserNavItem).find(opts.userNavItem);$(newUserNavItem).find(".jfly-submenu-toggle").click(function(e){$(this).closest(".jfly-submenu-wrapper").toggleClass("active");$(this).next().toggle();});newUserNavItem.insertAfter(oldUserNavItem);oldUserNavItem.remove();}
try{var event=new CustomEvent(Mv.loginModalEvents.userLogged,{detail:{email:email}});document.dispatchEvent(event);}catch(e){}
Mv.env.user.userAccountEmail=email;Mv.env.user.isLoggedIn=true;if(Mv.FareAlertModal){Mv.FareAlertModal.updateModalSource(true);}
modalRefs.closeEls.remove();modalRefs.modalInnerWrap.empty().html(refresh||extParams.postLoginRedirectUrl?msgs.loginSuccessRefresh:msgs.loginSuccess);setTimeout(function(){if(extParams.postLoginCb!==null&&typeof extParams.postLoginCb==="function"){extParams.postLoginCb();}
if(extParams.postLoginRedirectUrl){window.location.href=extParams.postLoginRedirectUrl;return;}
if(refresh){window.location.reload(true);return;}
close(function(){modalRefs.modal.remove();$(opts.headerDropdownParentQuery).addClass(opts.classes.headerDropdownUpdated);});},opts.modalCloseDelay);}
function showFeedback(status,text,classes){stopModalProcessing();switch(status){case STATUSES.ERROR:classes=classes||opts.classes.feedback.error;text=text||msgs.error;break;case STATUSES.SUCCESS:classes=classes||opts.classes.feedback.success;text=text||msgs.success;break;}
modalRefs.feedback.removeClass().addClass(opts.classes.feedback.base).addClass(classes).html(text).show();}
function hideFeedback(){modalRefs.feedback.empty().hide();}
function handleSubmit(e){e.preventDefault();if(processing||logged){return;}
modalRefs.allDisabledInputs.removeAttr("disabled");var serializedFormData=$(this).serialize()+'&'+opts.inclHeaderFlag;modalRefs.allDisabledInputs.attr("disabled","disabled");startModalProcessing();logInType=LOG_IN_TYPE.NON_SOCIAL;sendRequest(serializedFormData,{});}
function sendRequest(serializedFormData,additionalData){var endpoint=opts.mainEndpoints[currentMode];var sentData=serializedFormData;if(typeof additionalData!=="undefined"){for(var prop in additionalData){sentData+="&"+prop+"="+additionalData[prop];}}
$.ajax({url:endpoint,type:"POST",dataType:"json",data:sentData,success:function(response){if(!response.result){showFeedback(STATUSES.ERROR,response.message);return;}
switch(currentMode){case MODES.INITIAL:stopModalProcessing();modalRefs.checkedEmailInputs.val(modalRefs.emailInput.val());changeModalMode(response.emailExists?MODES.AUTH_USER:MODES.REGISTER_USER);break;case MODES.REGISTER_USER:case MODES.AUTH_USER:case MODES.AUTH_USER_TOTP:stopModalProcessing();var isB2B=!!response.partner;dataLayer.push({'event':'customer_sign_in','is_b2b':isB2B,'company_id':response.company_id,'company_name':response.company_name,'allowed_domain_name':response.allowed_domain_name});if(response.totp_required){changeModalMode(MODES.AUTH_USER_TOTP);setTimeout(()=>{modalRefs.totpPassInput.val(modalRefs.passInput.val());},1000);}else if(response.partner&&(window.location.href.includes('search'))){showPartnerSearchModal();}else if(window.location.href.includes('checkout')){showPartnerCheckoutModal();}else{handleUserLogin(response.newHeader,modalRefs.checkedEmailInputs.val());}
break;}},error:function(){showFeedback(STATUSES.ERROR);}});}
function handleGoogleClick(e){e.preventDefault();if(processing||logged||!isGoogleApiUsable()){return;}
startModalProcessing();logInType=LOG_IN_TYPE.GOOGLE;gapi.auth2.getAuthInstance().currentUser.get().grantOfflineAccess().then(function success(response){handleSocialSubmit(opts.googleSignUpEndpoint,{code:response.code});},function error(response){var msg;switch(response.error){case GOOGLE_FAILED.POPUP_CLOSED:msg=msgs.google.popupClosed;break;case GOOGLE_FAILED.ACCESS_DENIED:msg=msgs.google.accDenied;break;}
showFeedback(STATUSES.ERROR,msg);});}
function handleFacebookClick(e){e.preventDefault();if(processing||logged||!isFacebookApiUsable()){return;}
startModalProcessing();logInType=LOG_IN_TYPE.FACEBOOK;promptFbSignIn().then(function success(result){for(var i=0,len=result.data.length;i<len;i++){if(result.data[i].status==="declined"){var missingPermission=result.data[i].permission.replace('_',' ');showFeedback(STATUSES.ERROR,msgs.facebook.missingPermission.replace("{}",missingPermission));return;}}
handleSocialSubmit(opts.facebookSignUpEndpoint);}).catch(function error(){showFeedback(STATUSES.ERROR,msgs.facebook.accDenied);});}
function handleSocialSubmit(endpoint,sentData){sentData=sentData||{};$.ajax({url:endpoint,dataType:"json",type:"POST",data:$.extend(true,{includeHeader:true},sentData),success:function(response){showFeedback(response.result?STATUSES.SUCCESS:STATUSES.ERROR,response.message);handleUserLogin(response.newHeader,response.email);},error:function(response){showFeedback(STATUSES.error);}});}
function promptFbSignIn(){return new Promise(function(resolve,reject){FB.login(function(response){FB.api("/me/permissions",function(permissionsResponse){if(permissionsResponse.error!=undefined){reject(permissionsResponse);}
resolve(permissionsResponse)});},{scope:"public_profile,email",auth_type:"rerequest"});});}
function loadGoogleApi(){gApiStatus.loading=true;if(gApiStatus.tries++>=gApiStatus.maxTries){return;}
Mv.googleApiHelper().onReady(function(){gApiStatus.loaded=true;modalRefs.google.removeClass(opts.classes.socialBtnDisabled);}).onError(function(){loadGoogleApi();}).load();}
function loadFacebookApi(){fbApiStatus.loading=true;Mv.facebookApiHelper().onReady(function(){fbApiStatus.loaded=true;modalRefs.facebook.removeClass(opts.classes.socialBtnDisabled);}).load();}
function changeModalMode(newMode){currentMode=newMode;modalRefs.modalPages.hide();hideFeedback();modalRefs.title.text(titles[newMode]);switch(newMode){case MODES.INITIAL:modalRefs.pageInitial.show();break;case MODES.REGISTER_USER:modalRefs.pageRegister.show();modalRefs.registerFirstInput.focus();break;case MODES.AUTH_USER:modalRefs.pageAuth.show();modalRefs.passInput.focus();break;case MODES.SEARCH_BOOKING:modalRefs.pageRefSearch.show();modalRefs.refNumInput.focus();break;case MODES.AUTH_USER_TOTP:modalRefs.pageAuthTotp.show();modalRefs.totpInput.focus();break;case MODES.SEARCH_BOOKING_TOTP:modalRefs.pageRefSearchTotp.show();modalRefs.refTotpInput.focus();break;}}
function shouldRefreshOnLogin(){return(window.location.pathname.indexOf("/account/")!==-1||window.location.pathname.indexOf("/checkout/billing/flight")!==-1)||isFhubDesktop;}
function isGoogleApiUsable(){return typeof gapi==="object"&&"auth2"in gapi;}
function isFacebookApiUsable(){return typeof FB!=="undefined"}
function checkToLoadGoogleApi(){if(gApiStatus.loaded||gApiStatus.loading||isGoogleApiUsable()){modalRefs.google.removeClass(opts.classes.socialBtnDisabled);return;}
loadGoogleApi();}
function checkToLoadFacebookApi(){if(fbApiStatus.loading||fbApiStatus.loaded||isFacebookApiUsable()){modalRefs.facebook.removeClass(opts.classes.socialBtnDisabled);return;}
loadFacebookApi();}
function showPartnerSearchModal(){$('#login-modal').hide();$('#partner-search-modal-overlay').show();$('#partner-search-modal').show();}
function closePartnerSearchModal(){$('#partner-search-modal-overlay').hide();$('#partner-search-modal').hide();}
Mv.loginModalInitialized=true;$("#partner-search-modal-close").on("click",closePartnerSearchModal)};$(document).ready(function(){Mv.loginModal($(".login-modal-trigger"),{},false);});